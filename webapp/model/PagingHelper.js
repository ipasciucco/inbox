/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/model/Sorter","sap/ui/model/Filter","sap/ui/model/FilterOperator","cross/fnd/fiori/inbox/model/CAQueryHelper","sap/ui/thirdparty/jquery","cross/fnd/fiori/inbox/util/Utils","sap/ui/model/odata/ODataUtils"],function(U,S,F,a,C,q,b,O){"use strict";return U.extend("cross.fnd.fiori.inbox.model.PagingHelper",{_oURLParameters:null,_aSorters:null,_aFilters:null,_iPageSize:40,_iTotal:0,_oLastItem:null,_bLastPageLoaded:false,_bNeedCAQuery:false,constructor:function(u,s,f,p){this._oURLParameters=q.extend(true,{},u);this._aSorters=s;this._aFilters=f;if(p>=0){this._iPageSize=p;}this._oLastItem=null;this._bLastPageLoaded=false;this._iTotal=0;this._bNeedCAQuery=false;if(b.checkIfFirstSorterIsCustomAttribute(this._aSorters)||b.checkIfFilteredByCustomAttribute(this._aFilters)){this._bNeedCAQuery=true;}},getURLParameters:function(){this._iTotal+=this._iPageSize;var p=false;if(this._iTotal%20===0){this._iPageSize++;this._iTotal++;p=true;}this._oURLParameters["$top"]=""+this._iPageSize;if(this._iTotal===this._iPageSize){this._oURLParameters["$inlinecount"]="allpages";}else{this._oURLParameters["$inlinecount"]="none";}if(p){this._iPageSize--;p=false;}if(this._bNeedCAQuery){var s=C.createSortParams(this._getSortersInternal());var f=C.createFilterParams(this._getFiltersInternal());this._oURLParameters.caOrderBy=s;this._oURLParameters.caFilter=f;}return this._oURLParameters;},getSorters:function(){if(this._bNeedCAQuery){return null;}else{return this._getSortersInternal();}},_getSortersInternal:function(){var p=new S("InstanceID");var s=[];s=s.concat(this._aSorters);s.push(p);return s;},getFilters:function(){if(this._bNeedCAQuery){return null;}else{return this._getFiltersInternal();}},_getFiltersInternal:function(){var f=this._aFilters;if(this._oLastItem!==null){var l=this._oLastItem.InstanceID;var c=this._aSorters[0].sPath;var d=this._aSorters[0].bDescending;var e=this._oLastItem[c];if(this._bNeedCAQuery&&e&&(e instanceof Date)){e=O.formatValue(e,"Edm.DateTime");}var g=new F([new F(c,a.EQ,e),new F("InstanceID",a.GT,l)],true);var n=[g];if(!d&&e!==null){n.push(new F(c,a.GT,e));}else if(!d&&e===null){n.push(new F(c,a.NE,null));}else if(e!==null){n.push(new F(c,a.LT,e));n.push(new F(c,a.EQ,null));}else{}var h=[new F(n,false)];var i=this._aFilters.concat(h);f=[new F(i,true)];}return f;},getPageSize:function(){return this._iPageSize;},getLastItem:function(){return this._oLastItem;},getLastPageLoaded:function(){return this._bLastPageLoaded;},setURLParameters:function(u){this._oURLParameters=q.extend(true,{},u);},setSorters:function(s){this._aSorters=s;},setFilters:function(f){this._aFilters=f;},setPageSize:function(p){this._iPageSize=p;},setLastItem:function(l){this._oLastItem=l;},setLastPageLoaded:function(l){this._bLastPageLoaded=l;}});});
