/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/base/ManagedObject","sap/ui/model/resource/ResourceModel","sap/ui/Device","sap/ui/core/routing/HashChanger","sap/base/util/UriParameters","sap/base/Log","sap/m/GroupHeaderListItem","cross/fnd/fiori/inbox/util/tools/ConnectionManager","cross/fnd/fiori/inbox/util/tools/MasterHeaderFooterHelper","cross/fnd/fiori/inbox/util/tools/DetailHeaderFooterHelper","cross/fnd/fiori/inbox/util/tools/FullScreenHeaderFooterHelper"],function(q,M,R,D,H,u,m,G,C,a,b,F){"use strict";return M.extend("cross.fnd.fiori.inbox.util.tools.ApplicationImplementation",{metadata:{properties:{identity:"string",component:"object",oViewHook:"string"},methods:["getConnectionManager"]},init:function(){},sI18N:"i18n",startApplication:function(c){this.bManualMasterRefresh=false;this.oConfiguration=c;this.oMHFHelper=new a(this);this.oDHFHelper=new b(this);this.oFHFHelper=new F(this);this.aMasterKeys=c.getMasterKeyAttributes();this.aKeyValues=null;this.mApplicationModels={};this.AppI18nModel=this.getComponent().getModel("i18n");var o=this.getComponent();if(!sap.ui.getCore().getConfiguration().getDisableCustomizing()){var d=o.getMetadata();if(d){var e=d.getConfig("sap.ca.i18Nconfigs");if(e.bundleName){this.AppI18nModel.enhance(e);}}}this.UilibI18nModel=this.getComponent().getModel("i18n");this.oConnectionManager=C.getNewInstance(this.getIdentity(),this.oConfiguration,{},this.getComponent());this.bIsPhone=D.system.phone;this.bIsIPad=D.system.tablet;var h=sap.ui.getCore().byId(this.getOViewHook());h.setModel(this.AppI18nModel,this.sI18N);this.oCurController={};this.oCurController.MasterCtrl=null;this.oCurController.DetailCtrl=null;this.oCurController.FullCtrl=null;D.orientation.attachHandler(this.onChangeDeviceOrientation,this);this.registerExitModule(q.proxy(this.onAppExit,this));},onAppExit:function(){D.orientation.detachHandler(this.onChangeDeviceOrientation,this);},getResourceBundle:function(){return this.AppI18nModel.getResourceBundle();},getUiLibResourceBundle:function(){return this.UilibI18nModel.getResourceBundle();},getODataModel:function(n){if(n===this.sI18N){return this.AppI18nModel;}return this.oConnectionManager.getModel(n);},setModels:function(c){var v=c.getView();v.setModel(this.AppI18nModel,this.sI18N);v.setModel(this.getComponent().getModel("device"),"device");q.each(this.oConnectionManager.modelList,function(n,d){if(n==="undefined"){v.setModel(d);}else{v.setModel(d,n);}});},isMock:function(){var r=u.fromURL(window.location.href).get("responderOn");return(r==="true");},getConnectionManager:function(){return this.oConnectionManager;},isDetailNavigationPossible:function(c,s){var l=c.getList();if(l){var L=l.getSelectedItem();if(L===null){return false;}if(c.getDetailRouteName===undefined){var p=L.getBindingContext(c.sModelName).getPath().substr(1);if(p.indexOf("/")){p=encodeURIComponent(p);}if(c.oRouter.getURL("detail",{contextPath:p})!==s){return true;}}else if(c.oRouter.getURL(c.getDetailRouteName(),c.getDetailNavigationParameters(L))!==s){return true;}}return false;},onMasterRefreshed:function(c){var h=H.getInstance();var s=h.getHash();this.setStoredSelectedItem(c);var A=false;if(this.bManualMasterRefresh===true){A=this.isDetailNavigationPossible(c,s);}this.fireEvent("_OnMasterListRefresh",{bManualRefresh:this.bManualMasterRefresh,bAutoNavigation:A});this.bManualMasterRefresh=false;},onMasterChanged:function(c){this.oMHFHelper.defineMasterHeaderFooter(c);},setStoredSelectedItem:function(c){if(!this.aKeyValues||this.bManualMasterRefresh===true){return;}var l=c.getList();var I=l.getItems();l.removeSelections();var f=false;var L=null;for(var i=0;i<I.length&&!f;i++){L=I[i];if((L instanceof G)){continue;}var o=L.getBindingContext(c.sModelName);f=true;for(var j=0;f&&j<this.aKeyValues.length;j++){f=this.aKeyValues[j]==o.getProperty(this.aMasterKeys[j]);}}if(this.bIsPhone||(c._oControlStore&&c._oControlStore.bIsSearching)){if(f){L.setSelected(true);l.setSelectedItem(L,true);}if(c._oControlStore){c._oControlStore.bIsSearching=false;}}else{if(!f){var L=this.getFirstListItem(c);}if(L){c.setListItem(L);}}this.aKeyValues=null;},defineDetailHeaderFooter:function(c){this.oDHFHelper.defineDetailHeaderFooter(c);},defineFullscreenHeaderFooter:function(c){this.oFHFHelper.defineHeaderFooter(c);},setSplitContainer:function(s){this.oSplitContainer=s;},registerExitModule:function(e){if(!this.aExitModules){this.aExitModules=[];var c=this.getComponent();var A=function(){};if(c.exit){A=q.proxy(c.exit,c);}c.exit=q.proxy(function(){for(var i=0;i<this.aExitModules.length;i++){this.aExitModules[i]();}A();},this);}this.aExitModules.push(e);},setMasterListBinding:function(c,B){if(c._oMasterListBinding){c._oMasterListBinding.detachChange(c._onMasterListLoaded,c);c._oMasterListBinding.detachChange(c._onMasterListChanged,c);}c._oMasterListBinding=B;if(c._oMasterListBinding){c._oMasterListBinding.attachChange(c._onMasterListLoaded,c);c._oMasterListBinding.attachChange(c._onMasterListChanged,c);}},onChangeDeviceOrientation:function(p){if(this.oCurController.MasterCtrl&&this.oCurController.MasterCtrl._oHeaderFooterOptions){this.oMHFHelper.setHeaderFooter(this.oCurController.MasterCtrl,this.oCurController.MasterCtrl._oHeaderFooterOptions,this.oCurController.MasterCtrl._oControlStore.bAllDisabled,true);}if(this.oCurController.DetailCtrl&&this.oCurController.DetailCtrl._oHeaderFooterOptions){this.oDHFHelper.setHeaderFooter(this.oCurController.DetailCtrl,this.oCurController.DetailCtrl._oHeaderFooterOptions,true);}if(this.oCurController.FullCtrl&&this.oCurController.FullCtrl._oHeaderFooterOptions){this.oFHFHelper.setHeaderFooter(this.oCurController.FullCtrl,this.oCurController.FullCtrl._oHeaderFooterOptions,true);}},setApplicationModel:function(n,o){if(n!=null){if(this.mApplicationModels.hasOwnProperty(n)){m.warning("There was already an application model defined for the name "+n+" it will be overwritten");}this.mApplicationModels[n]=o;}else{m.error("You cannot set an application Model with a 'null' name");}},getApplicationModel:function(n){var o=null;if(this.mApplicationModels.hasOwnProperty(n)){o=this.mApplicationModels[n];}return o;},getFirstListItem:function(c){var l=c.getList(),I=l.getItems();for(var i=0;i<I.length;i++){if(!(I[i]instanceof G)){return I[i];}}return null;}});});
