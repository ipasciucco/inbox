/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","cross/fnd/fiori/inbox/util/Parser","cross/fnd/fiori/inbox/util/CustomAttributeComparator","sap/ui/core/format/DateFormat","sap/ui/core/IconPool","sap/ui/core/library","sap/ui/core/format/NumberFormat","sap/ui/base/Object","sap/m/ObjectListItem","sap/base/Log"],function(q,P,C,D,I,l,N,U,O,L){"use strict";U.extend("cross.fnd.fiori.inbox.Conversions",{});var u=sap.ui.require.toUrl("cross/fnd/fiori/inbox")+"/util/ProcessLogConfig.json";var p=(function(){var r;q.ajax({async:false,url:u,dataType:"json",success:function(i){r=i||{};},error:function(){r={};}});return r;}());var a={};var d=null;var s=sap.ui.require.toUrl("cross/fnd/fiori/inbox")+"/img/home/placeholder.jpg";var b=I.getIconURI("person-placeholder");var c="CustomTaskTitle";var e="CustomNumberValue";var f="CustomNumberUnitValue";var g="CustomObjectAttributeValue";var h="CustomCreatedBy";var V=l.ValueState;cross.fnd.fiori.inbox.Conversions={formatterPropagateModel:function(i){var j=sap.ui.getCore().getConfiguration().getVersion();return j.compareTo("1.44.0")>=0;},formatterTaskTitleMultiSelect:function(t,o){if(o){return o;}return t;},formatterCreatedByMultiSelect:function(i,o){if(o){return o;}return i;},formatterTaskTitle:function(t,o){if(t!=null){var v=cross.fnd.fiori.inbox.Conversions._formatterCustomAttributeValue.call(this,c,o,this);if(v){return v;}return t;}},formatterTaskTitleTaskList:function(t,o){if(t!=null){var v=cross.fnd.fiori.inbox.Conversions._formatterCustomAttributeValueResults.call(this,c,o.results,this);if(v){return v;}return t;}},formatterCreatedBy:function(i,o){if(i!=null){var v=cross.fnd.fiori.inbox.Conversions._formatterCustomAttributeValue.call(this,h,o,this);if(v){return v;}return i;}},formatterCreatedByTaskList:function(i,o){if(i!=null){var v=cross.fnd.fiori.inbox.Conversions._formatterCustomAttributeValueResults.call(this,h,o.results,this);if(v){return v;}return i;}},formatterCreatedByLink:function(o){var v=cross.fnd.fiori.inbox.Conversions._formatterCustomAttributeValue.call(this,h,o,this);if(v){return false;}else{return true;}},formatterTaskTitleLink:function(G,S){if(S&&G){var o=P.fnParseComponentParameters(G);var i=q.isEmptyObject(o)?false:true;this._oURLParsingService=this._oURLParsingService||sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService&&sap.ushell.Container.getService("URLParsing");var j=this._oURLParsingService&&this._oURLParsingService.isIntentUrl(G)?true:false;return(i||j)?false:true;}else if(!S&&!G){return false;}else{return true;}},formatterCustomNumberValue:function(o){var v=cross.fnd.fiori.inbox.Conversions._formatterCustomAttributeValue.call(this,e,o);if(v!=null){return v;}},formatterCustomNumberUnitValue:function(o){var v=cross.fnd.fiori.inbox.Conversions._formatterCustomAttributeValue.call(this,f,o);if(v!=null){return v;}},formatterListCustomObjectAttributeValue:function(o,i){var v=cross.fnd.fiori.inbox.Conversions._formatterCustomObjectAttributeValue.call(this,o,i,true);if(v!=null){return v;}},formatterDetailCustomObjectAttributeValue:function(o,i){var v=cross.fnd.fiori.inbox.Conversions._formatterCustomObjectAttributeValue.call(this,o,i,false);if(v!=null){return v;}},_formatterCustomObjectAttributeValue:function(o,j,k){if(!d){d=cross.fnd.fiori.inbox.util.tools.Application.getImpl().getComponent().getDataManager();}if(d.getShowAdditionalAttributes()===true){if(o&&o.length>0&&j&&j.length>0){var t=this.getBindingContext().getProperty("TaskDefinitionID"),m=this.getBindingContext().getProperty("SAP__Origin"),n=this,v=null;if(t&&m){q.each(o,function(r,K){if(v){return false;}var w=n.getModel().getProperty("/"+K);if(w.Name.toLowerCase()===g.toLowerCase()){var x=k?d.getCustomAttributeDefinitions()[t]:j;if(x&&x instanceof Array&&x.length>0){q.each(x,function(i,y){if(y.Name.toLowerCase()===g.toLowerCase()){v=cross.fnd.fiori.inbox.Conversions.fnCustomAttributeTypeFormatter(w.Value,y.Type);return false;}});}if(!v){v=w.Value;}}});if(v){return v;}}}}},_formatterCustomAttributeValue:function(A,o){if(o!=null){if(!d){d=cross.fnd.fiori.inbox.util.tools.Application.getImpl().getComponent().getDataManager();}if(d.getShowAdditionalAttributes()===true){if(o instanceof Array&&o.length>0){var v=cross.fnd.fiori.inbox.Conversions._getCustomAttributeValue.call(this,A,o);if(v!=null){return v;}}}}return null;},_formatterCustomAttributeValueResults:function(A,o){if(o!=null){if(!d){d=cross.fnd.fiori.inbox.util.tools.Application.getImpl().getComponent().getDataManager();}if(d.getShowAdditionalAttributes()===true){if(o instanceof Array&&o.length>0){var v=cross.fnd.fiori.inbox.Conversions._getCustomAttributeValueResults.call(this,A,o);if(v!=null){return v;}}}}return null;},_getCustomAttributeValue:function(A,o){var v=null;for(var i=0;i<o.length;i++){var j=this.getModel().getProperty("/"+o[i]);if(j&&j.Name.toLowerCase()===A.toLowerCase()){v=j.Value;break;}}return v;},_getCustomAttributeValueResults:function(A,o){var v=null;for(var i=0;i<o.length;i++){if(o[i].Name.toLowerCase()===A.toLowerCase()){v=o[i].Value;break;}}return v;},formatterPriority:function(o,t){if(!o||!t){return null;}if(!d){d=cross.fnd.fiori.inbox.util.tools.Application.getImpl().getComponent().getDataManager();}var i=d.getPriorityDisplayName(o,t);if(i!=null){return i;}switch(t){case"VERY_HIGH":return this.getModel("i18n").getProperty("view.Workflow.priorityVeryHigh");case"HIGH":return this.getModel("i18n").getProperty("view.Workflow.priorityHigh");case"MEDIUM":return this.getModel("i18n").getProperty("view.Workflow.priorityMedium");case"LOW":return this.getModel("i18n").getProperty("view.Workflow.priorityLow");default:}return t;},formatterPriorityState:function(t){switch(t){case"VERY_HIGH":return V.Error;case"HIGH":return V.Warning;case"MEDIUM":case"LOW":default:return V.None;}},formatterStatusForReserved:function(t,S){var T=false;if(t!=null){T=t;}else if(S!=null){T=S;}if(T){return this.getModel("i18n").getProperty("view.Workflow.reservedByYou");}else{return null;}},formatterEscalationState:function(i){if(i){return this.getModel("i18n").getProperty("view.Workflow.escalated");}else{return null;}},formatterEnableUpload:function(A){if(A||A==null||A==undefined){return true;}else{return false;}},formatterVisibilityOfIconTab:function(v){return(v)?true:false;},formatterVisibilityOfObjectIconTab:function(v){if(!v){return false;}var d=cross.fnd.fiori.inbox.util.tools.Application.getImpl().getComponent().getDataManager();return d.bShowTaskObjects?true:false;},formatterHtml:function(o){var S="";if(o){if(o.DescriptionAsHtml){S=o.DescriptionAsHtml;}else{S=o.Description;}}if(S){var F=S.replace(/<a /g,"<a target=\"_blank\" rel=\"noreferrer noopener\" ");S='<div class="sapMText">'+F+"</div>";}return S;},formatterUserCardIcon:function(i){return cross.fnd.fiori.inbox.Conversions.formatterUserIcon(i);},_formatterUserIconAll:function(i,j){if(!i){return j;}var u=cross.fnd.fiori.inbox.Conversions.getRelativeMediaSrc(i);var t=this;var k=a[u];if(k!=null){if(k){return u;}else{return j;}}var S=function(){a[u]=true;t.setIcon(u);t.rerender();};var E=function(){a[u]=false;};if(!d){d=cross.fnd.fiori.inbox.util.tools.Application.getImpl().getComponent().getDataManager();}d.checkImageAvailabilityAsync(u,S,E);return j;},formatterUserIcon:function(i){return cross.fnd.fiori.inbox.Conversions._formatterUserIconAll(i,s);},formatterUserIconForSubstitutors:function(i){return cross.fnd.fiori.inbox.Conversions._formatterUserIconAll(i,b);},formatterIsNotZero:function(v){return!!v;},formatterAgentName:function(i,j){if(i){return i;}else{return j;}},formatterUserName:function(i,j){return i?i:j;},formatterActionIcon:function(A){return p[A]&&p[A].icon;},formatterActionText:function(A){return this.getModel("i18n").getProperty(A);},formatterWorkflowLogStatusText:function(S,i,j){var k;if(i||(j&&S==="READY")){k=cross.fnd.fiori.inbox.Conversions._getWorkflowLogStatusName(S);}else{k=cross.fnd.fiori.inbox.Conversions._getImpersonalWorkflowLogStatusName(S);}return this.getModel("i18n").getProperty(k);},formatterWorkflowLogStatusIcon:function(S,r){var i;i=cross.fnd.fiori.inbox.Conversions._getWorkflowLogStatusName(S);if(r){if(r.toUpperCase()==="NEGATIVE"){i="REJECTED";}else if(r.toUpperCase()==="POSITIVE"){i="APPROVED";}}return p[i]&&p[i].icon;},_getWorkflowLogStatusName:function(S){var i;switch(S){case"READY":i="WORKFLOW_TASK_CREATED";break;case"IN_PROGRESS":i="WORKFLOW_TASK_IN_PROGRESS";break;case"COMPLETED":i="WORKFLOW_TASK_COMPLETED";break;case"WORKFLOW_STARTED":i=S;break;case"FOR_RESUBMISSION":i="WORKFLOW_TASK_SUSPENDEDED";break;case"CANCELLED":i="WORKFLOW_TASK_CANCELED";break;}return i;},_getImpersonalWorkflowLogStatusName:function(S){var i;switch(S){case"READY":i="IMPERSONAL_WORKFLOW_TASK_CREATED";break;case"IN_PROGRESS":i="IMPERSONAL_WORKFLOW_TASK_IN_PROGRESS";break;case"COMPLETED":i="IMPERSONAL_WORKFLOW_TASK_COMPLETED";break;case"WORKFLOW_STARTED":i="IMPERSONAL_WORKFLOW_STARTED";break;case"FOR_RESUBMISSION":i="IMPERSONAL_WORKFLOW_TASK_SUSPENDEDED";break;case"CANCELLED":i="IMPERSONAL_WORKFLOW_TASK_CANCELED";break;}return i;},formatterWorkflowLogResultState:function(r){switch(r.toUpperCase()){case"POSITIVE":return V.Success;case"NEGATIVE":return V.Error;case"NEUTRAL":return V.None;default:return V.None;}},formatterWorkflowLogUserPicture:function(o,i,S,j){var k=cross.fnd.fiori.inbox.Conversions._getWorkflowLogStatusName(S);if(!j||(k!=="WORKFLOW_TASK_CREATED"&&k!=="CREATED")){var m=this.getModel().sServiceUrl+"/UserInfoCollection(SAP__Origin='"+o+"',UniqueName='"+i+"')/$value";return cross.fnd.fiori.inbox.Conversions.formatterUserIcon.call(this,m,this);}},formatterWorkflowLogStatusUsername:function(n,S,i){var j=cross.fnd.fiori.inbox.Conversions._getWorkflowLogStatusName(S);return cross.fnd.fiori.inbox.Conversions.formatterActionUsername.call(this,n,j,i,this);},formatterWorkflowLogUsernameClickable:function(S,i){var j=cross.fnd.fiori.inbox.Conversions._getWorkflowLogStatusName(S);if(i&&(j==="WORKFLOW_TASK_CREATED"||j==="CREATED")){return false;}else{return true;}},formatterActionUsername:function(n,A,i){if(i&&(A==="WORKFLOW_TASK_CREATED"||A==="CREATED")){n=i;}if(p[A]&&p[A].showUsername){return n;}return"";},formatterZeroToNull:function(v){return(v==0?null:v);},formatterSubstitutedText:function(S){if(S){return this.getModel("i18n").getResourceBundle().getText("view.Workflow.Substituted",S);}else{return null;}},formatterDeadLineIndicator:function(i){var o=new Date();if(i&&i-o<0){return this.getModel("i18n").getProperty("view.Workflow.Overdue");}else{return null;}},formatterDeadLineIndicatorState:function(i){var o=new Date();if(i&&i-o<0){return V.Error;}else{return V.None;}},getEmployeeAddress:function(A){var i="";q.each(A,function(k,v){if(q.type(v)==="string"){v=v.trim();i=v?i+v+" ":i+v;}});return i;},formatterStatus:function(o,t){if(!o||!t){return null;}var d=cross.fnd.fiori.inbox.util.tools.Application.getImpl().getComponent().getDataManager();var i=d.getStatusDisplayName(o,t);if(i!=null){return i;}switch(t){case"READY":return this.getModel("i18n").getProperty("view.Workflow.status.ready");case"IN_PROGRESS"||"INPROGRESS":return this.getModel("i18n").getProperty("view.Workflow.status.in_progress");case"RESERVED":return this.getModel("i18n").getProperty("view.Workflow.status.reserved");case"EXECUTED":return this.getModel("i18n").getProperty("view.Workflow.status.executed");case"FOR_RESUBMISSION":return this.getModel("i18n").getProperty("view.Workflow.status.for_resubmission");case"COMPLETED":return this.getModel("i18n").getProperty("view.Workflow.status.completed");}return t;},fnCustomAttributeFormatter:function(v){var t=this.data().Type;return cross.fnd.fiori.inbox.Conversions.fnCustomAttributeTypeFormatter.call(this,v,t);},fnCustomAttributeTypeFormatter:function(v,t){var F;if(typeof t==="string"&&t.indexOf("class java.")===0){t=C.fnMapBPMTypes(t);}switch(t){case"Edm.String":{F=v;break;}case"Edm.DateTime":{if(v==null||v===""){F=v;break;}else{v=C.fnTimeParser(v);if(v==""){F="";}else if(isNaN(v)){F="Invalid Date";}else{var o=D.getDateInstance();F=o.format(new Date(v));}}break;}case"Edm.Boolean":{if(v=="true")F=cross.fnd.fiori.inbox.util.tools.Application.getImpl().getResourceBundle().getText("CUST_ATTR_TRUE");else if(v=="false")F=cross.fnd.fiori.inbox.util.tools.Application.getImpl().getResourceBundle().getText("CUST_ATTR_FALSE");break;}case"Edm.Int64":case"Edm.Int32":case"Edm.Int16":{var n=N.getInstance();F=n.format(v);break;}case"Edm.Time":{if(v==null||v===""){F=v;break;}else{v=C.fnDurationParser(v);if(isNaN(v))F="Invalid Time";else{var T=D.getTimeInstance();var i=new Date();i.setUTCHours(0,0,0,v);F=T.format(i);}}break;}case"Edm.Single":case"Edm.Double":case"Edm.Decimal":{var j=N.getFloatInstance();F=j.format(v);break;}default:{F=v;break;}}return F;},visibilityFormatterForObjectHeaderAndIconTabBar:function(G){if(G!=undefined){return!G;}else{return false;}},visibilityFormatterForGenericComponentContainer:function(G){if(G!=undefined){return!G;}else{return false;}},formatterDate:function(i){if(i){var F={style:"medium/short"};var o=sap.ui.getCore().getConfiguration().getLocale();var j=(o)?D.getDateTimeInstance(F,o):D.getDateTimeInstance(F);var k=j.format(i,false);return k;}},formatterDueDate:function(i){if(i){var F={style:"medium/short"};var o=sap.ui.getCore().getConfiguration().getLocale();var j=(o)?D.getDateTimeInstance(F,o):D.getDateTimeInstance(F);var k=j.format(i,false);var r=cross.fnd.fiori.inbox.util.tools.Application.getImpl().getResourceBundle();var t=r.getText("view.Workflow.dueOn",k);var m=this.getParent?this.getParent():null;if(m&&m instanceof O){if(i-(new Date())<0){F.style="medium";j=(o)?D.getDateInstance(F,o):D.getDateInstance(F);}else{F.style="medium/short";j=(o)?D.getDateTimeInstance(F,o):D.getDateTimeInstance(F);}k=j.format(i,false);t=r.getText("view.Workflow.dueOn",k);if(this.getText()!==t){var S=m.getList().getParent().getParent().getController();if(!S.bInitList){m.invalidate();}}}return t;}return;},formatterCreatedDate:function(i){var d=cross.fnd.fiori.inbox.util.tools.Application.getImpl().getComponent().getDataManager();if(i&&(d.bOutbox===undefined||d.bOutbox===false)){var F={style:"medium/short"};var o=sap.ui.getCore().getConfiguration().getLocale();var j=(o)?D.getDateTimeInstance(F,o):D.getDateTimeInstance(F);var k=j.format(i,false);return cross.fnd.fiori.inbox.util.tools.Application.getImpl().getResourceBundle().getText("view.Workflow.createdOn",k);}return;},formatterCompletedDate:function(i,t){if(!t){return null;}var d=cross.fnd.fiori.inbox.util.tools.Application.getImpl().getComponent().getDataManager();if(d.bOutbox===true&&t==="COMPLETED"){if(i!==null){var F={style:"medium/short"};var o=sap.ui.getCore().getConfiguration().getLocale();var j=(o)?D.getDateTimeInstance(F,o):D.getDateTimeInstance(F);var k=j.format(i,false);return cross.fnd.fiori.inbox.util.tools.Application.getImpl().getResourceBundle().getText("view.Workflow.completedOn",k);}}return;},formatterResumeOnText:function(i,t){if(!t){return null;}var d=cross.fnd.fiori.inbox.util.tools.Application.getImpl().getComponent().getDataManager();if(d.bOutbox===true&&t==="FOR_RESUBMISSION"){if(i!==null){var F={style:"medium/short"};var o=sap.ui.getCore().getConfiguration().getLocale();var j=(o)?D.getDateTimeInstance(F,o):D.getDateTimeInstance(F);var k=j.format(i,false);return cross.fnd.fiori.inbox.util.tools.Application.getImpl().getResourceBundle().getText("view.Workflow.resumeOn",k);}}return;},getSelectedControl:function(E){var o=E.getSource();var S=undefined;var i=E.getParameter("domRef");if(i){S=sap.ui.getCore().byId(i.id);}return S?S:o;},formatterThemeBasedBackgroundColor:function(S){if(S&&(S.toLowerCase()==="sap_belize"||S.toLowerCase()==="sap_belize_plus")){return"Solid";}else{return"Transparent";}},getRelativeMediaSrc:function(m){var u="";if(m&&typeof m==="string"){var o=document.createElement("a");o.href=m;u=(o.pathname.charAt(0)==="/")?o.pathname:"/"+o.pathname;}return u;},formatterSupportsProperty:function(t,S){if(t!=null){return t;}if(S!=null){return S;}return true;},formatterLogTaskSupportsProperty:function(i){return(i)?i:false;},formatterShowHideGenericComponent:function(i,S){if(S!=undefined&&i!=undefined){return!i;}if(i==undefined){return false;}return i;},formatterMailSubject:function(i,j,t){if(!i&&!j){return this.i18nBundle.getText("share.email.subject_no_priority_no_user",[t]);}if(!i){return this.i18nBundle.getText("share.email.subject_no_priority",[j,t]);}if(!j){return this.i18nBundle.getText("share.email.subject_no_user",[i,t]);}return this.i18nBundle.getText("share.email.subject",[i,j,t]);},formatterTaskSupportsValue:function(t,S){if(t!=null){return t;}if(S!=null){return S;}return false;},setDataManager:function(o){d=o;},setShellTitleToOutbox:function(o,i){o.getService("ShellUIService").then(function(S){S.setTitle(cross.fnd.fiori.inbox.util.tools.Application.getImpl().getResourceBundle().getText("SHELL_TITLE_OUTBOX"));},function(E){L.error("Cannot get ShellUIService",E,i);});},setShellTitleToInbox:function(o,i){o.getService("ShellUIService").then(function(S){S.setTitle(cross.fnd.fiori.inbox.util.tools.Application.getImpl().getResourceBundle().getText("SHELL_TITLE"));},function(E){L.error("Cannot get ShellUIService",E,i);});}};return cross.fnd.fiori.inbox.Conversions;});
