/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/model/Sorter","sap/ui/core/Fragment","sap/m/ViewSettingsItem","sap/base/Log","cross/fnd/fiori/inbox/util/CustomAttributeComparator"],function(U,S,F,V,B,C){"use strict";return U.extend("cross.fnd.fiori.inbox.util.TaskListSortingHelper",{_oResourceBundle:null,_oTableOperations:null,_oView:null,_oSortDialogPromise:null,_oCustomSortItems:{},constructor:function(t,v){this._oResourceBundle=v.getController().getResourceBundle();this._oTableOperations=t;this._oView=v;},addCustomSortItem:function(i,k,t){var e=encodeURIComponent(k);var s=new V(i+"Sorter",{key:e,text:t});this._getSortingDialog().then(function(o){o.addSortItem(s);});this._oCustomSortItems[k]=s;},hideCustomSortItem:function(k){var s=this._oCustomSortItems[k];if(s){this._getSortingDialog().then(function(o){o.removeSortItem(s);});}},showCustomSortItem:function(k){var s=this._oCustomSortItems[k];if(s){this._getSortingDialog().then(function(o){o.addSortItem(s);});}},destroy:function(){for(var k in this._oCustomSortItems){this._oCustomSortItems[k].destroy();}},openSortingDialog:function(){this._getSortingDialog().then(function(s){var l=this._oTableOperations.getSorter();if(l.length>0){var d=l[0].bDescending;if(l[0].sPath==="PriorityNumber"){d=!d;}s.setSelectedSortItem(l[0].sPath);s.setSortDescending(d);}s.open();}.bind(this));},onSortDialogConfirmed:function(e){var p=e.getParameters(),s=p.sortItem.getKey();var a=decodeURIComponent(s);var b=this._oTableOperations.getTDKeys();var t=p.sortItem.getModel("taskDefinitions").getData().TaskDefinitionCollection;var c;CA_Type_Search_Block:{for(var i=0;i<b.length;i++){for(var j=0;j<t.length;j++){if(b[i]===t[j].TaskDefinitionID){var d=t[j].CustomAttributeDefinitionData.results;for(var k=0;k<d.length;k++){if(d[k].Name===a){c=d[k].Type;break CA_Type_Search_Block;}}}}}}var f=p.sortDescending;if(s==="PriorityNumber"){f=!f;}var g=C.getCustomAttributeComparator(c);if(g!=null){this._oTableOperations.addSorter(new S(s,f,false,g));}else{this._oTableOperations.addSorter(new S(s,f));}this._oTableOperations.applyTableOperations();},_getSortingDialog:function(){if(this._oSortDialogPromise!==null){return this._oSortDialogPromise;}this._oSortDialogPromise=F.load({name:"cross.fnd.fiori.inbox.frag.TaskSortingDialog",controller:this}).then(function(s){this._oView.getController().attachControl(s);return s;}.bind(this)).catch(function(){B.error("Task Sorting Dialog was not created successfully");});return this._oSortDialogPromise;}});});
