/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/model/Sorter","sap/m/ViewSettingsItem","cross/fnd/fiori/inbox/util/CustomAttributeComparator"],function(U,S,V){"use strict";return U.extend("cross.fnd.fiori.inbox.util.MultiSelectSortingHelper",{_oResourceBundle:null,_oTableOperations:null,_oView:null,_oSortDialog:null,_oCustomSortItems:{},_currentSorting:new S("CreatedOn",true),constructor:function(t,v){this._oResourceBundle=v.getController().getOwnerComponent().getModel("i18n").getResourceBundle();this._oTableOperations=t;this._oView=v;},addCustomSortItem:function(i,k,t){var e=encodeURIComponent(k);var s=new V(i+"Sorter",{key:e,text:t});this._getSortingDialog().addSortItem(s);this._oCustomSortItems[k]=s;},hideCustomSortItem:function(k){var s=this._oCustomSortItems[k];if(s){this._getSortingDialog().removeSortItem(s);}},showCustomSortItem:function(k){var s=this._oCustomSortItems[k];if(s){this._getSortingDialog().addSortItem(s);}},destroy:function(){for(var k in this._oCustomSortItems){this._oCustomSortItems[k].destroy();}},openSortingDialog:function(){var d=this._getSortingDialog();var l=this._oTableOperations.getSorter();if(l.length>0){var a=l[0].bDescending;if(l[0].sPath==="PriorityNumber"){a=!a;}d.setSelectedSortItem(l[0].sPath);d.setSortDescending(a);}d.open();},onSortDialogConfirmed:function(e){var p=e.getParameters(),s=p.sortItem.getKey();var a=decodeURIComponent(s);var b=null;if(p.sortItem.getModel("customAttributeDefinitionsModel")){var t=p.sortItem.getModel("customAttributeDefinitionsModel").getData().results;for(var i=0;i<t.length;i++){if(t[i].Name===a){b=t[i].Type;break;}}}var c=p.sortDescending;if(s==="PriorityNumber"){c=!c;}var C=cross.fnd.fiori.inbox.util.CustomAttributeComparator.getCustomAttributeComparator(b);var d=C!==null?new S(s,c,false,C):new S(s,c);this._oTableOperations.addSorter(d);this._currentSorting=d;this.setColumnSortIndicator(s,c?"Descending":"Ascending");this._oTableOperations.applyTableOperations();},applySorting:function(){this._oTableOperations.addSorter(this._currentSorting);this._oTableOperations.applyTableOperations();},resetSorting:function(){this._currentSorting=new S("CreatedOn",true);this._oTableOperations.addSorter(this._currentSorting);this._oTableOperations.applyTableOperations();if(this._oSortDialog!==null){this._oSortDialog.setSelectedSortItem("CreatedOn");this._oSortDialog.setSortDescending(true);}this.setColumnSortIndicator("CreatedOn","Descending");if(this._oSortDialog){this._oSortDialog.destroy();}this._oSortDialog=null;},setColumnSortIndicator:function(c,o){if(parseFloat(sap.ui.version)>=1.61){var C=this._oView.byId("idMultiSelectTable").getColumns();for(var i=0;i<C.length;i++){var a=C[i].getId().indexOf(c)>-1?o:"None";C[i].setSortIndicator(a);}}},_getSortingDialog:function(){if(!this._oSortDialog){this._oSortDialog=sap.ui.xmlfragment("cross.fnd.fiori.inbox.frag.MultiSelectSortingDialog",this);this._oView.getController().attachControl(this._oSortDialog);}return this._oSortDialog;}});});
