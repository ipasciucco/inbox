/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/model/Sorter","sap/ui/model/Filter","sap/ui/model/FilterOperator","cross/fnd/fiori/inbox/model/models"],function(U,S,F,a,m){"use strict";return U.extend("cross.fnd.fiori.inbox.util.TableOperationsImplMyTasks",{constructor:function(s){this.bGroupingChanged=false;this.bAppFilterNotNULL=true;this.oGrouper=null;this.oDefaultSorter=s.oDefaultSorter;this.sDefaultSortItemKey="CreatedOn";this.aSortList=this._getDefaultSortList();this.aSortGroupList=[];this.oTable=s.oTable;this.SortersMAXDepth=1;this.oURLParameters={};this.aTotalFilterList=[];this.aAppFilterList=this._getDefaultFilterList();this.oAppFilterDict={};this.aUserFilterList=[];this.oUserFilterDict={};},getDefaultSortItemKey:function(){return this.sDefaultSortItemKey;},getURLParameters:function(){return this.oURLParameters;},getSorters:function(){return this.aSortList;},getFilters:function(){return this.aTotalFilterList;},_getSortListIndexByPath:function(p){var i;for(i=0;i<this.aSortList.length;i++){if(this.aSortList[i].sPath===p){return i;}}return-1;},addSorter:function(s){var i=this._getSortListIndexByPath(s.sPath);if(i!==-1){this.aSortList.splice(i,1);}this.aSortList.unshift(s);if(this.aSortList.length>this.SortersMAXDepth){this.aSortList.splice(this.SortersMAXDepth,1);}if(this.oGrouper&&this.oGrouper.sPath===s.sPath){this.oGrouper.bDescending=s.bDescending;}},addUserFilter:function(f,s){this.addFilter(f,s,this.oUserFilterDict);},addAppFilter:function(f,s){this.addFilter(f,s,this.oAppFilterDict);},addFilter:function(f,s,o){if(f&&s){if(o[s]){if(f.sOperator===a.NE){o[s].excludingFilters.push(f);}else{o[s].includingFilters.push(f);}}else{o[s]={includingFilters:[],excludingFilters:[]};if(f.sOperator===a.NE){o[s].excludingFilters=[f];}else{o[s].includingFilters=[f];}}}},_updateFilterList:function(f,o){for(var p in o){if(o.hasOwnProperty(p)){if(o[p].includingFilters.length>0){f.push(new F(o[p].includingFilters,false));}if(o[p].excludingFilters.length>0){f.push(new F(o[p].excludingFilters,true));}delete o[p];}}},applyTableOperations:function(b){this.updateTotalFilterList();this.createSortGroupList();if(this.bAppFilterNotNULL){m.refreshTaskModel(this.getURLParameters(),this.aSortGroupList,this.getFilters(),b);}else{m.updateTaskModel({results:{}});m.fireEvent("taskModelUpdated");}if(b){m.getMainModel().submitChanges({groupId:b,success:function(d,r){}.bind(this),error:function(e){}.bind(this)});}},_applySortingAngGroupingOperations:function(t){var A=[];if(this.bGroupingChanged){if(this.oGrouper){A.push(this.oGrouper);}if(this.aSortList.length>0){A=A.concat(this.aSortList);}t.sort(A);}},updateTotalFilterList:function(){this._updateFilterList(this.aUserFilterList,this.oUserFilterDict);this._updateFilterList(this.aAppFilterList,this.oAppFilterDict);this.aTotalFilterList=[].concat(this.aAppFilterList,this.aUserFilterList);},createSortGroupList:function(){if(this.aSortList.length>0){this.aSortGroupList=[].concat(this.aSortList);}if(this.bGroupingChanged&&this.oGrouper){var i=this._getSortListIndexByPath(this.oGrouper.sPath);if(i!==-1){this.aSortGroupList.splice(i,1);}this.aSortGroupList.unshift(this.oGrouper);}if(this.aSortGroupList.length>this.SortersMAXDepth){this.aSortGroupList.splice(this.SortersMAXDepth,1);}},createAppFilterList:function(){this._updateFilterList(this.aAppFilterList,this.oAppFilterDict);},setGrouping:function(n){if(n===null&&this.oGrouper===null){this.bGroupingChanged=false;}else{this.oGrouper=n;this.bGroupingChanged=true;}},_getDefaultFilterList:function(){var f=[];f.push(new F({path:"Status",operator:sap.ui.model.FilterOperator.EQ,value1:"READY"}));f.push(new F({path:"Status",operator:sap.ui.model.FilterOperator.EQ,value1:"RESERVED"}));f.push(new F({path:"Status",operator:sap.ui.model.FilterOperator.EQ,value1:"IN_PROGRESS"}));f.push(new F({path:"Status",operator:sap.ui.model.FilterOperator.EQ,value1:"EXECUTED"}));return[new F(f,false)];},_getDefaultSortList:function(){return[this.oDefaultSorter||new S("CreatedOn",true)];},removeGrouping:function(){if(this.oGrouper===null){this.bGroupingChanged=false;}else{this.oGrouper=null;this.bGroupingChanged=true;}},removeURLParameter:function(u){delete this.oURLParameters[u];},_resetChangeIndicators:function(){this.bGroupingChanged=false;},resetAllFilters:function(){this.aTotalFilterList=[];this.resetUserFilters();this.resetAppFilters();},resetUserFilters:function(){this.aUserFilterList=[];this.oUserFilterDict={};},resetAppFilters:function(){this.aAppFilterList=this._getDefaultFilterList();this.oAppFilterDict={};this.bAppFilterNotNULL=true;},setAppFilters:function(f){var t=jQuery.type(f);this.aAppFilterList=[];this.oAppFilterDict={};switch(t){case"object":if(f instanceof F){this.aAppFilterList.push(f);}this.bAppFilterNotNULL=true;break;case"array":this.aAppFilterList=[].concat(f);this.bAppFilterNotNULL=true;break;case"undefined":this.bAppFilterNotNULL=true;break;default:this.bAppFilterNotNULL=false;}},setURLParameter:function(u,v){this.oURLParameters[u]=v;}});});
