/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/library","sap/ui/core/format/DateFormat","sap/ui/Device","sap/ui/core/IconPool","sap/ui/core/Icon","cross/fnd/fiori/inbox/util/Conversions"],function(U,F,a,l,D,b,I,c,C){"use strict";U.extend("cross.fnd.fiori.inbox.Substitution",{});var _=null;var d={};var e=null;var L=l.ListType;cross.fnd.fiori.inbox.Substitution={formatterUserIconVisibility:function(u,s){this.getParent().data("userid",u);var f=this.getModel().sServiceUrl+"/UserInfoCollection(SAP__Origin='"+s+"',UniqueName='"+u+"')/$value";return!(cross.fnd.fiori.inbox.Substitution._isImagePresent(f));},formatterUserPictureVisibility:function(u,s){this.getParent().data("userid",u);var f=this.getModel().sServiceUrl+"/UserInfoCollection(SAP__Origin='"+s+"',UniqueName='"+u+"')/$value";return cross.fnd.fiori.inbox.Substitution._isImagePresent(f);},formatterToMerge:function(p){return!p?true:false;},_isImagePresent:function(u){if(!_){_=cross.fnd.fiori.inbox.util.tools.Application.getImpl().getComponent().getDataManager();}if(d[u]==undefined){d[u]=_.fnIsImagePresent(u);}return d[u];},_processSubstitutedUsersCollection:function(s){var n={UniqueName:s.UniqueName,DisplayName:s.DisplayName,SAP__Origin:s.SAP__Origin};return n;},_getSubstitutedUserFilters:function(s){var f=[];for(var i=0;i<s.length;i++){var S=new F({path:"SubstitutedUser",operator:a.EQ,value1:s[i]});f.push(S);if(s[i]===""){var n=new F({path:"SubstitutedUser",operator:a.EQ,value1:null});f.push(n);}}return f;},formatterUserPictureUrl:function(u,s){return this.getModel().sServiceUrl+"/UserInfoCollection(SAP__Origin='"+s+"',UniqueName='"+u+"')/$value";},formatterUserName:function(u,f){this.data("userid",u);return f;},formatterToAlignColumn:function(p){return p?"Begin":"End";},formatterProfileText:function(p,P){var s=(!p||p.trim()==="")?P:p;if(s){return" "+s;}else{return this.getModel("i18n").getResourceBundle().getText("substn.table.profile_text");}},formatterPlannedOrUnplannedNavigation:function(p){if(p){return L.Navigation;}else{return L.Active;}},formatterSubstitutionStartDate:function(s){return D.getDateInstance({style:"short"}).format(s);},formatterUserPictureIcon:function(m){return C.formatterUserIconForSubstitutors(m);},formatterSubstitutionEndDate:function(B,E){if(E==null||E==undefined){return"";}var t=cross.fnd.fiori.inbox.Substitution._getActiveDays(true,B,E);return(t>3650)?"":D.getDateInstance({style:"short"}).format(E);},formatterTimeDuration:function(f,g){if(g==null||g==undefined){return"";}var i=!cross.fnd.fiori.inbox.Substitution._isFutureDate(f);var t=cross.fnd.fiori.inbox.Substitution._getActiveDays(i,f,g);var r=this.getModel("i18n").getResourceBundle();if(i){if(t===1){t=r.getText("substn.table.one_day_left");}else if(t>1&&t<=60){t=r.getText("substn.table.days_left",t);}else if(t>60&&t<3650){t=r.getText("substn.table.months_left",Math.floor(t/30));}else if(t>3650){t=r.getText("substn.table.forever_left");}return t;}else{if(t===1){t=r.getText("substn.table.starts_in_one_day");}else if(t>1&&t<=60){t=r.getText("substn.table.starts_in_days",t);}else if(t>60){t=r.getText("substn.table.starts_in_months",Math.floor(t/30));}return t;}},formatterDisplayErroneousRuleStatus:function(s){return s?false:true;},_getActiveDays:function(i,s,f){var t=cross.fnd.fiori.inbox.Substitution._getDiffWithCurrentTime(i?f:s)/(1000*60*60*24);if(t>1){return Math.floor(t);}else if(t>0){return Math.ceil(t);}},_getDiffWithCurrentTime:function(f){var t=new Date();var g=new Date(f.getFullYear(),f.getMonth(),f.getDate(),24,0,0);var h=g.getTime()-(t.getTime());return h;},isRuleOutdated:function(f){if(f&&cross.fnd.fiori.inbox.Substitution._getDiffWithCurrentTime(f)<0){return true;}return false;},_isCurrentDate:function(f){if(f){var o=new Date();if((o.getDate()===f.getDate())&&(o.getMonth()===f.getMonth())&&(o.getYear()===f.getYear())){return true;}}},_isFutureDate:function(f){if(f){if(cross.fnd.fiori.inbox.Substitution._getDiffWithCurrentTime(f)>0&&!cross.fnd.fiori.inbox.Substitution._isCurrentDate(f)){return true;}}return false;},getEndOfCurrentDate:function(){var o=new Date();return new Date(o.getFullYear(),o.getMonth(),o.getDate(),23,59,59);},formatterSubstitutesStatus:function(u,A,m,B){var s=this.getModel("i18n").getResourceBundle().getText("substn.table.active");var i=this.getModel("i18n").getResourceBundle().getText("substn.table.inactive");if(u){if((m!=="TAKE_OVER")&&(e[u]!=undefined)){if(b.system.phone){var f=!cross.fnd.fiori.inbox.Substitution._isFutureDate(B);return f?s:i;}else{return e[u].bActive?s:i;}}else{return"";}}},setUserInfo:function(u){e=u;},formatterSubstitutedUserName:function(i,n){n=n.trim();return n?n:i;},formatterSubstitutedUserPicture:function(u,s){var t=this;var p=this.getParent();if(!_){_=cross.fnd.fiori.inbox.util.tools.Application.getImpl().getComponent().getDataManager();}var f=_.oModel.sServiceUrl+"/UserInfoCollection(SAP__Origin='"+s+"',UniqueName='"+u+"')/$value";if(d[f]==undefined){d[f]=_.fnIsImagePresent(f,u);}var i=d[f];if(i){return f;}else{p.removeItem(t);t.destroy();f=I.getIconURI("person-placeholder");var o=new c({size:"2rem",width:"1.25em",height:"1.25em",color:"#bfbfbf",backgroundColor:"#f2f2f2",src:f});p.insertItem(o,0);}},};return cross.fnd.fiori.inbox.Substitution;});
