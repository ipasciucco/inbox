/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/base/Log","cross/fnd/fiori/inbox/Component"],function(U,J,F,B,C){"use strict";U.extend("cross.fnd.fiori.inbox.util.SupportInfo",{});cross.fnd.fiori.inbox.util.SupportInfo={open:function(v){v.setModel(cross.fnd.fiori.inbox.util.tools.Application.getImpl().AppI18nModel,"i18n");var c=v.createId("BTN_SUPPORTINFO");this.oModel=this.getJSONModel();this.setScenarioConfig();var s=C.getMetadata().getVersion();this.getJSONModel().setProperty("/compversion",s);this.getJSONModel().setProperty("/sapui5version",sap.ui.version);this.oDialog=v.byId(c+"--DLG_SUPPORTINFO");if(!this.oDialog){this._createSupportInfoPromise(c).then(function(d){this.oDialog=d;v.addDependent(this.oDialog);this._openDialog.call(this);}.bind(this));}else{this._openDialog.call(this);}},setGroup:function(g){this.getJSONModel().setProperty("/groupby",g);},setFilters:function(f){var s="";for(var k in f){if(f.hasOwnProperty(k)){s=s+k+"\n";}}this.getJSONModel().setProperty("/filters",s);},setSorters:function(s){this.getJSONModel().setProperty("/orderby",s);},setSearchPattern:function(p){this.getJSONModel().setProperty("/searchby",p);},setTask:function(t,c,e){this.getJSONModel().setProperty("/Task",t);if(c){var m=this.getJSONModel().getProperty("/Task");if(m&&m.CustomAttributeData){for(var i=0;i<m.CustomAttributeData.length;i++){var d=cross.fnd.fiori.inbox.util.tools.Application.getImpl().getComponent().getDataManager();if(d.getShowAdditionalAttributes()||typeof m.CustomAttributeData[i]==="string"){m.CustomAttributeData[i]=e.getProperty("/"+m.CustomAttributeData[i]);}for(var a=0;a<c.length;a++){if(m.CustomAttributeData[i].Name===c[a].Name){m.CustomAttributeData[i].Type=c[a].Type;}}}}this.getJSONModel().setProperty("/Task",m);}},setScenarioConfig:function(){var c=cross.fnd.fiori.inbox.util.tools.Application.getImpl().getComponent();var d=c.getDataManager();var s=d.getScenarioConfig();this.getJSONModel().setProperty("/ScenarioConfig",s);},getJSONModel:function(){if(!this.oModel){this.oModel=new J();return this.oModel;}else{return this.oModel;}},formatVisibility:function(v){if(v){return true;}else{return false;}},decodeString:function(s){return s!=null?decodeURIComponent(s):"";},onCancelDialog:function(){if(this.oDialog){this.oDialog.close();this.getJSONModel().setProperty("/Task",null);}},_openDialog:function(){this.oDialog.setModel(this.oModel);this.oDialog.open();this.oDialog.setEscapeHandler(function(p){this.onCancelDialog();p.resolve();}.bind(this));},_createSupportInfoPromise:function(c){return F.load({id:c,type:"XML",name:"cross.fnd.fiori.inbox.frag.SupportInfo",controller:this}).catch(function(){B.error("Support Info dialog was not created successfully");});}};return cross.fnd.fiori.inbox.util.SupportInfo;});
