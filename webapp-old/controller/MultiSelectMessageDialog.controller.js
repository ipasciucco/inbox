/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["cross/fnd/fiori/inbox/controller/BaseController","cross/fnd/fiori/inbox/util/Utils"],function(B,U){"use strict";return B.extend("cross.fnd.fiori.inbox.controller.MultiSelectMessageDialog",{oDetailDialogView:null,onInit:function(){var m=new sap.ui.model.json.JSONModel();m.setData({title:null,messageStripTitle:null,items:[]});this.getView().setModel(m);},openDialog:function(c,s,e,C,f){this.sCurrentAction=c;this.aSuccessList=s;this.aErrorList=e;this.aChangedTasks=C;this.fnClose=f;var a=this.getModel("i18n").getResourceBundle();var t=[];for(var i=0;i<s.length;i++){var S={type:sap.ui.core.MessageType.Success,title:s[i].sTaskTitle,subtitle:s[i].sMessage,markupDescription:false};t.push(S);}var A=this.sCurrentAction;if(this.sCurrentAction==="Claim"){A=a.getText("DialogMultiMessage_Claim");}if(this.sCurrentAction==="Release"){A=a.getText("DialogMultiMessage_Release");}var u;var E;for(var n=0;n<e.length;n++){E=U.fnRemoveHtmlTags(e[n]);u=this._prapareUserInstructions(E.sErrorCode,this.sCurrentAction);var o={type:sap.ui.core.MessageType.Error,title:E.sTaskTitle,subtitle:E.sMessage+" "+u,markupDescription:true,description:E.sMessage+" "+u+"<br><h3>"+a.getText("DialogMultiMessage_TechnicalDetailsTitle")+"</h3>"+"<p><b>"+a.getText("DialogMultiMessage_TaskName")+"</b><br>"+E.sTaskTitle+"</p>"+"<p><b>"+a.getText("DialogMultiMessage_ActionName")+"</b><br>"+A+"</p>"+"<p><b>"+a.getText("DialogMultiMessage_TaskID")+"</b><br>"+E.InstanceID+"</p>"+"<p><b>"+a.getText("DialogMultiMessage_ErrorCode")+"</b><br>"+E.sErrorCode+"</p>"+"<p><b>"+a.getText("DialogMultiMessage_SourceMessage")+"</b><br>"+E.sErrorBody+"</p>"};t.push(o);}var h=false;if(s.length>0){h=true;}var d="Error";var D=a.getText("DialogMultiMessage_Error");var I="sap-icon://message-error";var b="Negative";var g="error-icon";var m;var M;var j=false;if(t.length>1){M="Error";if(h){d="Warning";I="sap-icon://message-warning";b="Critical";g="warning-icon";M="Warning";}j=true;if(this.sCurrentAction==="Claim"){D=a.getText("DialogMultiMessage_ClaimTitle");if(h){m=a.getText("DialogMultiMessage_ClaimInfoSome");}else{m=a.getText("DialogMultiMessage_ClaimInfoAll");}}if(this.sCurrentAction==="Release"){D=a.getText("DialogMultiMessage_ReleaseTitle");if(h){m=a.getText("DialogMultiMessage_ReleaseInfoSome");}else{m=a.getText("DialogMultiMessage_ReleaseInfoAll");}}}var k=this.getModel();k.setData({dialogState:d,dialogTitle:D,iconSrc:I,iconColor:b,iconAlt:g,messageStripTitle:m,messageStripType:M,messageStripVisible:j,items:t});this.setModel(k);var l=this.byId("multiSelectMessageDialog");l.setEscapeHandler(function(p){this.onClosePress();p.resolve();}.bind(this));this.byId("messageView").navigateBack();l.open();},_prapareUserInstructions:function(e,a){if(e==="/IWBEP/CX_MGW_BUSI_EXCEPTION"&&a==="Claim"||e==="403"){return this.getModel("i18n").getResourceBundle().getText("DialogMultiMessage_RefreshInstructions");}return this.getModel("i18n").getResourceBundle().getText("DialogMultiMessage_ContactSystemAdministratorInstructions");},onItemSelect:function(){if(this.aSuccessList.length+this.aErrorList.length>1){this.byId("multiSelectMessageDialogNavBackButton").setVisible(true);this.byId("messageStrip").setVisible(false);}},handleBackButtonPress:function(){this.byId("multiSelectMessageDialogNavBackButton").setVisible(false);this.byId("messageStrip").setVisible(true);this.byId("messageView").rerender();this.byId("messageView").navigateBack();},closeDialog:function(){var d=this.byId("multiSelectMessageDialog");d.close();this.byId("multiSelectMessageDialogNavBackButton").setVisible(false);this.byId("messageView").rerender();},onClosePress:function(){this.closeDialog();if(this.fnClose){this.fnClose(this.aChangedTasks);}}});});
