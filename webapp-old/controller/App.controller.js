/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["cross/fnd/fiori/inbox/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/Device","cross/fnd/fiori/inbox/util/DataManager","cross/fnd/fiori/inbox/util/StartupParameters"],function(B,J,D,a,S){"use strict";return B.extend("cross.fnd.fiori.inbox.controller.App",{onInit:function(){var m=new J();this.setModel(m,"fcl");var M=new J();this.setModel(M,"parametersModel");var o=this.getOwnerComponent();var d=new a(this);o.setDataManager(d);this.oStartupParameters=S.getInstance();if(this.oStartupParameters.isModeActive()){var v,O=this.getView().getBusyIndicatorDelay();v=new J({busy:true,delay:O});this.setModel(v,"appView");var e=this.getOwnerComponent().getErrorHandler();var s=function(I){e.setIsMetadataLoadedFailed(I);v.setProperty("/busy",false);v.setProperty("/delay",O);};this.getOwnerComponent().getModel().metadataLoaded().then(s.bind(this,false));this.getOwnerComponent().getModel().attachMetadataFailed(s.bind(this,true));var i=e.getIsMetadataLoadedFailed();if(i){s(i);}}this.getView().addStyleClass(this.getOwnerComponent().getContentDensityClass());this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.attachRouteMatched(this.onRouteMatched,this);this.oRouter.attachBeforeRouteMatched(this.onBeforeRouteMatched,this);},onColumnResize:function(e){var m=e.getSource().getBeginColumnPages()[0];if(m&&typeof m.getController().iIndex==="number"&&e.getParameter("beginColumn")){var t=m.byId("table");t.$().is(":visible")&&t.scrollToIndex(m.getController().iIndex);}},onBeforeRouteMatched:function(e){var m=this.getModel("fcl");var l=e.getParameters().arguments.layout;if(!l||!this.oStartupParameters.isFlexibleColumnLayout()){var n=this.getOwnerComponent().getFCLHelper().getNextUIState(0);l=n.layout;}if(l){m.setProperty("/layout",l);}},onRouteMatched:function(e){var r=e.getParameter("name");var A=e.getParameter("arguments");this._updateUIElements();this.currentRouteName=r;this.SAP__Origin=decodeURIComponent(A.SAP__Origin);this.InstanceID=decodeURIComponent(A.InstanceID);},onStateChanged:function(e){var i=e.getParameter("isNavigationArrow");var l=e.getParameter("layout");var r=!D.system.phone;this._updateUIElements();if(i){if(l==="ThreeColumnsMidExpandedEndHidden"){this.getModel("parametersModel").setProperty("/showLogButtonPressed",false);this.getModel("parametersModel").setProperty("/showDetailsButtonPressed",false);}this.oRouter.navTo(this.currentRouteName,{SAP__Origin:encodeURIComponent(this.SAP__Origin),InstanceID:encodeURIComponent(this.InstanceID),layout:l},r);}if(l==="ThreeColumnsMidExpanded"){if(this.currentRouteName==="myTasksDetailDetail"){this.getModel("parametersModel").setProperty("/showLogButtonPressed",true);}if(this.currentRouteName==="additionalTaskDetails"){this.getModel("parametersModel").setProperty("/showDetailsButtonPressed",true);}}},_updateUIElements:function(){var m=this.getModel("fcl");var u=this.getOwnerComponent().getFCLHelper().getCurrentUIState();m.setData(u);},onExit:function(){this.oRouter.detachRouteMatched(this.onRouteMatched,this);this.oRouter.detachBeforeRouteMatched(this.onBeforeRouteMatched,this);this.oStartupParameters.destroy();}});});
