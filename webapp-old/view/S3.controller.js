/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/m/MessageBox","sap/m/MessageToast","sap/m/UploadCollectionParameter","sap/m/VBox","sap/m/ObjectAttribute","sap/m/ObjectStatus","sap/m/Text","sap/m/Label","sap/base/Log","sap/base/security/encodeURL","sap/suite/ui/commons/TimelineItem","sap/ui/thirdparty/jquery","sap/ui/Device","sap/ui/core/Fragment","sap/ui/core/mvc/XMLView","sap/ui/layout/form/FormElement","sap/ui/layout/ResponsiveFlowLayoutData","sap/ui/model/Context","sap/ui/model/json/JSONModel","cross/fnd/fiori/inbox/attachment/util/AttachmentFormatters","cross/fnd/fiori/inbox/controller/BaseController","cross/fnd/fiori/inbox/util/tools/Application","cross/fnd/fiori/inbox/util/tools/CommonHeaderFooterHelper","cross/fnd/fiori/inbox/util/ActionHelper","cross/fnd/fiori/inbox/util/Forward","cross/fnd/fiori/inbox/util/ForwardSimple","cross/fnd/fiori/inbox/util/SupportInfo","cross/fnd/fiori/inbox/util/Conversions","cross/fnd/fiori/inbox/util/DataManager","cross/fnd/fiori/inbox/util/Resubmit","cross/fnd/fiori/inbox/util/Parser","cross/fnd/fiori/inbox/util/ConfirmationDialogManager","cross/fnd/fiori/inbox/util/EmployeeCard","cross/fnd/fiori/inbox/util/ComponentCache","cross/fnd/fiori/inbox/util/CommonFunctions","cross/fnd/fiori/inbox/util/Utils","sap/ui/core/format/DateFormat","sap/ui/core/Component"],function(M,a,U,V,O,b,T,L,c,d,f,q,D,F,X,g,R,C,J,A,B,h,k,l,m,n,S,p,r,s,P,t,E,u,v,w,x,y){"use strict";return B.extend("cross.fnd.fiori.inbox.view.S3",{extHookOnDataLoaded:null,extHookGetEntitySetsToExpand:null,extHookChangeFooterButtons:null,oModel2:null,oDetailData2:null,oGenericComponent:null,oGenericAttachmentComponent:null,oConfirmationDialogManager:t,fnFormatterSupportsProperty:p.formatterSupportsProperty,oMapCountProperty:{"Comments":"CommentsCount","Attachments":"AttachmentsCount","ProcessingLogs":"ProcessingLogsCount"},bShowAdditionalAttributes:null,bTaskTitleInHeader:null,bStandaloneDetailDeep:null,sCustomTaskTitleAttribute:"CustomTaskTitle",sCustomNumberValueAttribute:"CustomNumberValue",sCustomNumberUnitValueAttribute:"CustomNumberUnitValue",sCustomObjectAttributeValue:"CustomObjectAttributeValue",sCustomCreatedByAttribute:"CustomCreatedBy",oCrossNavigationService:null,OPEN_MODES:["embedIntoDetails","replaceDetails","external","genericEmbedIntoDetails","embedIntoDetailsNestedRouter"],sCustomCreatedByValue:null,_taskSwitchCount:0,embedFioriElements:null,compNameByIntent:{},_lastTargetDisplayed:false,onExit:function(){this.oComponentCache.destroyCacheContent();delete this.oComponentCache;},onInit:function(){var o=this.getView();this.i18nBundle=this.getResourceBundle();this.sResubmitUniqueId=this.createId()+"DLG_RESUBMIT";var e=this.getOwnerComponent().getEventBus();e.subscribe("cross.fnd.fiori.inbox","open_supportinfo",this.onSupportInfoOpenEvent,this);e.subscribe("cross.fnd.fiori.inbox.dataManager","taskCollectionFailed",this.onTaskCollectionFailed.bind(this));e.subscribe("cross.fnd.fiori.inbox.dataManager","showReleaseLoaderOnInfoTab",this.onShowReleaseLoaderOnInfoTab.bind(this));e.subscribe("cross.fnd.fiori.inbox.dataManager","showReleaseLoader",this.onShowReleaseLoader.bind(this));e.subscribe("cross.fnd.fiori.inbox.dataManager","UIExecutionLinkRequest",this.onShowReleaseLoader.bind(this));this.aCA=[];this.aTaskDefinitionData=[];this.aUIExecutionLinkCatchedData=[];this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.attachRoutePatternMatched(this.handleNavToDetail,this);this.oRouter.attachBeforeRouteMatched(this.handleBeforeRouteMatched,this);this.oHeaderFooterOptions={};this.oTabBar=o.byId("tabBar");var i=this.getOwnerComponent().getDataManager();if(i){var j=i.getCacheSize();if(j){this.oComponentCache=new u(j);}else{this.oComponentCache=new u();}}else{this.oComponentCache=new u();}this._setExtensionState(false);this.getView().byId("InvisibleTabStop").addEventDelegate({onsapspace:function(z){var G=this.byId("LogButtonID");this.onLogBtnPress();setTimeout(function(){G.focus();},300);}},this);if(!i.oServiceMetaModel){i.oModel.getMetaModel().loaded().then(function(){i.oServiceMetaModel=i.oModel.getMetaModel();}.bind(this));}this.oAppImp=cross.fnd.fiori.inbox.util.tools.Application.getImpl();},onTaskCollectionFailed:function(){this.getView().setBusy(false);},onShowReleaseLoaderOnInfoTab:function(e,i,o){var I=this.getView().byId("infoTabContent");if(I){I.setBusyIndicatorDelay(0).setBusy(o.bValue);}},onShowReleaseLoader:function(e,i,o){this.getView().setBusyIndicatorDelay(1000);this.getView().setBusy(o.bValue);},createGenericCommentsComponent:function(o){var e=this._getEmbedIntoDetailsNestedRouter()?o.byId("commentsContainerInDetails"):o.byId("commentsContainer");if(!q.isEmptyObject(this.oGenericCommentsComponent)){this.oGenericCommentsComponent.destroy();delete this.oGenericCommentsComponent;}this.oGenericCommentsComponent=sap.ui.getCore().createComponent({name:"cross.fnd.fiori.inbox.comments",componentData:{oModel:this.oModel2}});this.oGenericCommentsComponent.setContainer(e);e.setComponent(this.oGenericCommentsComponent);this.oGenericCommentsComponent.getEventBus().subscribe(null,"commentAdded",this.onCommentPost.bind(this));this.oGenericCommentsComponent.getEventBus().subscribe(null,"businessCardRequested",this.onEmployeeLaunchCommentSender.bind(this));},resetDetailView:function(){if(!this.oModel2)return;this.oModel2.setProperty("/showDefaultView",false);this.oModel2.setProperty("/embedFioriElements",false);this.oModel2.setProperty("/showGenericComponent",false);},handleBeforeRouteMatched:function(){this._suspendTarget(this._lastTargetDisplayed);},handleNavToDetail:function(e){this.oRoutingParameters=e.getParameters().arguments;if(e.getParameter("name")==="detail"||e.getParameter("name")==="detail_deep"){this.bIsTableViewActive=(e.getParameter("name")==="detail_deep"&&!this.bNavToFullScreenFromLog);var i=e.getParameter("arguments").InstanceID;var j=e.getParameters().arguments.contextPath;var o=e.getParameter("arguments").SAP__Origin;if(i&&i.lastIndexOf(":")===(i.length-1)){return;}this._taskSwitchCount++;this.resetDetailView();var z="/TaskCollection(SAP__Origin='"+o+"',InstanceID='"+i+"')";if(q.isEmptyObject(this.getView().getModel().getProperty(z))){var G=this.getOwnerComponent().getDataManager();G.oModel.getMetaModel().loaded().then(function(H){if(H!==this._taskSwitchCount){c.warning("getMetaModel: task switched while waiting!");return;}var I=this;var K=[];if(G.getShowAdditionalAttributes()&&G.checkPropertyExistsInMetadata("CustomAttributeData")){K.push("$expand=CustomAttributeData");}G.setCallFromDeepLinkURL(true);G.oDataRead(z,K,function(H,N){if(H!==this._taskSwitchCount){c.warning("oDataRead: task switched while waiting!");return;}G=I.getOwnerComponent().getDataManager();if(N===undefined||q.isEmptyObject(N)){G.setDetailPageLoadedViaDeepLinking(false);}else{var Q=q.extend(true,{},N);if(I.fnIsTaskInstanceAllowed(Q,G)){G.setDetailPageLoadedViaDeepLinking(true);I.fnPerpareToRefreshData(j,i,o);}else{G.setDetailPageLoadedViaDeepLinking(false);if(G.getStandaloneDetailDeep()&&!G.getTableView()&&!((typeof I.getView().getParent().getParent().isMasterShown==="function")&&I.getView().getParent().getParent().isMasterShown())){I.oRouter.navTo("detail_deep_empty",null,false);}}}}.bind(this,this._taskSwitchCount),function(H,N){if(H!==this._taskSwitchCount){c.warning("oDataRead(fail): task switched while waiting!");return;}I.getOwnerComponent().getDataManager().setDetailPageLoadedViaDeepLinking(false);var G=I.getOwnerComponent().getDataManager();if(G.getStandaloneDetailDeep()&&!G.getTableView()&&!((typeof I.getView().getParent().getParent().isMasterShown==="function")&&I.getView().getParent().getParent().isMasterShown())){var Q=I.i18nBundle.getText("detailDeepEmptyView.closingTabMessage");var W=null;if(N.hasOwnProperty("responseText")&&v.isJson(N.responseText)){W=JSON.parse(N.responseText);}if(W&&W.error&&W.error.message&&W.error.message.value){Q=W.error.message.value+". "+Q;}else if(N.hasOwnProperty("message")){Q=N.message+". "+Q;}I.getView().getModel().sDetailDeepEmptyMessage=Q;I.oRouter.navTo("detail_deep_empty",null,false);}else{I.showEmptyView(null,"detailDeepEmptyView.noLongerAvailableTaskMessage");}}.bind(this,this._taskSwitchCount));}.bind(this,this._taskSwitchCount));}else{this.fnPerpareToRefreshData(j,i,o);}}},fnPerpareToRefreshData:function(e,i,j){if(!this.stayOnDetailScreen||D.system.phone){var o=this.oTabBar.getItems()[0];this.oTabBar.setSelectedItem(o);}else{this.stayOnDetailScreen=false;}var z={sCtxPath:"/"+e,sInstanceID:i,sSAP__Origin:j,bCommentCreated:false};this.refreshData(z);if(!D.system.phone){var G=this.getOwnerComponent().getDataManager();if(G&&G.bOutbox){p.setShellTitleToOutbox(this.getOwnerComponent(),"cross.fnd.fiori.inbox.view.S3");}}},fnIsTaskInstanceAllowed:function(i,o){if(o.bOutbox&&(i.Status==="COMPLETED"||i.Status==="FOR_RESUBMISSION")){return true;}else if(!(o.bOutbox)&&(i.Status==="READY"||i.Status==="RESERVED"||i.Status==="IN_PROGRESS"||i.Status==="EXECUTED")){return true;}else{return false;}},fnGetUploadUrl:function(e){return this.oContext.getModel().sServiceUrl+e+"/Attachments";},fnCreateAttachmentHandle:function(e){var o={fnOnAttachmentChange:this.onAttachmentChange.bind(this),fnOnAttachmentUploadComplete:this.onAttachmentUploadComplete.bind(this),fnOnAttachmentDeleted:this.onAttachmentDeleted.bind(this),detailModel:this.oModel2,uploadUrl:this.fnGetUploadUrl(this.sCtxPath)};return o;},fnRenderComponent:function(o){if(this.oDataManager.bDebug){var e=this.oGenericComponent&&this.oGenericComponent.getId&&this.oGenericComponent.getId();this.oComponentCache.destroyCacheContent(e);}var i=this.oModel2.getData();var j=i?i["TaskDefinitionID"]:"";var z=i?i["SAP__Origin"]:"";var K=j.concat(z);var G=undefined;if(o.ComponentName==="cross.fnd.fiori.inbox.annotationBasedTaskUI"){K=this.generateEscapedComponentKey(K);G=K;}var H=p.formatterPriority.call(this.getView(),z,i?i["Priority"]:"");var I=i?i["StatusText"]:"";if(!I){I=p.formatterStatus.call(this.getView(),z,i?i["Status"]:"");}this.oModel2.setProperty("/PriorityText",H);this.oModel2.setProperty("/StatusText",I);var N=this.oComponentCache.getComponentByKey(K);var Q={sServiceUrl:o.ServiceURL,sAnnoFileURI:o.AnnotationURL,sErrorMessageNoData:this.i18nBundle.getText("annotationcomponent.load.error"),sApplicationPath:o.ApplicationPath,oTaskModel:this.fnCloneTaskModel(i),oQueryParameters:o.QueryParameters};var W={startupParameters:{oParameters:Q,taskModel:this.fnCloneTaskModel(i),inboxAPI:{addAction:this.addAction.bind(this),removeAction:this.removeAction.bind(this),updateTask:this.updateTask.bind(this),getDescription:this.getDescription.bind(this),setShowFooter:this.setShowFooter.bind(this),setShowNavButton:this.setShowNavButton.bind(this),disableAction:this.disableAction.bind(this),disableAllActions:this.disableAllActions.bind(this),enableAction:this.enableAction.bind(this),enableAllActions:this.enableAllActions.bind(this)},inboxInternal:{updateTaskList:this.updateTaskList.bind(this)}},inboxHandle:{attachmentHandle:this.fnCreateAttachmentHandle(this.sCtxPath),tabSelectHandle:{fnOnTabSelect:this.onTabSelect.bind(this)},inboxDetailView:this}};var Y=this.getView();if(!q.isEmptyObject(this.oGenericComponent)){if(!this.oComponentCache.getComponentById(this.oGenericComponent.getId())){this.oGenericComponent.destroy();}}if(q.isEmptyObject(N)){if(o.ApplicationPath&&o.ApplicationPath!==""){var Z=o.ApplicationPath[0]==="/"?o.ApplicationPath:"/"+o.ApplicationPath;var $=o.ComponentName.replace(/\./g,"/");var _={};_[$]=Z;sap.ui.loader.config({paths:_});}try{var a1=function(){return sap.ui.getCore().createComponent({name:o.ComponentName,componentData:W,id:G});};var b1=y.getOwnerComponentFor(this.getView());if(b1&&b1.runAsOwner){N=b1.runAsOwner(a1);}else{N=a1();}if(N&&N.getIsCacheable&&N.getIsCacheable()===true){try{this.oComponentCache.cacheComponent(K,N);}catch(c1){c.error(c1);}}}catch(d1){c.error("Cannot create component"+o.ComponentName+"for smart template rendering. Showing standard task in the detail screen as a fallback: "+d1.message);return false;}}else if(N&&N.updateBinding){N.updateBinding(W);}Y.byId("genericComponentContainer").setComponent(N);this.oGenericComponent=N;return true;},_suspendTarget:function(e){if(!e){return;}var i=this.oRouter.getTargets();var j=i.getTarget(e);if(j===undefined){return;}j.suspend();},getComponentViaRoutingTarget:function(i,e,j,o,I,z,G){var H=this.oRouter.getTargets();var K=false;if(H.getTarget(e)===undefined){H.addTarget(e,{name:e,options:j,type:"Component",controlAggregation:"flexContent",id:e,controlId:"fioriElementsContainer",parent:"myInboxDetail"});K=true;}H.display({name:e,prefix:i,routeRelevant:true,ignoreInitialHash:true}).then(function(N,Q,W,Y){if(W!==this._taskSwitchCount){c.warning("target.display: task switched while waiting!");return;}this.loadDecisionOptions(I,z,"decisionOptions");if(N){return;}var Z=Y[0].view.getComponentInstance();Z.navigateBasedOnStartupParameter(Q);}.bind(this,K,JSON.parse(JSON.stringify(o)),this._taskSwitchCount)).catch(function(N,Q){if(N!==this._taskSwitchCount){c.warning("target.display(fail): task switched while waiting!");return;}c.error(Q);this.fnViewTaskInDefaultView(I,z,G);}.bind(this,this._taskSwitchCount));this._lastTargetDisplayed=e;},generateEscapedComponentKey:function(e){return"inb_"+btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/[=]/g,"");},fnParseComponentParameters:function(e){var o=P.fnParseComponentParameters(e);this.isGenericComponentRendered=!q.isEmptyObject(o)?this.fnRenderComponent(o):false;this.oModel2.setProperty("/showGenericComponent",this.isGenericComponentRendered);if(this.isGenericComponentRendered){this.oModel2.setProperty("/embedFioriElements",false);this.oModel2.setProperty("/showDefaultView",false);this.embedFioriElements=false;this.showHideSideContent();}this.fnShowHideDetailScrollBar(!this.isGenericComponentRendered);},fnCloneTaskModel:function(o){var e=["SAP__Origin","InstanceID","TaskDefinitionID","TaskDefinitionName","TaskTitle","Priority","PriorityText","Status","StatusText","CreatedOn","CreatedBy","CreatedByName","Processor","ProcessorName","SubstitutedUser","SubstitutedUserName","StartDeadLine","CompletionDeadLine","ExpiryDate","IsEscalated","PriorityNumber"];var j={};for(var i=0;i<e.length;i++){if(o.hasOwnProperty(e[i])){j[e[i]]=o[e[i]];}}var z=this.getView();var G=z.getModel("detailClone");if(!G){G=new J();z.setModel(G,"detailClone");}G.setData(j,false);return G;},fnShowHideDetailScrollBar:function(e){if(e){this.byId("mainPage").setEnableScrolling(true);}else{this.byId("mainPage").setEnableScrolling(false);}},switchToOutbox:function(){return this.oDataManager.bOutbox?true:false;},_updateDetailModel:function(i,e){if(this.oModel2){this.oModel2.setData(i,e);this.fnCloneTaskModel(this.oModel2.getData());}else{c.error("Detail Model is null.");}},_getCustomAttributesValue:function(I){var e=I.CustomAttributeData;var j=[];for(var i=0;i<e.length;i++){j[i]=this.getView().getModel().getProperty("/"+e[i]);}return j;},refreshData:function(o,e){if(e!==undefined){this.aTaskDefinitionData=e;}else{var i=this.getView().getModel("taskDefinitionsModel");this.aTaskDefinitionData=i?i.getData():[];}if(!this.bIsControllerInited){var j=this.getOwnerComponent();this.oDataManager=j.getDataManager();if(!this.oDataManager){var z=this.getView().getModel();this.oDataManager=new r(this);this.oDataManager.setModel(z);j.setDataManager(this.oDataManager);}this.oDataManager.attachItemRemoved(this._handleItemRemoved.bind(this));this.oDataManager.attachRefreshDetails(this._handleDetailRefresh.bind(this));this.bIsControllerInited=true;}if(this.bIsTableViewActive===true){this.aTaskDefinitionData=this.oDataManager.getTaskDefinitionModel();}this.clearCustomAttributes();var G=this.getView();this.oContext=new C(G.getModel(),o.sCtxPath);G.setBindingContext(this.oContext);this.sCtxPath=o.sCtxPath;var I=q.extend(true,{},G.getModel().getData(this.oContext.getPath(),this.oContext));if(q.isEmptyObject(I)){I=q.extend(true,{},G.getModel().getData(encodeURI(this.oContext.getPath()),this.oContext));}if(q.isEmptyObject(I)&&this._getStandaloneDetailDeep()&&!this.oDataManager.getTableView()&&!((typeof this.getView().getParent().getParent().isMasterShown==="function")&&this.getView().getParent().getParent().isMasterShown())){this.oRouter.navTo("detail_deep_empty",null,false);return;}if(q.isEmptyObject(I)){this.showEmptyView(null,"detailDeepEmptyView.noLongerAvailableTaskMessage");return;}var H=this._getActionHelper();this.getOwnerComponent().getEventBus().publish("cross.fnd.fiori.inbox","storeNextItemsToSelect",{"sOrigin":I.SAP__Origin,"sInstanceID":I.InstanceID});if(this._getShowAdditionalAttributes()===true){I=this._processCustomAttributesData(I);}if(I.TaskSupports&&!I.TaskSupports.WorkflowLog){I.TaskSupports.WorkflowLog=false;}if(!this.oModel2){this.oModel2=new J();G.setModel(this.oModel2,"detail");}this._updateDetailModel(I,true);this.oModel2.setProperty("/CustomAttributeData",I.CustomAttributeData?I.CustomAttributeData:[]);this.oModel2.setProperty("/sServiceUrl",G.getModel().sServiceUrl);this.oModel2.setProperty("/SapUiTheme",H._getThemeandLanguageLocaleParams()["sap-ui-theme"]);var K=this;this._updateHeaderTitle(I);var N=G.byId("genericComponentContainer");var Q=N&&N.getComponent()?N.getComponent():null;if(Q){var W=this.oComponentCache.getComponentById(Q)||null;if(!W){var Y=sap.ui.getCore().getComponent(Q);if(Y){Y.destroy();}}}var Z=function(e,a1){if(K.extHookOnDataLoaded){if(!e.CustomAttributeData){e.CustomAttributeData={};e.CustomAttributeData.results=this._getCustomAttributesValue(I);}K.extHookOnDataLoaded(e);}if(K.aCA.length>0){K.clearCustomAttributes();}if(this._getShowAdditionalAttributes()===true){if(e.CustomAttributeData&&e.CustomAttributeData.hasOwnProperty("__deferred")){delete e.CustomAttributeData;}}if((!this.aTaskDefinitionData||q.isEmptyObject(this.aTaskDefinitionData))&&a1&&a1[0]&&a1[0].TaskDefinitionID){var b1=a1[0].TaskDefinitionID;var c1={};c1.results=a1;this.aTaskDefinitionData=[];this.aTaskDefinitionData[0]=new Object();this.aTaskDefinitionData[0].CustomAttributeDefinitionData=c1;this.aTaskDefinitionData[0].TaskDefinitionID=b1;}K._updateDetailModel(e,true);K.oDetailData2=e;var d1=K.byId("tabBar").getSelectedKey();if(d1==="NOTES"){K.fnSetIconForCommentsFeedInput();this.fnFetchDataOnTabSelect("Comments");}else if(d1==="ATTACHMENTS"){this.fnFetchDataOnTabSelect("Attachments");}else if(d1==="OBJECTLINKS"){K.fnFetchObjectLinks();}else if(d1==="DESCRIPTION"){K.byId("DescriptionContent").rerender();}if(!this._getShowAdditionalAttributes()){if(e.CustomAttributeData.results&&e.CustomAttributeData.results.length>0){K.oModel2.setProperty("/CustomAttributeData",e.CustomAttributeData.results);}}else if(this._getShowAdditionalAttributes()===true){if(K.oModel2.getData().CustomAttributeDefinitionData==null&&a1){K.oModel2.setProperty("/CustomAttributeDefinitionData",a1);}}var e1=K._createCustomAttributesOnDataLoaded.bind(K);e1(a1);};var $=null;if(this.bIsTableViewActive){$=this.fnNavBackToTableVw.bind(this);}else if(D.system.phone&&!this.bNavToFullScreenFromLog){$=this.fnOnNavBackInMobile.bind(this);}else if(this.bNavToFullScreenFromLog){$=this.fnOnNavBackFromLogDescription.bind(this);}if(this.getOwnerComponent().oShellUIService&&$){this.getOwnerComponent().oShellUIService.setBackNavigation($);}if(this.oHeaderFooterOptions){this.oHeaderFooterOptions=q.extend(this.oHeaderFooterOptions,{oPositiveAction:null,oNegativeAction:null,buttonList:[],oJamOptions:null,oEmailSettings:null,oUpDownOptions:null,onBack:(this.getOwnerComponent().oShellUIService?null:$)});this.refreshHeaderFooterOptions();}if(this.oModel2!=null){this.fnClearCachedData();}var _=function(a1,b1){if(a1!==this._taskSwitchCount){c.warning("fetchUIExecutionLinkCallback: task switched while waiting!");return;}I.UIExecutionLink=b1;K.oModel2.setProperty("/UIExecutionLink",b1);this.fnHandleIntentValidationAndNavigation(I,o,Z);}.bind(this,this._taskSwitchCount);this.oDataManager.fetchUIExecutionLink(I,_.bind(this),_.bind(this));},loadDecisionOptions:function(i,o,G){var I=i.TaskSupports&&i.TaskSupports.UIExecutionLink;if(!this.oDataManager.bOutbox&&i.Status!=="COMPLETED"&&i.Status!=="FOR_RESUBMISSION"){this.oDataManager.readDecisionOptions(i.SAP__Origin,i.InstanceID,i.TaskDefinitionID,function(e,j){if(e!==this._taskSwitchCount){c.warning("readDecisionOptions: task switched while waiting!");return;}this.fnValidateDecisionOptionsAndCreatButtons(I,j,i.UIExecutionLink,o.sSAP__Origin);}.bind(this,this._taskSwitchCount),function(e,j){c.error("Error while loading decision options");if(e!==this._taskSwitchCount){c.warning("readDecisionOptions(fail): task switched while waiting!");return;}this.fnValidateDecisionOptionsAndCreatButtons(I,[],i.UIExecutionLink,o.sSAP__Origin);}.bind(this,this._taskSwitchCount),false,G);}else{this.fnValidateDecisionOptionsAndCreatButtons(I,[],i.UIExecutionLink,o.sSAP__Origin);}},fnHandleIntentValidationAndNavigation:function(i,o,e){var j=this;var z=i.UIExecutionLink.GUI_Link;var G=this._getParsedParamsForIntent(z);var H=this._getCrossNavigationService();if(G&&H){var I=this._getIntentParam(G);H.isNavigationSupported(I,cross.fnd.fiori.inbox.util.tools.Application.getImpl().getComponent()).done(function(K,N){if(K!==this._taskSwitchCount){c.warning("isNavigationSupported: task switched while waiting!");return;}var Q=j._getSupportedOpenMode(N);if(Q){j.fnHandleIntentNavigation(G,Q,i,o,e);}else{j.fnViewTaskInDefaultView(i,o,e);}}.bind(this,this._taskSwitchCount)).fail(function(K){if(K!==this._taskSwitchCount){c.warning("isNavigationSupported(fail): task switched while waiting!");return;}j.fnViewTaskInDefaultView(i,o,e);}.bind(this,this._taskSwitchCount));}else{this.fnViewTaskInDefaultView(i,o,e);}},fnHandleIntentNavigation:function(o,e,i,j,z){o.params.openMode=e;switch(e){case"embedIntoDetails":case"genericEmbedIntoDetails":case"embedIntoDetailsNestedRouter":this.fnRenderIntentBasedApp(o,e,i,j,z);break;case"replaceDetails":case"external":this.oEmbedModeIntentParams={};this.oEmbedModeIntentParams[j.sSAP__Origin+"_"+j.sInstanceID]=q.extend({"OpenInEmbedMode":(e==="replaceDetails")},o);this.fnViewTaskInDefaultView(i,j,z);break;default:}},fnRenderIntentBasedApp:function(o,e,i,j,z){var N=o.semanticObject+"-"+o.action;var G="#"+N;this.embedFioriElements=(o.params.openMode==="embedIntoDetailsNestedRouter")?true:false;this.showHideSideContent();var H=this.byId("genericComponentContainer");var I=H&&H.getComponent()?H.getComponent():null;if(I){var K=this.oComponentCache.getComponentById(I)||null;if(!K){var Q=sap.ui.getCore().getComponent(I);if(Q){Q.destroy();}}}var W=this._getCrossNavigationService();var Y={startupParameters:{taskModel:this.fnGetTaskModelClone(j),queryParameters:o.params,inboxAPI:{addAction:this.addAction.bind(this),removeAction:this.removeAction.bind(this),updateTask:this.updateTask.bind(this),getDescription:this.getDescription.bind(this),setShowFooter:this.setShowFooter.bind(this),setShowNavButton:this.setShowNavButton.bind(this),disableAction:this.disableAction.bind(this),disableAllActions:this.disableAllActions.bind(this),enableAction:this.enableAction.bind(this),enableAllActions:this.enableAllActions.bind(this)},inboxInternal:{updateTaskList:this.updateTaskList.bind(this)}},onTaskUpdate:this.fnDelegateTaskRefresh.bind(this)};if(this.embedFioriElements&&w.isString(this.compNameByIntent[G])){this.oModel2.setProperty("/embedFioriElements",true);this.oModel2.setProperty("/showGenericComponent",false);this.oModel2.setProperty("/showDefaultView",false);this.getComponentViaRoutingTarget(N,this.compNameByIntent[G],{componentData:Y},o.params,i,j,z);this.fnGetTabCountersForSelectedTask(i,j,z);}else if(this.embedFioriElements&&!this.compNameByIntent[G]){this.compNameByIntent[G]=true;var Z="?"+this.fnCreateURLParameters(o.params);W.createComponentData(G+Z).then(function($,_,a1){this.compNameByIntent[$]=a1.componentProperties.name;if(this.embedFioriElements&&$===G){this.oModel2.setProperty("/embedFioriElements",true);this.oModel2.setProperty("/showGenericComponent",false);this.oModel2.setProperty("/showDefaultView",false);var b1=Object.assign(Y,a1.componentData);var c1=Object.assign({componentData:b1},a1.appPropertiesSafe.applicationDependencies);this.getComponentViaRoutingTarget(N,a1.componentProperties.name,c1,_,i,j,z);this.fnGetTabCountersForSelectedTask(i,j,z);}}.bind(this,G,JSON.parse(JSON.stringify(o.params)))).catch(function($,_){if($!==this._taskSwitchCount){c.warning("createComponentData(fail): task switched while waiting!");return;}c.error(_);this.fnViewTaskInDefaultView(i,j,z);}.bind(this,this._taskSwitchCount));}else if(!this.embedFioriElements){var Z="?"+this.fnCreateURLParameters(o.params);W.createComponentInstance(G+Z,{componentData:Y},this.getOwnerComponent()).done(function($,_){if($!==this._taskSwitchCount){c.warning("createComponentInstance: task switched while waiting!");return;}this.oModel2.setProperty("/embedFioriElements",false);this.oModel2.setProperty("/showGenericComponent",true);this.oModel2.setProperty("/showDefaultView",false);this.embedFioriElements=false;this.showHideSideContent();this.byId("genericComponentContainer").setComponent(_);if(e==="genericEmbedIntoDetails"){this.setShowFooter(false);}else if(e==="embedIntoDetails"){this.loadDecisionOptions(i,j,"decisionOptions");}}.bind(this,this._taskSwitchCount)).fail(function($,_){if($!==this._taskSwitchCount){c.warning("createComponentInstance(fail): task switched while waiting!");return;}if(e==="genericEmbedIntoDetails"){this.setShowFooter(false);}c.error(_);this.fnViewTaskInDefaultView(i,j,z);}.bind(this,this._taskSwitchCount));}},updateTask:function(e,i){var o=new q.Deferred();var j=this;if(!e||!i){o.reject("Input parameters SAP__Origin and TaskInstanceId are mandatory");return o.promise();}var z=function(H){o.resolve();var I=j.i18nBundle.getText("dialog.success.complete");if(j._getStandaloneDetailDeep()&&!j.oDataManager.getTableView()&&!((typeof j.getView().getParent().getParent().isMasterShown==="function")&&j.getView().getParent().getParent().isMasterShown())){j.getView().getModel().sDetailDeepEmptyMessage=I+". "+j.i18nBundle.getText("detailDeepEmptyView.closingTabMessage");a.show(I,{duration:1000,onClose:j.oRouter.navTo.bind(j.oRouter,"detail_deep_empty",null,false)});return;}else{a.show(I);}if(j.bIsTableViewActive){j.fnNavBackToTableVw();}if(D.system.phone){j.fnOnNavBackInMobile();}};var G=function(H){o.reject(H.message);};this.oDataManager.fnUpdateSingleTask(e,i,z,G);return o.promise();},updateTaskList:function(){this.getOwnerComponent().getEventBus().publish("cross.fnd.fiori.inbox","refreshListInternal");},getDescription:function(e,i){var o=new q.Deferred();if(!e||!i){o.reject("Input parameters SAP__Origin and TaskInstanceId are mandatory");return o.promise();}var j=function(G){o.resolve(G);};var z=function(G){o.reject(G.message);};this.oDataManager.readDescription(e,i,j,z);return o.promise();},_setExtensionState:function(e){if(e){this._isExtended=true;}else{this._isExtended=false;}},_getExtensionState:function(){if(this._isExtended){return true;}else{return false;}},isMainScreen:function(){if(this._getExtensionState()){return false;}else{if(this._oControlStore.oBackButton){return false;}return"X";}},setShowFooter:function(e){if(e){this.oHeaderFooterOptions=q.extend(this.oHeaderFooterOptions,this._oPreviousHeaderFooterOptions);this.refreshHeaderFooterOptions();this._setExtensionState(false);}else{this._setExtensionState(true);this._oPreviousHeaderFooterOptions=q.extend({},this.oHeaderFooterOptions);this.oHeaderFooterOptions=q.extend(this.oHeaderFooterOptions,{oPositiveAction:null,oNegativeAction:null,buttonList:null,oJamOptions:null,oEmailSettings:null,bSuppressBookmarkButton:true});this.refreshHeaderFooterOptions();if(this.getView().getContent()[0].getShowFooter()){c.error("Hiding footer failed");}}},setShowNavButton:function(e,i){if(e){if(i){this._backButtonHandler=i;}else{this._backButtonHandler=this.onNavButtonPress.bind(this);}}else{this._backButtonHandler=null;}this.oHeaderFooterOptions=q.extend(this.oHeaderFooterOptions,{onBack:this._backButtonHandler});this.refreshHeaderFooterOptions();},onNavButtonPress:function(e){if(window.history.length>0){window.history.back();}else{c.error("Navigation history does not exist. Ensure that navigation history is maintained or provide custom event handler for back navigation button through setShowNavButton API");}},fnGetTaskModelClone:function(o){var e=this.getView();var i=new C(e.getModel(),o.sCtxPath);var I=q.extend(true,{},e.getModel().getData(i.getPath(),i));return this.fnCloneTaskModel(I);},fnCreateURLParameters:function(e){return Object.keys(e).map(function(i){return[i,e[i]].map(encodeURIComponent).join("=");}).join("&");},fnValidateDecisionOptionsAndCreatButtons:function(i,e,j,o){e=e?e:[];if(i){this.createDecisionButtons(e,j,o);}else{this.createDecisionButtons(e,{},o);}},fnDelegateTaskRefresh:function(){var N=this.oRoutingParameters;var e=N.SAP__Origin;var i=N.InstanceID;if(N&&e&&i){this.oDataManager.fnUpdateSingleTask(e,i);}},fnNavigateToApp:function(o,e){if(!e){this._getCrossNavigationService().toExternal({target:{semanticObject:o.semanticObject,action:o.action},params:o.params,appSpecificRoute:o.appSpecificRoute});}else{var i=o.params.openMode;this.fnEmbedApplicationInDetailView(o,i);}},fnViewTaskInDefaultView:function(i,o,e){this.oModel2.setProperty("/showGenericComponent",false);this.oModel2.setProperty("/embedFioriElements",false);this.oModel2.setProperty("/showDefaultView",true);this.embedFioriElements=false;this.showHideSideContent();this.fnGetDetailsForSelectedTask(i,o,e);},fnGetTabCountersForSelectedTask:function(i,o,e){var j=[];var I=this.oModel2.getData();var z=[];var G=I.UIExecutionLink;if(!G.GUI_Link){G.GUI_Link="";}if(this.fnFormatterSupportsProperty(I.TaskSupports.Comments,I.SupportsComments)){z.push("Comments");}if(this.fnFormatterSupportsProperty(I.TaskSupports.Attachments,I.SupportsAttachments)){z.push("Attachments");}if(I.TaskSupports.TaskObject&&this.oDataManager.bShowTaskObjects){z.push("TaskObjects");}this.oDataManager.readDataOnTaskSelection(o.sCtxPath,j,z,o.sSAP__Origin,o.sInstanceID,I.TaskDefinitionID,i,function(H,K,N,Q){if(H!==this._taskSwitchCount){return;}if(Q.sCommentsCount!=null&&Q.sCommentsCount!==""){this.oModel2.setProperty("/CommentsCount",Q.sCommentsCount);}if(Q.sAttachmentsCount!=null&&Q.sAttachmentsCount!==""){this.oModel2.setProperty("/AttachmentsCount",Q.sAttachmentsCount);}if(Q.sTaskObjectsCount!=null&&Q.sTaskObjectsCount!==""){this.oModel2.setProperty("/ObjectLinksCount",Q.sTaskObjectsCount);this.fnHandleNoTextCreation("ObjectLinks");}K.UIExecutionLink=G;e.call(this,K,N);}.bind(this,this._taskSwitchCount));},fnGetDetailsForSelectedTask:function(i,o,e){var j=this;var z=j.oModel2.getData().TaskSupports;var I=(z&&z.UIExecutionLink)?z.UIExecutionLink:false;j.fnParseComponentParameters(I?i.UIExecutionLink.GUI_Link:"");var G=[];if(z&&z.Description){G.push("Description");}if(!this._getShowAdditionalAttributes()&&z&&z.CustomAttributeData){G.push("CustomAttributeData");}if(this.extHookGetEntitySetsToExpand){var H=this.extHookGetEntitySetsToExpand();G.push.apply(G,H);}if(!i.UIExecutionLink.GUI_Link){i.UIExecutionLink.GUI_Link="";}var K=j.oModel2.getData();if(!j.isGenericComponentRendered){var N=[];if(this.fnFormatterSupportsProperty(K.TaskSupports.Comments,K.SupportsComments)){N.push("Comments");}if(this.fnFormatterSupportsProperty(K.TaskSupports.Attachments,K.SupportsAttachments)){N.push("Attachments");}if(K.TaskSupports.TaskObject&&this.oDataManager.bShowTaskObjects){N.push("TaskObjects");}j.oDataManager.readDataOnTaskSelection(o.sCtxPath,G,N,o.sSAP__Origin,o.sInstanceID,K.TaskDefinitionID,i,function(W,Y,Z,$,_){if(W!==this._taskSwitchCount){c.warning("readDataOnTaskSelection: task switched while waiting!");return;}if($.sCommentsCount!==null&&$.sCommentsCount!==""){j.oModel2.setProperty("/CommentsCount",$.sCommentsCount);}if($.sAttachmentsCount!==null&&$.sAttachmentsCount!==""){j.oModel2.setProperty("/AttachmentsCount",$.sAttachmentsCount);}if($.sTaskObjectsCount!==null&&$.sTaskObjectsCount!==""){j.oModel2.setProperty("/ObjectLinksCount",$.sTaskObjectsCount);j.fnHandleNoTextCreation("ObjectLinks");}j.fnValidateDecisionOptionsAndCreatButtons(i.TaskSupports.UIExecutionLink,_,i.UIExecutionLink,o.sSAP__Origin);Y.UIExecutionLink=i.UIExecutionLink;e.call(j,Y,Z);}.bind(this,this._taskSwitchCount));}else{var Q="GenericComponentRendered";j.oDataManager.setDetailPageLoaded(true);if(j.byId("attachmentComponent")||j.byId("attachmentComponentInDetails")){j.fnCountUpdater("Attachments",j.oModel2.getData().SAP__Origin,j.oModel2.getData().InstanceID,Q);}if(j.byId("commentsContainer")||j.byId("commentsContainerInDetails")){j.fnCountUpdater("Comments",j.oModel2.getData().SAP__Origin,j.oModel2.getData().InstanceID,Q);}if(j._getObjectLinksList()){j.fnCountUpdater("ObjectLinks",j.oModel2.getData().SAP__Origin,j.oModel2.getData().InstanceID,Q);}this.loadDecisionOptions(i,o,Q);}},clearCustomAttributes:function(){if(this.aCA.length>0){for(var i=0;i<this.aCA.length;i++){this.aCA[i].destroy();}this.aCA=[];}},onAttachmentChange:function(e){var o=e.getSource();var i=e.getParameters().getParameters().files[0].name;if(o.getHeaderParameters()){o.destroyHeaderParameters();}var j=i.lastIndexOf(".");var z="";if(j!=-1){z=i.substr(j+1);i=i.substr(0,j);}o.addHeaderParameter(new U({name:"x-csrf-token",value:this.getXsrfToken()}));o.addHeaderParameter(new U({name:"slug",value:encodeURIComponent(i)}));o.addParameter(new U({name:"x-csrf-token",value:this.getXsrfToken()}));o.addParameter(new U({name:"slug",value:i}));o.addHeaderParameter(new U({name:"Accept",value:"application/json"}));o.addParameter(new U({name:"Accept",value:"application/json"}));if(z!==""){o.addHeaderParameter(new U({name:"extension",value:z}));o.addParameter(new U({name:"extension",value:z}));}},onAttachmentUploadComplete:function(e){var i=this.oModel2.getData();var j=this;j.oEventSource=e.getSource();var o=function(){this.oEventSource.updateAggregation("items");this.oEventSource.rerender();};if(e.getParameters().getParameters().status==201){var z=JSON.parse(e.getParameters().files[0].responseRaw).d;if(i.Attachments&&i.Attachments.results){i.Attachments.results.unshift(z);}else{i.Attachments={results:[z]};}i.AttachmentsCount=i.Attachments.results.length;this._updateDetailModel(i);j.fnHandleAttachmentsCountText("Attachments");a.show(this.i18nBundle.getText("dialog.success.attachmentUpload"));}else{var G=this.i18nBundle.getText("dialog.error.attachmentUpload");M.error(G,{onClose:o.bind(j)});}},onAttachmentDeleted:function(e){var j=this;var o=e.getParameters().documentId;var I=this.oModel2.getData();var z=this._getUploadCollectionControl();this._setBusyIncdicatorOnDetailControls(z,true);this.oDataManager.deleteAttachment(I.SAP__Origin,I.InstanceID,o,function(){var G=I.Attachments.results;q.each(G,function(i,H){if(H.ID===o){G.splice(i,1);return false;}});I.Attachments.results=G;I.AttachmentsCount=G.length;if(I.AttachmentsCount===0){z.setNoDataText(this.i18nBundle.getText("view.Attachments.noAttachments"));}this._setBusyIncdicatorOnDetailControls(z,false);this._updateDetailModel(I);j.fnHandleAttachmentsCountText("Attachments");a.show(this.i18nBundle.getText("dialog.success.attachmentDeleted"));}.bind(this),function(i){this._setBusyIncdicatorOnDetailControls(z,false);var G=this.i18nBundle.getText("dialog.error.attachmentDelete");M.error(G);}.bind(this));},getXsrfToken:function(){var i=this.getView().getModel().getHeaders()["x-csrf-token"];if(!i){this.getView().getModel().refreshSecurityToken(function(e,o){i=o.headers["x-csrf-token"];},function(){M.error("Could not get XSRF token");},false);}return i;},onFileUploadFailed:function(e){var i=this.i18nBundle.getText("dialog.error.attachmentUpload");M.error(i,{details:v.fnRemoveHtmlTags(e.getParameters().exception)});},addShareOnJamAndEmail:function(o){var j={fGetShareSettings:this.getJamSettings.bind(this)};var e={sSubject:this.getMailSubject(),fGetMailBody:this.getMailBody.bind(this)};o.oJamOptions=j;o.oEmailSettings=e;this.oHeaderFooterOptions=q.extend(this.oHeaderFooterOptions,{oJamOptions:o.oJamOptions,oEmailSettings:o.oEmailSettings});},_getDescriptionForShare:function(e){var o=this.oModel2.getData();var i="\n\n"+this.i18nBundle.getText("share.email.body.detailsOfTheItem")+"\n\n";var j=x.getDateInstance();if(o.TaskTitle&&o.TaskTitle.trim()!==""){i+=this.i18nBundle.getText("item.taskTitle",o.TaskTitle.trim())+"\n";}if(o.Priority&&o.Priority!==""){i+=this.i18nBundle.getText("item.priority",p.formatterPriority.call(this.getView(),o.SAP__Origin,o.Priority))+"\n";}if(o.CompletionDeadLine){i+=this.i18nBundle.getText("item.dueDate",j.format(o.CompletionDeadLine,true))+"\n";}if(e&&e.trim()!==""){i+=this.i18nBundle.getText("item.description",e)+"\n";}else if((o.Description)&&(o.Description.Description)&&(o.Description.Description.trim()!=="")){i+=this.i18nBundle.getText("item.description",this._getTrimmedString(o.Description.Description))+"\n";}var z=o.CreatedByName;if(!z||z.trim()===""){z=o.CreatedBy;}if(z&&z.trim()!==""){i+=this.i18nBundle.getText("item.createdBy",z)+"\n";}if(o.CreatedOn){i+=this.i18nBundle.getText("item.createdOn",j.format(o.CreatedOn,true))+"\n";}if(o.CompletedOn){i+=this.i18nBundle.getText("item.completedOn",j.format(o.CompletedOn,true))+"\n";}return i;},_getDescriptionForShareInMail:function(e){var i=this._getDescriptionForShare(e);i+=this.i18nBundle.getText("share.email.body.link",window.location.href.split("(").join("%28").split(")").join("%29").split(",").join("%2C"))+"\n";return i;},getJamSettings:function(){return{object:{id:window.location.href,share:this.getJamDescription()}};},getJamDescription:function(){var e=this._getDescriptionForShare();return e;},getMailSubject:function(){var o=this.oModel2.getData();var e=p.formatterPriority.call(this.getView(),o.SAP__Origin,o.Priority);var i=o.CreatedByName;var j=o.TaskTitle;return p.formatterMailSubject.call(this,e,i,j);},getMailBody:function(){if(D.browser.msie){return window.location.href.split("(").join("%28").split(")").join("%29").split(",").join("%2C");}var e=this._getDescriptionForShareInMail();var i=this.getMailSubject();var j=sap.m.URLHelper.normalizeEmail(null,i,e);if(j.length>2000){var o=this.oModel2.getData();var z=this._getDescriptionForShareInMail("...");var G=sap.m.URLHelper.normalizeEmail(null,i,z);var H=2000-G.length;var I="";if(o.Description&&o.Description.Description){I=window.encodeURIComponent(this._getTrimmedString(o.Description.Description));}I=I.substring(0,H);var K=false;while(!K||I.length==0){K=true;try{I=window.decodeURIComponent(I);}catch(N){I=I.substring(0,I.length-1);K=false;}}I=I.substring(0,I.length-3)+"...";var Q=this._getDescriptionForShareInMail(I);return Q;}return e;},_getIntentParam:function(o){var e=[];for(var i=0;i<this.OPEN_MODES.length;i++){e.push({target:{semanticObject:o.semanticObject,action:o.action},params:q.extend({},o.params,{"openMode":this.OPEN_MODES[i]})});}return e;},_getIntentWithOutParam:function(o){var e=[{target:{semanticObject:o.semanticObject,action:o.action},params:o.params}];return e;},_getTrimmedString:function(e){return e.replace(/\s+/g," ").trim();},_handleItemRemoved:function(e){if(D.system.phone&&!this.getView().getParent().getParent().isMasterShown()){if(!this.stayOnDetailScreen){this.oRouter.navTo("master",{},D.system.phone);window.history.back();}else{var o={sCtxPath:this.getView().getBindingContext().getPath(),sInstanceID:this.oModel2.getData().InstanceID,sSAP__Origin:this.oModel2.getData().SAP__Origin,bCommentCreated:true};this.refreshData(o);this.stayOnDetailScreen=false;}}},_handleDetailRefresh:function(e){var o;var i=e.getParameter("bIsTableViewActive");var j=this.getView();if(i||D.system.phone||(this._getStandaloneDetailDeep()&&!this.oDataManager.getTableView()&&!((typeof this.getView().getParent().getParent().isMasterShown==="function")&&this.getView().getParent().getParent().isMasterShown()))){var I=q.extend(true,{},j.getModel().getData(this.oContext.getPath(),this.oContext));if(q.isEmptyObject(I)){I=q.extend(true,{},j.getModel().getData(encodeURI(this.oContext.getPath()),this.oContext));}var z=e.getParameter("sAction");var G=e.getParameter("sStatus");if(I.Status==="COMPLETED"||I.Status==="FOR_RESUBMISSION"||((z&&z==="FORWARD")&&(G&&G==="Success"))){if(this._getStandaloneDetailDeep()&&!this.oDataManager.getTableView()&&!((typeof this.getView().getParent().getParent().isMasterShown==="function")&&this.getView().getParent().getParent().isMasterShown())){j.getModel().bCheckPassed=true;return;}if(i){this.fnNavBackToTableVw();}else{this.fnOnNavBackInMobile();}}else if(this.isGenericComponentRendered){o={sCtxPath:this.getView().getBindingContext().getPath(),sInstanceID:this.oModel2.getData().InstanceID,sSAP__Origin:this.oModel2.getData().SAP__Origin,bCommentCreated:true};this.refreshData(o);}else{if(I.TaskSupports&&I.TaskSupports.CustomAttributeData){I=this._processCustomAttributesData(I);}this._updateDetailModel(I,true);var H=this.oDataManager.getDataFromCache("DecisionOptions",I);H=H?H:[];var K=this.oDataManager.getDataFromCache("UIExecutionLink",I);K=K?K:{};var N=I.TaskSupports.UIExecutionLink;K=N?K:{};this.createDecisionButtons(H,K,this.oModel2.getData().SAP__Origin);}}else{o={sCtxPath:this.getView().getBindingContext().getPath(),sInstanceID:this.oModel2.getData().InstanceID,sSAP__Origin:this.oModel2.getData().SAP__Origin,bCommentCreated:true};this.refreshData(o);}},_updateHeaderTitle:function(o){if(o){var e;if(this._getTaskTitleInHeader()){e=this._getShowAdditionalAttributes()?p.formatterTaskTitle.call(this.getView(),o.TaskTitle,o.CustomAttributeData):o.TaskTitle;}else{e=o.TaskDefinitionName;}if(!e){e=this.i18nBundle.getText("ITEM_DETAIL_DISPLAY_NAME");}this.oHeaderFooterOptions=q.extend(this.oHeaderFooterOptions,{sDetailTitle:e});this.refreshHeaderFooterOptions();}},_isTaskConfirmable:function(i){if(i.Status==="EXECUTED"){return true;}else{return false;}},createDecisionButtons:function(e,o,j){var z=null;var N=null;var G=[];if(this.oHeaderFooterOptions){z=this.oHeaderFooterOptions.oPositiveAction;N=this.oHeaderFooterOptions.oNegativeAction;}var H=1;var I=0;var K=this;var Q=this.oModel2.getData(),W=K._getActionHelper();var Y=false;var Z=false;var $=this._getParsedParamsForIntent(o.GUI_Link);var _=this._getCrossNavigationService();if($&&_){var a1=this._getIntentParam($);}if(!this.switchToOutbox()&&Q.Status!=="COMPLETED"&&Q.Status!=="FOR_RESUBMISSION"){if(!this._isTaskConfirmable(Q)){for(var i=0;i<e.length;i++){var b1=e[i];b1.InstanceID=Q.InstanceID;b1.SAP__Origin=j;if(!b1.Nature){I=400+H;H++;}else if(b1.Nature.toUpperCase()==="POSITIVE"){I=H;H++;}else if(b1.Nature.toUpperCase()==="NEGATIVE"){I=200+H;H++;}else{I=400+H;H++;}G.push({iDisplayOrderPriority:I,nature:b1.Nature,sBtnTxt:b1.DecisionText,onBtnPressed:(function(f1){return function(){K.showDecisionDialog(K.oDataManager.FUNCTION_IMPORT_DECISION,f1,true);};})(b1)});}}else{I=H;H++;z={iDisplayOrderPriority:I,sI18nBtnTxt:"XBUT_CONFIRM",onBtnPressed:(function(f1){return function(){K.showConfirmationDialog(K.oDataManager.FUNCTION_IMPORT_CONFIRM,Q);};})(Q)};}if((Q.TaskSupports.ProcessingLogs||Q.TaskSupports.WorkflowLog)&&K.oDataManager.getShowLogEnabled()){I=1200+H;H++;G.push({sId:"LogButtonID",iDisplayOrderPriority:I,sI18nBtnTxt:K.bShowLogs?"XBUT_HIDELOG":"XBUT_SHOWLOG",onBtnPressed:this.onLogBtnPress.bind(this)});}if(K.fnFormatterSupportsProperty(Q.TaskSupports.Claim,Q.SupportsClaim)){I=1500+H;H++;G.push({iDisplayOrderPriority:I,sI18nBtnTxt:"XBUT_CLAIM",onBtnPressed:function(f1){if(D.system.phone){K.stayOnDetailScreen=true;}K.sendAction("Claim",Q,null);}});}if(K.fnFormatterSupportsProperty(Q.TaskSupports.Release,Q.SupportsRelease)){I=1500+H;H++;G.push({iDisplayOrderPriority:I,sI18nBtnTxt:"XBUT_RELEASE",onBtnPressed:function(f1){if(D.system.phone){K.stayOnDetailScreen=true;}K.sendAction("Release",Q,null);}});}if(K.fnFormatterSupportsProperty(Q.TaskSupports.Forward,Q.SupportsForward)){I=1500+H;H++;G.push({iDisplayOrderPriority:I,sI18nBtnTxt:"XBUT_FORWARD",onBtnPressed:this.onForwardPopUp.bind(this)});}if(Q.TaskSupports){if(Q.TaskSupports.Resubmit){I=1500+H;H++;G.push({iDisplayOrderPriority:I,sI18nBtnTxt:"XBUT_RESUBMIT",onBtnPressed:this.showResubmitPopUp.bind(this)});}}if($&&_){Y=true;_.isNavigationSupported(a1).done(function(f1){var g1=K._getSupportedOpenMode(f1);if(W.isOpenTaskEnabled(Q,(g1==="embedIntoDetails"||g1==="genericEmbedIntoDetails"))){I=1500+H;H++;G.push({iDisplayOrderPriority:I,sI18nBtnTxt:"XBUT_OPEN",onBtnPressed:function(h1){K.checkStatusAndOpenTaskUI();}});}if((g1==="embedIntoDetailsNestedRouter")&&K.taskSupportsCommAttRelObj(Q)){I=1300+H;H++;G.push({sId:"DetailsButtonID",iDisplayOrderPriority:I,sI18nBtnTxt:K.bShowDetails?"XBUT_HIDEDETAILS":"XBUT_SHOWDETAILS",onBtnPressed:function(h1){K.onDetailsBtnPress();}});}K.showHideSideContent();K.addEmailAndCallExtentionHookForButtonOptions(G,z,N,Q);}).fail(function(){K.addEmailAndCallExtentionHookForButtonOptions(G,z,N,Q);c.error("Error while creating open task buttons");});}else if(!K.oDataManager.isUIExecnLinkNavProp()&&Q.GUI_Link&&W.isOpenTaskEnabled(Q,false)){I=1500+H;H++;G.push({iDisplayOrderPriority:I,sI18nBtnTxt:"XBUT_OPEN",onBtnPressed:function(f1){K.checkStatusAndOpenTaskUI();}});}else if(Q.TaskSupports.UIExecutionLink&&Q.UIExecutionLink&&Q.UIExecutionLink.GUI_Link&&W.isOpenTaskEnabled(Q,false)){I=1500+H;H++;G.push({iDisplayOrderPriority:I,sI18nBtnTxt:"XBUT_OPEN",onBtnPressed:function(f1){K.checkStatusAndOpenTaskUI();}});}if(window.plugins&&window.plugins.calendar){var c1=this.oModel2.getData();var d1=c1.CompletionDeadLine;if(d1){var e1=function(f1){if(f1<new Date()){this.oConfirmationDialogManager.showDecisionDialog({question:this.i18nBundle.getText("dialog.warning.mq.CalendarEventInThePast"),title:this.i18nBundle.getText("dialog.warning.mq.CalendarEventInThePast.title"),confirmButtonLabel:this.i18nBundle.getText("XBUT_OK"),noteMandatory:false,confirmActionHandler:this.createCalendarEvent.bind(this)});}else{this.createCalendarEvent();}};I=1500+H;H++;G.push({iDisplayOrderPriority:I,sI18nBtnTxt:"XBUT_CALENDAR",onBtnPressed:e1.bind(this,d1)});}}}else{Z=true;if((Q.TaskSupports.ProcessingLogs||Q.TaskSupports.WorkflowLog)&&K.oDataManager.getShowLogEnabled()){I=1200+H;H++;G.push({sId:"LogButtonID",iDisplayOrderPriority:I,sI18nBtnTxt:K.bShowLogs?"XBUT_HIDELOG":"XBUT_SHOWLOG",onBtnPressed:this.onLogBtnPress.bind(this)});}if(Q.TaskSupports.CancelResubmission){I=1500+H;H++;G.push({iDisplayOrderPriority:I,sI18nBtnTxt:"XBUT_RESUME",onBtnPressed:function(f1){K.sendAction("CancelResubmission",Q,null);}});}if($&&_){_.isNavigationSupported(a1).done(function(f1){var g1=K._getSupportedOpenMode(f1);if((g1==="embedIntoDetailsNestedRouter")&&K.taskSupportsCommAttRelObj(Q)){I=1300+H;H++;G.push({sId:"DetailsButtonID",iDisplayOrderPriority:I,sI18nBtnTxt:K.bShowDetails?"XBUT_HIDEDETAILS":"XBUT_SHOWDETAILS",onBtnPressed:function(h1){K.onDetailsBtnPress();}});K.showHideSideContent();K.addEmailAndCallExtentionHookForButtonOptions(G,z,N,Q);}}).fail(function(){K.addEmailAndCallExtentionHookForButtonOptions(G,z,N,Q);c.error("Error creating details buttons");});}}if(!Y||Z){if(JSON.stringify(this.oHeaderFooterOptions.buttonList)!==JSON.stringify(G)){G=this.oHeaderFooterOptions.buttonList.concat(G);}this.addEmailAndCallExtentionHookForButtonOptions(G,z,N,Q);}},addEmailAndCallExtentionHookForButtonOptions:function(e,o,N,i){var j={};j.oPositiveAction=o;j.oNegativeAction=N;j.aButtonList=e;if(!this.oDataManager.bOutbox&&i.Status!=="COMPLETED"&&i.Status!=="FOR_RESUBMISSION"){this.addShareOnJamAndEmail(j);}if(this.extHookChangeFooterButtons){this.extHookChangeFooterButtons(j);o=j.oPositiveAction;N=j.oNegativeAction;e=j.aButtonList;}this.oHeaderFooterOptions=q.extend(this.oHeaderFooterOptions,{oPositiveAction:o,oNegativeAction:N,buttonList:e,oJamOptions:j.oJamOptions,oEmailSettings:j.oEmailSettings,bSuppressBookmarkButton:true});this.refreshHeaderFooterOptions();},startForwardFilter:function(o,Q){Q=Q.toLowerCase();var e=o.getBindingContext().getProperty("DisplayName").toLowerCase();var i=o.getBindingContext().getProperty("Department").toLowerCase();return(e.indexOf(Q)!==-1)||(i.indexOf(Q)!==-1);},closeForwardPopUp:function(o){if(o&&o.bConfirmed){var i=this.oModel2.getData();var e=i.SAP__Origin;var I=i.InstanceID;this.oDataManager.doForward(e,I,o.oAgentToBeForwarded.UniqueName,o.sNote,function(){var j=this.i18nBundle.getText("dialog.success.forward",o.oAgentToBeForwarded.DisplayName);if(this._getStandaloneDetailDeep()&&this.getView().getModel().bCheckPassed){this.getView().getModel().sDetailDeepEmptyMessage=j+". "+this.i18nBundle.getText("detailDeepEmptyView.closingTabMessage");a.show(j,{duration:1000,onClose:this.oRouter.navTo.bind(this.oRouter,"detail_deep_empty",null,false)});}else{a.show(j);}}.bind(this));}},onForwardPopUp:function(){var i=this.oModel2.getData();var o=i.SAP__Origin;var I=i.InstanceID;if(this.oDataManager.userSearch){m.open(this.startForwardFilter.bind(this),this.closeForwardPopUp.bind(this));var H=p.formatterTaskSupportsValue(i.TaskSupports.PotentialOwners,i.HasPotentialOwners);if(H){this.oDataManager.readPotentialOwners(o,I,this._PotentialOwnersSuccess.bind(this));}else{this._PotentialOwnersSuccess({results:[]});}}else{n.open(this.closeForwardPopUp.bind(this));}},_getSupportedOpenMode:function(e){var j=[];for(var i=0;i<e.length;i++){if(e[i].supported){j.push(this.OPEN_MODES[i]);}}return(j.length===1)?j[0]:null;},_getParsedParamsForIntent:function(e){var o=null;this.oURLParsingService=this.oURLParsingService||sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService&&sap.ushell.Container.getService("URLParsing");if(this.oURLParsingService&&this.oURLParsingService.isIntentUrl(e)){o=this.oURLParsingService.parseShellHash(e);}return o;},_getCrossNavigationService:function(){if(!this.oCrossNavigationService){if(sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService){this.oCrossNavigationService=sap.ushell.Container.getService("CrossApplicationNavigation");}}return this.oCrossNavigationService;},_PotentialOwnersSuccess:function(o){m.setAgents(o.results);m.setOrigin(this.oModel2.getData().SAP__Origin);},showResubmitPopUp:function(){s.open(this.sResubmitUniqueId,this,this.getView());},handleResubmitPopOverOk:function(e){var i=this.oModel2.getData();var o=i.SAP__Origin;var I=i.InstanceID;var j=F.byId(this.sResubmitUniqueId,"DATE_RESUBMIT");var z=j.getSelectedDates();if(z.length>0){var G=z[0].getStartDate();var H=x.getDateInstance({pattern:"yyyy-MM-ddTHH:mm:ss"});this.oDataManager.doResubmit(o,I,"datetime'"+H.format(G)+"'",function(){var K=this.i18nBundle.getText("dialog.success.resubmit");if(this._getStandaloneDetailDeep()&&this.getView().getModel().bCheckPassed){this.getView().getModel().sDetailDeepEmptyMessage=K+". "+this.i18nBundle.getText("detailDeepEmptyView.closingTabMessage");a.show(K,{duration:1000,onClose:this.oRouter.navTo.bind(this.oRouter,"detail_deep_empty",null,false)});}else{a.show(K);}}.bind(this));s.close();}},showEmployeeCard:function(o,e,i){this._setBusyIncdicatorOnDetailControls(this.getView(),true);this.oDataManager.readUserInfo(o,e,function(j){this._setBusyIncdicatorOnDetailControls(this.getView(),false);E.displayEmployeeCard(i,j);}.bind(this),function(j){this._setBusyIncdicatorOnDetailControls(this.getView(),false);}.bind(this),true);},onEmployeeLaunchTask:function(e){var i=this.oModel2.getData();this.showEmployeeCard(i.SAP__Origin,i.CreatedBy,p.getSelectedControl(e));},onEmployeeLaunchCommentSender:function(e,i,o){this.showEmployeeCard(this.oModel2.getData().SAP__Origin,o.getSource().getBindingContext("detail").getProperty("CreatedBy"),p.getSelectedControl(o));},handleLogNavigation:function(e){var o=e.getSource().getBindingContext("detail");var i=o.getProperty("SAP__Origin");var j=o.getProperty("ReferenceInstanceID");var z="TaskCollection(SAP__Origin='"+i+"',InstanceID='"+j+"')";this.bNavToFullScreenFromLog=true;var G={SAP__Origin:i,InstanceID:j,contextPath:z};var H=this.getView();this.oContext=new C(H.getModel(),z);H.setBindingContext(this.oContext);var I=q.extend(true,{},H.getModel().getData(this.oContext.getPath(),this.oContext));if(q.isEmptyObject(I)){var K=this;var N=K.getOwnerComponent().getDataManager();N.oDataRead("/TaskCollection(SAP__Origin='"+i+"',InstanceID='"+j+"')",null,function(Q){if(Q!==undefined&&!q.isEmptyObject(Q)){K.oRouter.navTo("detail_deep",G,false);}},function(Q){c.error(Q);return;});}else{this.oRouter.navTo("detail_deep",G,false);}},onEmployeeLaunchCommentIcon:function(e){var o=e.getSource().getBindingContext().getProperty("SAP__Origin");var i=e.getSource().getBindingContext("detail").getModel().getProperty(e.getSource().getBindingContext("detail").getPath()).CreatedBy;if(!o){var I=this.oModel2.getData();o=I.SAP__Origin;}this.showEmployeeCard(o,i,p.getSelectedControl(e));},onAttachmentShow:function(e){var o=e.getSource().getBindingContext("detail");var i=cross.fnd.fiori.inbox.attachment.getRelativeMediaSrc(o.getProperty().__metadata.media_src);sap.m.URLHelper.redirect(i,true);},showDecisionDialog:function(e,o,i){var j=o&&(o.ReasonRequired==="REQUIRED"||o.ReasonRequired==="OPTIONAL")?this.oConfirmationDialogManager.loadReasonOptions(o,this.oDataManager):null;var z={question:this.i18nBundle.getText("XMSG_DECISION_QUESTION",o.DecisionText),textAreaLabel:this.i18nBundle.getText("XFLD_TextArea_Decision"),showNote:i,title:this.i18nBundle.getText("XTIT_SUBMIT_DECISION"),confirmButtonLabel:this.i18nBundle.getText("XBUT_SUBMIT"),noteMandatory:o.CommentMandatory,confirmActionHandler:function(o,N,G){this.sendAction(e,o,N,G);}.bind(this,o)};if(j===null){this.oConfirmationDialogManager.showDecisionDialog(z);}else{j.then(function(G){z["reasonOptionsSettings"]=G;this.oConfirmationDialogManager.showDecisionDialog(z);}.bind(this)).catch(function(G){this.oConfirmationDialogManager.showDecisionDialog(z);c.error("Could not load the reason options properly");}.bind(this));}},fnOnNavBackFromLogDescription:function(e){this.bNavToFullScreenFromLog=false;this.bShowLogs=true;window.history.back();},showConfirmationDialog:function(e,i){this.oConfirmationDialogManager.showDecisionDialog({question:this.i18nBundle.getText("XMSG_CONFIRM_QUESTION"),showNote:false,title:this.i18nBundle.getText("XTIT_SUBMIT_CONFIRM"),confirmButtonLabel:this.i18nBundle.getText("XBUT_CONFIRM"),confirmActionHandler:function(i,N){this.sendAction(e,i,N);}.bind(this,i)});},onCommentPost:function(e,i,o){var j=o.getParameter("value");if(j&&j.length>0){this.sendAction("AddComment",null,j);}},sendAction:function(e,o,N,i){var j=this;var z;switch(e){case"Release":z="dialog.success.release";break;case"Claim":z="dialog.success.reserve";break;case"AddComment":z="dialog.success.addComment";break;case"Confirm":z="dialog.success.completed";break;case"CancelResubmission":z="dialog.success.cancelResubmission";break;default:z="dialog.success.complete";}switch(e){case"AddComment":{var I=this.oModel2.getData();var G=this._getIconTabControl("Comments");this._setBusyIncdicatorOnDetailControls(G,true);this.oDataManager.addComment(I.SAP__Origin,I.InstanceID,N,function(H,K){if(I.Comments&&I.Comments.results){I.Comments.results.unshift(H);}else{I.Comments={results:[H]};}I.CommentsCount=I.Comments.results.length;this._setBusyIncdicatorOnDetailControls(G,false);this._updateDetailModel(I);setTimeout(function(){a.show(j.i18nBundle.getText(z));},500,this);}.bind(this),function(H){this._setBusyIncdicatorOnDetailControls(G,false);}.bind(this));break;}default:{this.oDataManager.sendAction(e,o,N,i,function(H){setTimeout(function(){var K=j.i18nBundle.getText(z);if(j._getStandaloneDetailDeep()&&j.getView().getModel().bCheckPassed){j.getView().getModel().sDetailDeepEmptyMessage=K+". "+j.i18nBundle.getText("detailDeepEmptyView.closingTabMessage");a.show(K,{duration:1000,onClose:j.oRouter.navTo.bind(j.oRouter,"detail_deep_empty",null,false)});}else{a.show(K);}},500);}.bind(this,o));}}},refreshHeaderFooterOptions:function(){if(this.oHeaderFooterOptions&&this.oHeaderFooterOptions.buttonList){this.oHeaderFooterOptions.buttonList.sort(v.compareButtons);}this._oHeaderFooterOptions=q.extend(this._oHeaderFooterOptions,this.oHeaderFooterOptions);this.setHeaderFooterOptions(this._oHeaderFooterOptions);},setHeaderFooterOptions:function(o){this.oAppImp.oDHFHelper.setHeaderFooter(this,o);},getPage:function(){return k.getPageFromController(this);},fnNavBackToTableVw:function(){this.getOwnerComponent().getEventBus().publish("cross.fnd.fiori.inbox","refreshTask",{"contextPath":this.sCtxPath});if(window.history.length>0){window.history.back();}},fnOnNavBackInMobile:function(){if(window.history.length>0){window.history.back();}else{c.error("Navigation history does not exist. Ensure that navigation history is maintained or provide custom event handler for back navigation button through setShowNavButton API");}},checkStatusAndOpenTaskUI:function(){var o=this.oModel2.getData();this.oDataManager.checkStatusAndOpenTask(o.SAP__Origin,o.InstanceID,this.openTaskUI.bind(this));},openTaskUI:function(){var o=this.oModel2.getData();var e=this._getActionHelper();var K=o.SAP__Origin+"_"+o.InstanceID;var i=this.oEmbedModeIntentParams?this.oEmbedModeIntentParams[K]:null;if(i){this.fnNavigateToApp(i,i.OpenInEmbedMode);}else{var j=this.getOwnerComponent().getDataManager();e.fnValidateOpenTaskURLAndRedirect(this.oModel2.getData().GUI_Link||this.oModel2.getData().UIExecutionLink.GUI_Link,j.isForwardUserSettings());}},fnEmbedApplicationInDetailView:function(o){var N="#"+o.semanticObject+"-"+o.action;var i=new J({NavigationIntent:N,params:o.params});this.getOwnerComponent().setModel(i,"intentModel");var e={SAP__Origin:this.oRoutingParameters.SAP__Origin,InstanceID:this.oRoutingParameters.InstanceID,contextPath:this.oRoutingParameters.contextPath};if(this.bIsTableViewActive){this.oRouter.navTo("replace_detail_deep",e,false);}else{this.oRouter.navTo("replace_detail",e,true);}},updateToggleButtonState:function(e){this.sCurrentBreakpoint=e.getParameter("currentBreakpoint");this.setShowMainContent();},onLogBtnPress:function(e){var o=this.byId("LogButtonID");var i=this.byId("DetailsButtonID");var j=this.byId("tabBarLogs");this.bShowLogs=false;if(o){if(o.getText()===this.i18nBundle.getText("XBUT_SHOWLOG")){o.setText(this.i18nBundle.getText("XBUT_HIDELOG"));if(i){i.setText(this.i18nBundle.getText("XBUT_SHOWDETAILS"));}this.oModel2.setProperty("/ShowLogPressed",true);this.bShowLogs=true;this.bShowDetails=false;this.createLogs();if(!this.sCurrentBreakpoint&&D.system.phone){this.sCurrentBreakpoint="S";}this.setShowSideContent(true);this.fnSetFocusOnSideContent();}else{o.setText(this.i18nBundle.getText("XBUT_SHOWLOG"));this.setShowSideContent(false);}}this.setShowMainContent();this.updateButtonList();},onDetailsBtnPress:function(e){var o=this.byId("LogButtonID");var i=this.byId("DetailsButtonID");this.bShowDetails=false;if(i){if(i.getText()===this.i18nBundle.getText("XBUT_SHOWDETAILS")){i.setText(this.i18nBundle.getText("XBUT_HIDEDETAILS"));if(o){o.setText(this.i18nBundle.getText("XBUT_SHOWLOG"));}this.oModel2.setProperty("/ShowLogPressed",false);this.bShowDetails=true;this.bShowLogs=false;this.fnCreateSelectedTab(this.byId("tabBarDetails").getSelectedKey());if(!this.sCurrentBreakpoint&&D.system.phone){this.sCurrentBreakpoint="S";}this.setShowSideContent(true);this.fnSetFocusOnSideContent();}else{i.setText(this.i18nBundle.getText("XBUT_SHOWDETAILS"));this.setShowSideContent(false);}}this.setShowMainContent();this.updateButtonList();},hideDetails:function(){this.bShowDetails=false;this.setShowSideContent(false);this.setShowMainContent();},updateButtonList:function(){var e=this.byId("LogButtonID");if(e){e.sI18nBtnTxt=this.bShowLogs?"XBUT_HIDELOG":"XBUT_SHOWLOG";}var i=this.byId("DetailsButtonID");if(i){i.sI18nBtnTxt=this.bShowDetails?"XBUT_HIDEDETAILS":"XBUT_SHOWDETAILS";}},fnSetFocusOnSideContent:function(){var e=this.oModel2.getData().TaskSupports;var i=this;if(e.WorkflowLog){setTimeout(function(){i.getView().byId("WorkflowLogIconTabFilter").focus();},100);}else if(e.ProcessingLogs){setTimeout(function(){i.getView().byId("TaskLogIconTabFilter").focus();},100);}},setShowMainContent:function(){var o=this.byId("DynamicSideContent");if(o){if(this.sCurrentBreakpoint==="S"&&(this.bShowLogs||this.bShowDetails)&&this.oModel2&&this.oModel2.getData()){var e=this.oModel2.getData().TaskSupports;if((this.bShowLogs&&e&&(e.WorkflowLog||e.ProcessingLogs))||(this.bShowDetails&&e&&this._getEmbedIntoDetailsNestedRouter()&&(e.Attachments||e.TaskObject||e.Comments))){o.setShowMainContent(false);}else{o.setShowMainContent(true);}}else{o.setShowMainContent(true);}}},setShowSideContent:function(e){var o=this.byId("DynamicSideContent");if(o){o.setShowSideContent(e);}},getShowSideContent:function(){var o=this.byId("DynamicSideContent");if(o){return o.getShowSideContent();}return false;},createLogs:function(K){var e=K;var I=this.byId("tabBarLogs");var o=this.oModel2.getData();this.sCustomCreatedByValue=null;if(o.CustomAttributeData instanceof Array&&o.CustomAttributeData.length>0){for(var i=0;i<o.CustomAttributeData.length;i++){var j=this.oDataManager.oModel.getProperty("/"+o.CustomAttributeData[i]);if(j&&j.Name.toLowerCase()===this.sCustomCreatedByAttribute.toLowerCase()){this.sCustomCreatedByValue=j.Value;break;}}}if(!e&&o.TaskSupports){if(o.TaskSupports.ProcessingLogs&&o.TaskSupports.WorkflowLog&&I){e=I.getSelectedKey();}else if(o.TaskSupports.WorkflowLog){e="WORKFLOWLOG";}else if(o.TaskSupports.ProcessingLogs){e="TASKLOG";}}switch(e){case"TASKLOG":this.createTimeLine();this.fnHandleNoTextCreation("ProcessingLogs");this.fnFetchDataOnLogTabSelect("ProcessingLogs");this._getIconTabControl("ProcessingLogs").setGrowingThreshold(10);break;case"WORKFLOWLOG":this.createWorkflowLogTimeLine();this.fnHandleNoTextCreation("WorkflowLogs");this.fnFetchDataOnLogTabSelect("WorkflowLogs");this._getIconTabControl("WorkflowLogs").setGrowingThreshold(10);break;default:}},createWorkflowLogTimeLine:function(){var e=this;var o=e._getIconTabControl("WorkflowLogs");if(o){var i=new f({icon:{parts:[{path:"detail>Status"},{path:"detail>ResultType"}],formatter:p.formatterWorkflowLogStatusIcon},userName:{parts:[{path:"detail>PerformedByName"},{path:"detail>Status"},{path:"detail>CustomCreatedBy"}],formatter:p.formatterWorkflowLogStatusUsername},userNameClickable:{parts:[{path:"detail>Status"},{path:"detail>CustomCreatedBy"}],formatter:p.formatterWorkflowLogUsernameClickable},userPicture:{parts:[{path:"detail>SAP__Origin"},{path:"detail>PerformedByName"},{path:"detail>Status"},{path:"detail>CustomCreatedBy"}],formatter:p.formatterWorkflowLogUserPicture},title:{parts:[{path:"detail>Status"},{path:"detail>PerformedByName"},{path:"detail>CustomCreatedBy"}],formatter:p.formatterWorkflowLogStatusText},dateTime:"{detail>Timestamp}",embeddedControl:new V({items:[new O({text:"{detail>Description}",active:"{detail>SupportsNavigation}",press:this.handleLogNavigation.bind(this)}),new b({text:"{detail>Result}",state:{path:"detail>ResultType",formatter:p.formatterWorkflowLogResultState}})]})});i.attachUserNameClicked(function(j){var z=j.getSource().getBindingContext("detail");e.showEmployeeCard(z.getProperty("SAP__Origin"),z.getProperty("PerformedBy"),p.getSelectedControl(j));});o.bindAggregation("content",{path:"detail>/WorkflowLogs/results",template:i});}},onLogTabSelect:function(o){var e=o.getParameters().selectedKey;this.createLogs(e);},fnFetchDataOnLogTabSelect:function(N){var o=null;if(N==="ProcessingLogs"){o={$orderby:"OrderID desc"};}var e=this.sCtxPath+"/"+N;var j=this._getIconTabControl(N);this._setBusyIncdicatorOnDetailControls(j,true);var z=function(H){var I=this.oModel2.getData();var K=(I[N]&&I[N].results)?true:false;if(this.sCustomCreatedByValue){var Q=H.results;if(Q&&Array.isArray(Q)){for(var i=0;i<Q.length;i++){Q[i].CustomCreatedBy=this.sCustomCreatedByValue;}}H.results=Q;}this.fnUpdateDataAfterFetchComplete(I,K,N,H);this._setBusyIncdicatorOnDetailControls(j,false);if(H.results.length===0){var W=this._getIconTabControl(N);var Y;if(N==="ProcessingLogs"){Y="view.ProcessLogs.noData";}else if(N==="WorkflowLogs"){Y="view.WorkflowLogs.noData";}W.setNoDataText(this.i18nBundle.getText(Y));}};var G=function(i){this._setBusyIncdicatorOnDetailControls(j,false);this.oDataManager.oDataRequestFailed(i);};this.oDataManager.oDataRead(e,o,z.bind(this),G.bind(this));},onTabSelect:function(o){var e=o.getParameters().selectedKey;this.fnCreateSelectedTab(e);},fnCreateSelectedTab:function(e){var i;if(this.oModel2&&this.oModel2.getData()){i=this.oModel2.getData().TaskSupports;}if(i){switch(e){case"NOTES":if(!i.Comments){if(i.Attachments){this.fnCreateSelectedTab("ATTACHMENTS");break;}else if(i.TaskObject){this.fnCreateSelectedTab("OBJECTLINKS");break;}else{this.hideDetails();break;}}this.fnDelegateCommentsCreation();this.fnFetchDataOnTabSelect("Comments");this.fnSetIconForCommentsFeedInput();this.fnHandleNoTextCreation("Comments");break;case"ATTACHMENTS":if(!i.Attachments){if(i.Comments){this.fnCreateSelectedTab("NOTES");break;}else if(i.TaskObject){this.fnCreateSelectedTab("OBJECTLINKS");break;}else{this.hideDetails();break;}}this.fnDelegateAttachmentsCreation();this.fnFetchDataOnTabSelect("Attachments");if(!this._getEmbedIntoDetailsNestedRouter()){this.fnHandleAttachmentsCountText("Attachments");}this.fnHandleNoTextCreation("Attachments");break;case"OBJECTLINKS":if(i.TaskObject){this.fnFetchObjectLinks();}else{if(i.Comments){this.fnCreateSelectedTab("NOTES");break;}else if(i.Attachments){this.fnCreateSelectedTab("ATTACHMENTS");break;}else{this.hideDetails();break;}}break;default:}}else{this.hideDetails();}},fnDelegateCommentsCreation:function(){if(!this._getEmbedIntoDetailsNestedRouter()&&this.isGenericComponentRendered){return;}var i=this.oModel2.getData();var e=this._getEmbedIntoDetailsNestedRouter()?"commentsContainerInDetails":"commentsContainer";if(this.getView().byId(e)&&this.fnFormatterSupportsProperty(i.TaskSupports.Comments,i.SupportsComments)){this.createGenericCommentsComponent(this.getView());}},fnDelegateAttachmentsCreation:function(){var i=this.oModel2.getData();var o=this._getEmbedIntoDetailsNestedRouter()?this.byId("attachmentComponentInDetails"):this.byId("attachmentComponent");if(o&&this.fnFormatterSupportsProperty(i.TaskSupports.Attachments,i.SupportsAttachments)){if(!q.isEmptyObject(this.oGenericAttachmentComponent)){this.oGenericAttachmentComponent.destroy();delete this.oGenericAttachmentComponent;}this.oGenericAttachmentComponent=sap.ui.getCore().createComponent({name:"cross.fnd.fiori.inbox.attachment",settings:{attachmentHandle:this.fnCreateAttachmentHandle(this.sCtxPath)}});this.oGenericAttachmentComponent.uploadURL(this.fnGetUploadUrl(this.sCtxPath));o.setPropagateModel(true);o.setComponent(this.oGenericAttachmentComponent);}},createTimeLine:function(){var o=this.byId("timeline");if(o){o.setSort(false);var e=new f({icon:{path:"detail>ActionName",formatter:p.formatterActionIcon},userName:{parts:[{path:"detail>PerformedByName"},{path:"detail>ActionName"},{path:"detail>CustomCreatedBy"}],formatter:p.formatterActionUsername},title:{path:"detail>ActionName",formatter:p.formatterActionText},dateTime:"{detail>Timestamp}"});o.bindAggregation("content",{path:"detail>/ProcessingLogs/results",template:e});}},fnSetIconForCommentsFeedInput:function(){if(this.oGenericCommentsComponent&&this.oGenericCommentsComponent.fnIsFeedInputPresent()&&!this.oGenericCommentsComponent.fnGetFeedInputIcon()){if(sap.ushell.Container!=undefined){var e=this.oModel2.getData().SAP__Origin;var i=sap.ushell.Container.getUser().getId();this.oDataManager.getCurrentUserImage(e,i,this.oGenericCommentsComponent.fnSetFeedInputIcon.bind(this.oGenericCommentsComponent));}}},fnCountUpdater:function(K,e,i,G){var j=this;var I=this.oModel2.getData();switch(K){case"Attachments":if(j.fnFormatterSupportsProperty(I.TaskSupports.Attachments,I.SupportsAttachments)){this.oDataManager.fnGetCount(e,i,function(N){j.oModel2.setProperty("/AttachmentsCount",N);},"Attachments",G);}break;case"Comments":if(j.fnFormatterSupportsProperty(I.TaskSupports.Comments,I.SupportsComments)){this.oDataManager.fnGetCount(e,i,function(N){j.oModel2.setProperty("/CommentsCount",N);},"Comments",G);}break;case"ObjectLinks":if(I.TaskSupports.TaskObject&&j.oDataManager.bShowTaskObjects){this.oDataManager.fnGetCount(e,i,function(N){j.oModel2.setProperty("/ObjectLinksCount",N);j.fnHandleNoTextCreation("ObjectLinks");},"TaskObjects",G);}break;default:break;}},fnHandleAttachmentsCountText:function(e){var o=this.oModel2.getData();var G=this._getUploadCollectionControl();if(G&&o.hasOwnProperty("AttachmentsCount")){var i=o.AttachmentsCount;var j=this.oModel2.iSizeLimit;var z=i>=j?this.i18nBundle.getText("attachmentsCount.message",[j,i]):this.i18nBundle.getText("attachments.tooltip");G.setNumberOfAttachmentsText(z);}},fnHandleNoTextCreation:function(e){var o=this.oModel2.getData();switch(e){case"Comments":if(this.oGenericCommentsComponent){if(o.hasOwnProperty("CommentsCount")&&o.CommentsCount>0){this.oGenericCommentsComponent.setNoDataText(this.i18nBundle.getText("XMSG_LOADING"));}else if(o.hasOwnProperty("CommentsCount")&&o.CommentsCount==0){this.oGenericCommentsComponent.setNoDataText(this.i18nBundle.getText("view.CreateComment.noComments"));}}break;case"Attachments":var G=this._getUploadCollectionControl();if(G){if(o.hasOwnProperty("AttachmentsCount")&&o.AttachmentsCount>0){G.setNoDataText(this.i18nBundle.getText("XMSG_LOADING"));}else if(o.hasOwnProperty("AttachmentsCount")&&o.AttachmentsCount==0){G.setNoDataText(this.i18nBundle.getText("view.Attachments.noAttachments"));}}break;case"ProcessingLogs":var i=this._getIconTabControl("ProcessingLogs");if(i){i.setNoDataText(this.i18nBundle.getText("XMSG_LOADING"));}break;case"WorkflowLogs":var W=this._getIconTabControl("WorkflowLogs");if(W){W.setNoDataText(this.i18nBundle.getText("XMSG_LOADING"));}break;case"ObjectLinks":var j=this._getObjectLinksList();if(j){if(o.ObjectLinksCount&&o.ObjectLinksCount>0){j.setNoDataText(this.i18nBundle.getText("XMSG_LOADING"));}else if(o.ObjectLinksCount&&o.ObjectLinksCount==0){j.setNoDataText(this.i18nBundle.getText("view.ObjectLinks.noObjectLink"));}}break;default:break;}},fnClearCachedData:function(){var e=this._getEmbedIntoDetailsNestedRouter()?"-":"";this.oModel2.setProperty("/AttachmentsCount",e);this.oModel2.setProperty("/CommentsCount",e);this.oModel2.setProperty("/ObjectLinksCount",e);this.oModel2.setProperty("/ProcessingLogs","");this.oModel2.setProperty("/Attachments","");this.oModel2.setProperty("/Comments","");this.oModel2.setProperty("/ObjectLinks","");this.oModel2.setProperty("/StatusText","");this.oModel2.setProperty("/WorkflowLogs","");this.oModel2.setProperty("/Description","");},fnFetchDataOnTabSelect:function(N){var e=this.sCtxPath+"/"+N;var o=null;if(N==="Attachments"||N==="Comments"){o={$orderby:"CreatedAt desc"};}var i=this.oModel2.getData();var j=(i[N]&&i[N].results)?true:false;var z=this._getIconTabControl(N);var G=function(I){this.fnUpdateDataAfterFetchComplete(i,j,N,I);this._setBusyIncdicatorOnDetailControls(z,false);};var H=function(I){this._setBusyIncdicatorOnDetailControls(z,false);this.oDataManager.oDataRequestFailed(I);};if(!j&&i[this.oMapCountProperty[N]]>0){this._setBusyIncdicatorOnDetailControls(z,true);}this.oDataManager.oDataRead(e,o,G.bind(this),H.bind(this));},fnUpdateDataAfterFetchComplete:function(o,e,N,i){var j=false;if(e&&i.results.length>0){q.extend(true,o[N],i);}else{j=o[N].results!=null&&o[N].results.length>0&&i.results!=null&&i.results.length===0;o[N]=i;}o[this.oMapCountProperty[N]]=i.results.length;if(j){this.fnHandleNoTextCreation(N);}this._updateDetailModel(o);if(this._getEmbedIntoDetailsNestedRouter()){this.fnHandleAttachmentsCountText("Attachments");}},_getIconTabControl:function(N){switch(N){case"Comments":if(this.oGenericCommentsComponent){return this.oGenericCommentsComponent.getAggregation("rootControl").byId("MIBCommentList");}return null;case"Attachments":return this._getUploadCollectionControl();case"ProcessingLogs":return this.getView().byId("timeline");case"WorkflowLogs":return this.getView().byId("timelineWorkflowLog");case"TaskObjects":return this._getObjectLinksList();default:}},fnFetchObjectLinks:function(){var o=0;var e=this._getIconTabControl("TaskObjects");this._setBusyIncdicatorOnDetailControls(e,true);var j=function(G){for(var i=0;i<G.results.length;i++){if(!G.results[i].Label){o=o+1;G.results[i].Label=this.i18nBundle.getText("object.link.label")+" "+o;}}this._setBusyIncdicatorOnDetailControls(e,false);this.oModel2.setProperty("/ObjectLinks",G);this.oModel2.setProperty("/ObjectLinksCount",G.results.length);};var z=function(i){this._setBusyIncdicatorOnDetailControls(e,false);};this.oDataManager.oDataRead(this.sCtxPath+"/"+"TaskObjects",null,j.bind(this),z.bind(this));},onSupportInfoOpenEvent:function(e,j,o){if(o.source==="MAIN"){var z=null;var I=q.extend(true,[],this.oModel2.getData());if(this.aTaskDefinitionData){for(var i=0;i<this.aTaskDefinitionData.length;i++){if(I&&(I.TaskDefinitionID===this.aTaskDefinitionData[i].TaskDefinitionID)){if(this.aTaskDefinitionData[i].CustomAttributeDefinitionData.results){z=this.aTaskDefinitionData[i].CustomAttributeDefinitionData.results;}}}}S.setTask(I,z,this.getView().getModel());}},addAction:function(o,e){var i;if(arguments.length<2){throw"Should have two arguments, Action object and listener function";}if(arguments.length===3){if(typeof arguments[1]==="function"){e=arguments[1];}else{throw"Second argument is not a listener function";}if(typeof arguments[2]==="object"){i=arguments[2];}}if(!o){throw"Provide Action object with action name, label and optionally type (Accept/Reject)";}if(!e){throw"Provide listener function for the Action";}var j=false;if(this.oHeaderFooterOptions){var z=50;var G=0;var H=o.action;var I=o.label;var K={actionId:H,sBtnTxt:I,onBtnPressed:i?e.bind(i):e};if(o.type&&(o.type.toUpperCase()==="ACCEPT"||o.type.toUpperCase()==="POSITIVE")){K.nature="POSITIVE";G=z;z++;if(o.iDisplayOrderPriority){G=o.iDisplayOrderPriority;}K.iDisplayOrderPriority=G;}else if(o.type&&(o.type.toUpperCase()==="REJECT"||o.type.toUpperCase()==="NEGATIVE")){K.nature="NEGATIVE";G=200+z;z++;if(o.iDisplayOrderPriority){G=o.iDisplayOrderPriority;}K.iDisplayOrderPriority=G;}else{G=500+z;z++;if(o.iDisplayOrderPriority){G=o.iDisplayOrderPriority;}K.iDisplayOrderPriority=G;}this.oHeaderFooterOptions.buttonList.push(K);this.refreshHeaderFooterOptions();j=true;}return j;},removeAction:function(e){var j=false;var o=[];var z;if(!e){throw"Provide Action string to be removed";}if(this.oHeaderFooterOptions){if(this.oHeaderFooterOptions.oPositiveAction&&this.oHeaderFooterOptions.oPositiveAction.actionId===e){this.oHeaderFooterOptions.oPositiveAction=null;this.refreshHeaderFooterOptions();j=true;}else if(this.oHeaderFooterOptions.oNegativeAction&&this.oHeaderFooterOptions.oNegativeAction.actionId===e){this.oHeaderFooterOptions.oNegativeAction=null;this.refreshHeaderFooterOptions();j=true;}else{o=this.oHeaderFooterOptions.buttonList;z=o.length;for(var i=0;i<z;i++){if(e===o[i].actionId){o.splice(i,1);this.oHeaderFooterOptions.buttonList=o;this.refreshHeaderFooterOptions();j=true;break;}}}}return j;},disableAction:function(e){var j=false;var o=[];if(this.oHeaderFooterOptions){if(this.oHeaderFooterOptions.oPositiveAction&&this.oHeaderFooterOptions.oPositiveAction.actionId===e){this.oHeaderFooterOptions.oPositiveAction.bDisabled=true;this.refreshHeaderFooterOptions();j=true;}else if(this.oHeaderFooterOptions.oNegativeAction&&this.oHeaderFooterOptions.oNegativeAction.actionId===e){this.oHeaderFooterOptions.oNegativeAction.bDisabled=true;this.refreshHeaderFooterOptions();j=true;}else{o=this.oHeaderFooterOptions.buttonList;for(var i=0;i<o.length;i++){if(e&&e===o[i].actionId){o[i].bDisabled=true;this.oHeaderFooterOptions.buttonList=o;this.refreshHeaderFooterOptions();j=true;break;}}}}return j;},disableAllActions:function(){var e=false;var j=[];if(this.oHeaderFooterOptions){e=true;if(this.oHeaderFooterOptions.oPositiveAction&&this.oHeaderFooterOptions.oPositiveAction.actionId){this.oHeaderFooterOptions.oPositiveAction.bDisabled=true;}if(this.oHeaderFooterOptions.oNegativeAction&&this.oHeaderFooterOptions.oNegativeAction.actionId){this.oHeaderFooterOptions.oNegativeAction.bDisabled=true;}j=this.oHeaderFooterOptions.buttonList;if(j){for(var i=0;i<j.length;i++){if(j[i].actionId){j[i].bDisabled=true;}}this.oHeaderFooterOptions.buttonList=j;}this.refreshHeaderFooterOptions();}return e;},enableAction:function(e){var j=false;var o=[];if(this.oHeaderFooterOptions){if(this.oHeaderFooterOptions.oPositiveAction&&this.oHeaderFooterOptions.oPositiveAction.actionId===e){this.oHeaderFooterOptions.oPositiveAction.bDisabled=false;this.refreshHeaderFooterOptions();j=true;}else if(this.oHeaderFooterOptions.oNegativeAction&&this.oHeaderFooterOptions.oNegativeAction.actionId===e){this.oHeaderFooterOptions.oNegativeAction.bDisabled=false;this.refreshHeaderFooterOptions();j=true;}else{o=this.oHeaderFooterOptions.buttonList;for(var i=0;i<o.length;i++){if(e&&e===o[i].actionId){o[i].bDisabled=false;this.oHeaderFooterOptions.buttonList=o;this.refreshHeaderFooterOptions();j=true;break;}}}}return j;},enableAllActions:function(){var e=false;var j=[];if(this.oHeaderFooterOptions){e=true;if(this.oHeaderFooterOptions.oPositiveAction&&this.oHeaderFooterOptions.oPositiveAction.actionId){this.oHeaderFooterOptions.oPositiveAction.bDisabled=false;}if(this.oHeaderFooterOptions.oNegativeAction&&this.oHeaderFooterOptions.oNegativeAction.actionId){this.oHeaderFooterOptions.oNegativeAction.bDisabled=false;}j=this.oHeaderFooterOptions.buttonList;if(j){for(var i=0;i<j.length;i++){if(j[i].actionId){j[i].bDisabled=false;}}this.oHeaderFooterOptions.buttonList=j;}this.refreshHeaderFooterOptions();}return e;},_createCustomAttributesElements:function(o,e){var z=this.getView().byId("customAttributesContainer");var G=this.aCA;for(var i=0;i<e.length;i++){var H=e[i].Name;var I=e[i].Type;var K=e[i].Label;var N;var Q=true;if((H.toLowerCase()===this.sCustomTaskTitleAttribute.toLowerCase()||H.toLowerCase()===this.sCustomNumberValueAttribute.toLowerCase()||H.toLowerCase()===this.sCustomNumberUnitValueAttribute.toLowerCase()||H.toLowerCase()===this.sCustomObjectAttributeValue.toLowerCase()||H.toLowerCase()===this.sCustomCreatedByAttribute.toLowerCase())){Q=false;}if(Q){if(H&&I&&K){for(var j=0;j<o.CustomAttributeData.length;j++){if(this._getShowAdditionalAttributes()===true){N=this.getView().getModel().getProperty("/"+o.CustomAttributeData[j]);}else{N=o.CustomAttributeData[j];}if(N.Name===H){var W=new g("",{});W.setLayoutData(new R("",{linebreak:true,margin:false}));var Y=new L("",{text:K});Y.setLayoutData(new R("",{weight:3,minWidth:192}));W.setLabel(Y);var Z=p.fnCustomAttributeTypeFormatter(N.Value,I);var $=new T("",{text:Z});$.setLayoutData(new R("",{weight:5}));W.addField($);z.addFormElement(W);G.push(W);break;}}}}}this.byId("DescriptionContent").rerender();},_createCustomAttributesOnDataLoaded:function(o){if(this.aCA.length===0&&this.oModel2.getData().CustomAttributeData&&this.oModel2.getData().CustomAttributeData.length>0&&o&&o.length>0){var e=this._createCustomAttributesElements.bind(this);e(this.oModel2.getData(),o);}},_getUploadCollectionControl:function(){var o;if(this.isGenericComponentRendered&&this.oAttachmentComponentView){o=this.oAttachmentComponentView.byId("uploadCollection");}else if(this.oGenericAttachmentComponent&&!this.isGenericComponentRendered){o=this.oGenericAttachmentComponent.view.byId("uploadCollection");}return o;},_setBusyIncdicatorOnDetailControls:function(o,e){if(o){if(e){o.setBusyIndicatorDelay(1000);}o.setBusy(e);}},_processCustomAttributesData:function(i){if(i.CustomAttributeData&&i.CustomAttributeData.__list){i.CustomAttributeData=i.CustomAttributeData.__list;}var o=this.oDataManager.getCustomAttributeDefinitions()[i.TaskDefinitionID];if(o&&o instanceof Array){i.CustomAttributeDefinitionData=o;}return i;},_getShowAdditionalAttributes:function(){if(this.bShowAdditionalAttributes==null){this.bShowAdditionalAttributes=this.oDataManager.getShowAdditionalAttributes();}return this.bShowAdditionalAttributes;},_getTaskTitleInHeader:function(){if(this.bTaskTitleInHeader==null){this.bTaskTitleInHeader=this.oDataManager.getTaskTitleInHeader();}return this.bTaskTitleInHeader;},_getStandaloneDetailDeep:function(){if(this.bStandaloneDetailDeep==null){this.bStandaloneDetailDeep=this.oDataManager.getStandaloneDetailDeep();}return this.bStandaloneDetailDeep;},createCalendarEvent:function(){var e=this;var o=this.oModel2.getData();var i=o.CompletionDeadLine;if(i){i.setDate(i.getDate()-1);var j=i.getFullYear();var z=i.getMonth();var G=i.getDate();var H=i.getHours();var I=i.getMinutes();var K=i.getSeconds();var N=new Date(j,z,G,H,I,K);var Q=new Date(j,z,G,H,I+60,K);var W=o.TaskTitle;var Y=this.getMailBody();var Z=function(b1){a.show(e.i18nBundle.getText("dialog.success.mq.calendarEventCreated"));};var $=function(b1){var c1=e.i18nBundle.getText("dialog.error.mq.calendarPluginError");M.error(c1,{details:v.fnRemoveHtmlTags(b1)});};var _=function(b1){if(typeof(b1)==="string"||b1.length===0){window.plugins.calendar.createEvent(W,null,Y,N,Q,Z,$);}else{a.show(e.i18nBundle.getText("dialog.error.mq.calendarThereIsAnEventAlready"));}};var a1=function(b1){window.plugins.calendar.createEvent(W,null,Y,N,Q,Z,$);};window.plugins.calendar.findEvent(W,null,null,N,Q,_,a1);i.setDate(i.getDate()+1);}},_getActionHelper:function(){if(!this._oActionHelper){this._oActionHelper=new l(this,this.getView());}return this._oActionHelper;},showEmptyView:function(e,i,I){this.getOwnerComponent().oDataManager.oEventBus.publish("cross.fnd.fiori.inbox","clearSelection");X.create({viewName:"cross.fnd.fiori.inbox.view.Empty"}).then(function(o){var j=cross.fnd.fiori.inbox.util.tools.Application.getImpl();if(!e){e=j.oConfiguration.getDetailTitleKey();}if(!I&&!i){i=j.oConfiguration.getDefaultEmptyMessageKey();}o.getController().setTitleAndMessage(e,i,I);var z=this.oDataManager;if(!z)z=this.getOwnerComponent().getDataManager();if(z.tableView){var G=this.getView().getParent().getParent().byId("fioriContent");G.addPage(o);G.to(o.getId(),"show");}else{var H=this.getView().getParent().getParent();H.addDetailPage(o);H.to(o.getId(),"show");}}.bind(this)).catch(function(){c.error("Empty view was not created successfully");});},_getEmbedIntoDetailsNestedRouter:function(){return this.embedFioriElements;},showHideSideContent:function(){var i=this.oModel2.getData();if(this.bNavToFullScreenFromLog){this.setShowSideContent(false);this.bShowLogs=false;this.bShowDetails=false;}else if((i.TaskSupports.ProcessingLogs||i.TaskSupports.WorkflowLog)&&this.oDataManager.getShowLogEnabled()&&this.bShowLogs){this.createLogs();this.setShowSideContent(true);}else if((i.TaskSupports.Attachments||i.TaskSupports.TaskObject||i.TaskSupports.Comments)&&this.bShowDetails&&this._getEmbedIntoDetailsNestedRouter()){this.fnCreateSelectedTab(this.byId("tabBarDetails").getSelectedKey());this.setShowSideContent(true);}else{this.setShowSideContent(false);}this.setShowMainContent();},_getObjectLinksList:function(){var o=this.byId("MIBObjectLinksTabFilter");if(o&&o.getVisible()&&o.getContent()&&Array.isArray(o.getContent())&&(o.getContent().length>0)){var e=o.getContent()[0];if(e&&e.getMetadata()&&(e.getMetadata().getName()==="sap.m.List")){return e;}}return undefined;},taskSupportsCommAttRelObj:function(i){var e;if(i){e=i.TaskSupports;}else if(this.oModel2&&this.oModel2.getData()){e=this.oModel2.getData().TaskSupports;}else{return false;}return e.Comments||e.Attachments||e.TaskObject;}});});
