/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","cross/fnd/fiori/inbox/util/Substitution","cross/fnd/fiori/inbox/util/DataManager","cross/fnd/fiori/inbox/controller/BaseController","cross/fnd/fiori/inbox/util/MultiSelect","cross/fnd/fiori/inbox/util/Forward","cross/fnd/fiori/inbox/util/ForwardSimple","cross/fnd/fiori/inbox/util/SupportInfo","cross/fnd/fiori/inbox/util/Resubmit","cross/fnd/fiori/inbox/util/TaskStatusFilterProvider","cross/fnd/fiori/inbox/util/InboxFilterContributor","cross/fnd/fiori/inbox/util/OutboxFilterContributor","cross/fnd/fiori/inbox/util/ConfirmationDialogManager","cross/fnd/fiori/inbox/util/ODataExtension","cross/fnd/fiori/inbox/util/CommonFunctions","cross/fnd/fiori/inbox/util/oDataReadExtension","cross/fnd/fiori/inbox/util/Conversions","cross/fnd/fiori/inbox/util/tools/Application","cross/fnd/fiori/inbox/util/tools/CommonHeaderFooterHelper","cross/fnd/fiori/inbox/util/Utils","sap/base/Log","sap/ui/model/json/JSONModel","sap/ui/model/Sorter","sap/ui/model/Context","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/Device","sap/ui/layout/VerticalLayout","sap/ui/model/odata/OperationMode","sap/ui/model/odata/CountMode","sap/ui/core/CustomData","sap/ui/core/Fragment","sap/ui/core/format/DateFormat","sap/m/ObjectListItem","sap/m/ViewSettingsFilterItem","sap/m/library","sap/m/ViewSettingsItem","sap/m/ViewSettingsCustomItem","sap/m/List","sap/m/StandardListItem","sap/m/ViewSettingsDialog","sap/m/Toolbar","sap/m/Label","sap/m/CheckBox","sap/m/GroupHeaderListItem","sap/m/MessageToast"],function(q,S,D,B,M,F,c,d,R,T,I,O,C,e,f,o,g,A,l,U,L,J,m,n,p,r,s,V,t,u,v,w,x,y,z,E,G,H,K,N,P,Q,W,X,Y,Z){"use strict";var $=E.ButtonType;var _=E.ListMode;var a1=E.ToolbarDesign;return B.extend("cross.fnd.fiori.inbox.view.S2",{extHookChangeFilterItems:null,extHookChangeSortConfig:null,extHookChangeGroupConfig:null,extHookGetCustomFilter:null,extHookChangeMassApprovalButtons:null,extHookGetPropertiesToSelect:null,_FILTER_CATEGORY_PRIORITY:"Priority",_FILTER_PRIORITY_VERY_HIGH:"VERY_HIGH",_FILTER_PRIORITY_HIGH:"HIGH",_FILTER_PRIORITY_MEDIUM:"MEDIUM",_FILTER_PRIORITY_LOW:"LOW",_FILTER_CATEGORY_COMPLETION_DEADLINE:"CompletionDeadLine",_FILTER_EXPIRY_DATE_OVERDUE:"Overdue",_FILTER_EXPIRY_DATE_DUE_IN_7_DAYS:"DueIn7days",_FILTER_EXPIRY_DATE_DUE_IN_30_DAYS:"DueIn30days",_FILTER_EXPIRY_DATE_ALL:"All",_FILTER_CATEGORY_STATUS:"Status",_FILTER_CATEGORY_CREATION_DATE:"CreatedOn",_FILTER_CATEGORY_COMPLETED:"Completed",_FILTER_CATEGORY_SNOOZED:"ResumeIn",_FILTER_CATEGORY_TASK_DEFINITION_ID:"TaskDefinitionID",_FILTER_CATEGORY_SUBSTITUTED_USER:"SubstitutedUser",_SORT_CREATEDON:"CreatedOn",_SORT_CREATEDONREVERSE:"CreatedOnReverse",_SORT_CREATEDBYNAME:"CreatedByName",_SORT_PRIORITY:"Priority",_SORT_PRIORITY_NUMBER:"PriorityNumber",_SORT_TASKTITLE:"TaskTitle",_SORT_COMPLETIONDEADLINE:"CompletionDeadLine",_SORT_COMPLETEDON:"CompletedOn",_SORT_SAPORIGIN:"SAP__Origin",_SORT_INSTANCEID:"InstanceID",_SORT_TASKDEFINITIONID:"TaskDefinitionID",_SORT_TASKDEFINITIONNAME:"TaskDefinitionName",_SORT_STATUS:"Status",_SORT_CREATEDBY:"CreatedBy",_SORT_PROCESSOR:"Processor",_SORT_STARTDEADLINE:"StartDeadLine",_SORT_EXPIRYDATE:"ExpiryDate",_SORT_ISESCALATED:"IsEscalated",_SORT_HASCOMMENTS:"HasComments",_SORT_HASATTACHMENTS:"HasAttachments",_SORT_HASPOTENTIALOWNERS:"HasPotentialOwners",_SORT_CONTEXTSERVICEURL:"ContextServiceURL",_CUSTOM_NUMBER_LABEL:"CustomNumberLabel",_CUSTOM_NUMBER_VALUE:"CustomNumberValue",_CUSTOM_NUMBER_UNIT_LABEL:"CustomNumberUnitLabel",_CUSTOM_NUMBER_UNIT_VALUE:"CustomNumberUnitValue",_CUSTOM_OBJECT_ATTRIBUTE_LABEL:"CustomObjectAttributeLabel",_CUSTOM_OBJECT_ATTRIBUTE_VALUE:"CustomObjectAttributeValue",_GUI_LINK_SELECT_PROPERTY:"GUI_Link",_FUNCTION_IMPORT_DECISION:"Decision",_GROUP_SUPPORTSRELEASE:"SupportsRelease",_GROUP_STATUS_ORDER:[{Status:"READY",TextKey:"group.status.ready"},{Status:"IN_PROGRESS",TextKey:"group.status.in_progress"},{Status:"RESERVED",TextKey:"group.status.reserved"},{Status:"EXECUTED",TextKey:"group.status.executed"},{Status:"FOR_RESUBMISSION",TextKey:"group.status.suspended"},{Status:"COMPLETED",TextKey:"group.status.completed"}],aItemContextPathsToSelect:[],complexFilter:{Priority:[],CompletionDeadLine:[],TaskDefinitionID:[],SubstitutedUser:[],Status:[],CreatedOn:[],CustomNumberValue:[],CustomNumberUnitValue:[],CustomObjectAttributeValue:[]},sSearchPattern_Support:"",sFilterKey_Support:"",sSortKey_Support:"",sGroupkey_Support:"",oConfirmationDialogManager:C,oDataExtension:new e(),bHideHeaderFooterOptions:null,bEnteringMultiSelectMode:null,aSelectProperties:["SAP__Origin","InstanceID","TaskDefinitionID","TaskDefinitionName","TaskTitle","CreatedByName","CreatedBy","CompletionDeadLine","SubstitutedUserName","Status","Priority","PriorityNumber","HasComments","HasAttachments","HasPotentialOwners","CreatedOn","TaskSupports","SupportsClaim","SupportsRelease","SupportsForward","SupportsComments","SupportsAttachments"],aSelectPropertiesOutbox:["CompletedOn","ResumeOn"],sCustomObjectAttributeValue:"CustomObjectAttributeValue",sCustomAttributeDataProperty:"CustomAttributeData",onInit:function(){if(this.getList().getItems().length>0){this.getList().removeItem(0);}this.bInitList=true;this.bEnteringMultiSelectMode=false;var a=this.getOwnerComponent();a.setModel(new J([]),"taskDefinitionsModel");var b=a.getEventBus();b.subscribe("cross.fnd.fiori.inbox","multiselect",this.onMultiSelectEvent,this);b.subscribe("cross.fnd.fiori.inbox","open_supportinfo",this.onSupportInfoOpenEvent,this);b.subscribe("cross.fnd.fiori.inbox.dataManager","multiSelectFilterCompleted",q.proxy(this.onMultiSelectFilterCompleted,this));b.subscribe("cross.fnd.fiori.inbox.dataManager","multiSelectFilterFailed",q.proxy(this.onMultiSelectFilterFailed,this));b.subscribe("cross.fnd.fiori.inbox.dataManager","taskCollectionFailed",q.proxy(this.onTaskCollectionFailed,this));b.subscribe("cross.fnd.fiori.inbox.dataManager","showReleaseLoader",q.proxy(this.onShowReleaseLoader,this));b.subscribe("cross.fnd.fiori.inbox.dataManager","refreshOnError",q.proxy(this.onRefreshOnError,this));b.subscribe("cross.fnd.fiori.inbox","refreshListInternal",q.proxy(this.onRefreshListInternal,this));b.subscribe("cross.fnd.fiori.inbox","storeNextItemsToSelect",q.proxy(this.findNextVisibleItem,this));this.iTotalFilteredItems=0;this.sResubmitUniqueId=this.createId()+"DLG_RESUBMIT";this.oDataManager=a.getDataManager();var h=this.getView().getModel();if(!this.oDataManager){this.oDataManager=new D(this);this.oDataManager.setModel(h);a.setDataManager(this.oDataManager);}if(this.oDataManager.getShowAdditionalAttributes()===true){a.setModel(new J({}),"customAttributeDefinitionsModel");}var j=this.getOwnerComponent().getModel();o.overrideRead(j);this.oDataExtension.overrideBindList(j).overrideProcessSuccess(j).overrideImportData(j);this.overrideMHFHelperSetMasterTitle();this.overrideMHFHelperFooterHandling();this.getView().setModel(j);this.getView().getModel().attachRequestFailed(q.proxy(this.handleRequestFailed,this));this.getView().getModel().attachRequestCompleted(q.proxy(this.handleRequestCompleted,this));this.getView().getModel().attachMetadataFailed(q.proxy(this.handleMetadataFailed,this));this.getView().getModel().setSizeLimit(this.oDataManager.getListSize());this.getView().byId("list").addEventDelegate({onsapselect:function(i){if(!this.getView().getController().isMultiSelectActive()&&i.srcControl instanceof y){var b1=this.getView().getModel("i18n").getResourceBundle().getText("XACT_INFO_on_TASK_SELECT");var c1=document.createElement("span");var id="__InvisibleText_Details_View"+Date.now();c1.setAttribute("id",id);c1.setAttribute("aria-live","assertive");document.body.appendChild(c1);window.setTimeout(function(){document.getElementById(id).innerHTML=b1;},50);window.setTimeout(function(){document.body.removeChild(document.getElementById(id));},500);}}},this);if(this.oDataManager.getPagingEnabled()){this.getList().setGrowing(true).setGrowingScrollToLoad(true).setGrowingThreshold(this.oDataManager.getPageSize());}this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.attachRouteMatched(function(b1){if(b1.getParameter("name")==="master"||((b1.getParameter("name")==="detail"||b1.getParameter("name")==="empty")&&!this.bIsMasterInited)){if(this.bIsMasterInited){if(s.system.phone){var c1=this.getList();c1.removeSelections(true);this.sBindingContextPath=null;}return;}var d1=this;this.oDataManager.attachItemRemoved(q.proxy(this._handleItemRemoved,this));this.oDataManager.attachActionPerformed(q.proxy(this.fnHandleActionPerformed,this));this.sInfoHeaderGroupString=null;this.sInfoHeaderFilterString=null;this.bDisplaySortOption=false;this.sDefaultSortKey=this.oDataManager.bOutbox?this._SORT_COMPLETEDON:this._SORT_CREATEDON;this.sSortKey=null;this.aVisibleSortItems=[];var e1=function(i){return(function(){return d1.sBackendDefaultSortKey===i;});};this.oSortConfig={};this.oSortConfig[this._SORT_CREATEDONREVERSE]={text:"{i18n>sort.createdOnReverse}",getVisible:e1(this._SORT_CREATEDONREVERSE)};this.oSortConfig[this._SORT_CREATEDBYNAME]={text:"{i18n>sort.createdByName}"};this.oSortConfig[this._SORT_PRIORITY]={text:"{i18n>sort.priority}",descending:true};this.oSortConfig[this._SORT_TASKTITLE]={text:"{i18n>sort.taskTitle}"};this.oSortConfig[this._SORT_SAPORIGIN]={text:"{i18n>sort.sapOrigin}",getVisible:e1(this._SORT_SAPORIGIN)};this.oSortConfig[this._SORT_INSTANCEID]={text:"{i18n>sort.instanceID}",getVisible:e1(this._SORT_INSTANCEID)};this.oSortConfig[this._SORT_TASKDEFINITIONID]={text:"{i18n>sort.taskDefinitionID}",getVisible:e1(this._SORT_TASKDEFINITIONID)};this.oSortConfig[this._SORT_TASKDEFINITIONNAME]={text:"{i18n>sort.taskDefinitionName}",getVisible:e1(this._SORT_TASKDEFINITIONNAME)};this.oSortConfig[this._SORT_STATUS]={text:"{i18n>sort.status}",getVisible:e1(this._SORT_STATUS)};this.oSortConfig[this._SORT_CREATEDBY]={text:"{i18n>sort.createdBy}",getVisible:e1(this._SORT_CREATEDBY)};this.oSortConfig[this._SORT_PROCESSOR]={text:"{i18n>sort.processor}",getVisible:e1(this._SORT_PROCESSOR)};this.oSortConfig[this._SORT_STARTDEADLINE]={text:"{i18n>sort.startDeadLine}",getVisible:e1(this._SORT_STARTDEADLINE)};this.oSortConfig[this._SORT_EXPIRYDATE]={text:"{i18n>sort.expiryDate}",getVisible:e1(this._SORT_EXPIRYDATE)};this.oSortConfig[this._SORT_ISESCALATED]={text:"{i18n>sort.isEscalated}",descending:true,getVisible:e1(this._SORT_ISESCALATED)};this.oSortConfig[this._SORT_HASCOMMENTS]={text:"{i18n>sort.hasComments}",descending:true,getVisible:e1(this._SORT_HASCOMMENTS)};this.oSortConfig[this._SORT_HASATTACHMENTS]={text:"{i18n>sort.hasAttachments}",descending:true,getVisible:e1(this._SORT_HASATTACHMENTS)};this.oSortConfig[this._SORT_HASPOTENTIALOWNERS]={text:"{i18n>sort.hasPotentialOwners}",getVisible:e1(this._SORT_HASPOTENTIALOWNERS)};this.oSortConfig[this._SORT_CONTEXTSERVICEURL]={text:"{i18n>sort.contextServiceURL}",getVisible:e1(this._SORT_CONTEXTSERVICEURL)};if(!this.oDataManager.bOutbox){this.oSortConfig[this._SORT_CREATEDON]={text:"{i18n>sort.createdOn}",descending:true,getVisible:e1(this._SORT_CREATEDON)};this.oSortConfig[this._SORT_COMPLETIONDEADLINE]={text:"{i18n>sort.completionDeadLine}"};}else{this.oSortConfig[this._SORT_COMPLETEDON]={text:"{i18n>sort.completedOn}",descending:true};}if(this.extHookChangeSortConfig){this.extHookChangeSortConfig(this.oSortConfig);}this.oGroupConfigItem=null;this.bGroupDescending=false;this.aGroupConfig=[];this.aGroupConfig.push({key:this._SORT_PRIORITY,textKey:"group.priority",formatter:function(i){var f1=i.getProperty(d1._SORT_SAPORIGIN);var g1=i.getProperty(d1._SORT_PRIORITY);return g.formatterPriority.call(d1.getView(),f1,g1);}});this.aGroupConfig.push({key:this._SORT_TASKDEFINITIONNAME,textKey:"group.taskType",formatter:function(i){var f1=i.getProperty(d1._SORT_TASKDEFINITIONNAME);return f1;}});this.aGroupConfig.push({key:this._SORT_STATUS,textKey:"group.status",formatter:function(f1){var g1=d1.getView().getModel("i18n").getResourceBundle();var h1=f1.getProperty(d1._SORT_STATUS);var i1;for(var i=0;i<d1._GROUP_STATUS_ORDER.length;i++){var j1=d1._GROUP_STATUS_ORDER[i];if(j1.Status==h1){i1=j1.TextKey;break;}}return g1.getText(i1);}});if(!this.oDataManager.bOutbox){this.aGroupConfig.push({key:this._GROUP_SUPPORTSRELEASE,textKey:"group.reservation",formatter:function(i){var f1=d1.getView().getModel("i18n").getResourceBundle();var g1=i.getProperty(d1._GROUP_SUPPORTSRELEASE)?"group.reservation.reserved":"group.reservation.notReserved";return f1.getText(g1);}});}if(this.extHookChangeGroupConfig){this.extHookChangeGroupConfig(this.aGroupConfig);}this.bDisplayMultiSelectButton=false;this.clearDecisionButtons();this.oSubHeader=this.getPage().getSubHeader();var h=this.getView().getModel();if(h){if(!this.oDataManager.oModel.getServiceMetadata()){this.oDataManager.oModel.attachMetadataLoaded(q.proxy(function(){this.loadInitialAppData();},this));}else{this.loadInitialAppData();}}this.bIsMasterInited=true;if(b1.getParameter("name")==="detail"){this.sBindingContextPath="/"+b1.getParameter("arguments").contextPath;}}else if(b1.getParameter("name")==="detail"){this.sBindingContextPath="/"+b1.getParameter("arguments").contextPath;}if(b1.getParameter("name")==="detail"||b1.getParameter("name")==="empty"){if(this.oDataManager.bOutbox){g.setShellTitleToOutbox(this.getOwnerComponent(),"cross.fnd.fiori.inbox.view.S2");}else{g.setShellTitleToInbox(this.getOwnerComponent(),"cross.fnd.fiori.inbox.view.S2");}}},this);this.iRequestCountStart++;this.aTaskTypeFilterItemsOrigins=[];this.bGUILinkSelectPropertySupported=false;this.getAppImp().oMHFHelper.defineMasterHeaderFooter(this);var k=q.proxy(function(){if(this.emptyList()){var i=this.getPage();if(i){i.removeContent(this.emptyList());}this.emptyList().destroy();if(this._oControlStore&&this._oControlStore.oMasterSearchField){this._oControlStore.oMasterSearchField.destroy();delete this._oControlStore.oMasterSearchField;}}},this);cross.fnd.fiori.inbox.util.tools.Application.getImpl().registerExitModule(k);b.subscribe("cross.fnd.fiori.inbox","clearSelection",this._clearSelection,this);},_clearSelection:function(){var a=this.getList(),k=this.getAppImp().oConfiguration.keepMultiSelection();if(a&&(a.getMode()!==_.MultiSelect||!k)){a.removeSelections(true);}},noItemFoundForContext:function(){if(s.system.phone){var a=this.getSplitContainer();a.to(this.getView(),"show");}else{this.oRouter.navTo("empty",null,true);}},_areItemsUniqueByTaskType:function(){var a=this.getList().getItems();if(!a||a.length===0){return false;}var b=0;var h=a[b].getBindingContext();if(!h){if(a.length===1){return false;}b+=1;h=a[b].getBindingContext();}var j;var i,k;for(i=b+1,k=a.length;i<k;i++){j=a[i].getBindingContext();if(j&&j.getProperty("TaskDefinitionID")!=h.getProperty("TaskDefinitionID")){return false;}}return true;},_handleItemRemoved:function(a){if(!s.system.phone){var b=this.getList().getSelectedItem();var h=this.getDetailNavigationParameters(b);h.InstanceID+=":";this.oRouter.navTo(this.getDetailRouteName(),h,true);}},handleRequestFailed:function(a){var b=this.getList();var h=this.getView().getModel("i18n").getResourceBundle().getText("view.Workflow.noItemsAvailable");b.setNoDataText(h);},getTotalTaskCount:function(a){if(this.oDataManager.getPagingEnabled()){var b=new RegExp("TaskCollection[?]");if(b.test(a.getParameter("url"))){var h=JSON.parse([a.getParameter("response").responseText]);if(h&&h.d){this.iTaskCount=parseInt(h.d.__count,10);this.bTaskCountFromTaskCollectionCall=true;}}}},handleRequestCompleted:function(a){this.getTotalTaskCount(a);},fnHandleActionPerformed:function(a){this.isActionPerformed=true;},_handleItemPress:function(a){this.setListItem(a.getSource());},getList:function(){return this.byId("list");},emptyList:function(){return this.byId("emptyList");},setListItem:function(i){var a=this.getList();a.removeSelections();i.setSelected(true);a.setSelectedItem(i,true);this.oRouter.navTo("detail",{SAP__Origin:i.getBindingContext().getProperty("SAP__Origin"),InstanceID:i.getBindingContext().getProperty("InstanceID"),contextPath:i.getBindingContext().getPath().substr(1)},!s.system.phone);},fnFindAndSelectNextTaskAfterAction:function(a){if(this.isMultiSelectActive()){this._handleMultiSelectProcessing();return;}this.iTotalFilteredItems=this.getList().getItems().length;if(this.iTotalFilteredItems===0){var b=this.getView().getModel("i18n").getResourceBundle().getText("view.Workflow.noItemsAvailable");this.emptyList().setNoDataText(b);var h=false;this.setListsVisibility(h);if(!s.system.phone){this.oRouter.navTo("empty",null,true);if(!s.system.phone&&this.oDataManager&&this.oDataManager.bOutbox){g.setShellTitleToOutbox(this.getOwnerComponent(),"cross.fnd.fiori.inbox.view.S2");}}return;}var i=this.getList().getItems();var j=this.getList().getSelectedItem();if(this.aItemContextPathsToSelect.length!==0&&i.length>0&&!s.system.phone){var k=false;for(var b1 in this.aItemContextPathsToSelect){var c1=this.aItemContextPathsToSelect[b1];if(k){break;}for(var d1 in i){var e1=i[d1].getBindingContext();if(e1&&e1==c1){k=true;if(j!==null){var f1=j.getBindingContext();if(c1==f1){if(!this.bInitList){var g1={},h1;h1=this.oDataManager.getTableView()&&(!s.system.phone||this.oDataManager.getTableViewOnPhone());g1.bIsTableViewActive=h1;this.oDataManager.fireRefreshDetails(g1);}}else{this.setListItem(i[d1]);}}else{this.setListItem(i[d1]);}break;}}}if(!k){if(this.aItemContextPathsToSelect.length===2&&this.aItemContextPathsToSelect[0]===this.aItemContextPathsToSelect[1]){if(this.iTotalFilteredItems==0){this.noItemFoundForContext();}else{for(var i1 in i){if((i[i1].getVisible())){this.setListItem(i[i1]);break;}}}}else{this.selectIteminListforDeepLink();}}}else{if(i.length>0){this.selectIteminListforDeepLink();}else{if(!this.oDataManager.getCallFromDeepLinkURL()){this.oRouter.navTo("master",null,true);this.oRouter.navTo("empty",null,true);if(!s.system.phone&&this.oDataManager&&this.oDataManager.bOutbox){g.setShellTitleToOutbox(this.getOwnerComponent(),"cross.fnd.fiori.inbox.view.S2");}}else{this.oDataManager.setCallFromDeepLinkURL(false);}}}this.bInitList=false;},selectIteminListforDeepLink:function(){if(this.getList().getItems().length>0){this._selectItemByCtxtPath();return true;}return false;},_handleMultiSelectProcessing:function(){if(this.isMultiSelectActive()){var a=this.getList().getItems();if(a.length!==0){var b=undefined;var i=0;do{b=a[i].getBindingContext();i++;}while(!b);if(this.oDataManager.getShowAdditionalAttributes()===true){this.downloadCustomAttributeDefinition(b.getProperty("SAP__Origin"),b.getProperty("TaskDefinitionID"));}this.downloadDecisionOptions(b.getProperty("SAP__Origin"),b.getProperty("InstanceID"),b.getProperty("TaskDefinitionID"));}else{this.setMultiSelectButtonActive(true);if(!s.system.phone){this.oRouter.navTo("multi_select_summary",{},true);}if(this.oDataManager.getShowAdditionalAttributes()===true){var h=this.getOwnerComponent().getModel("customAttributeDefinitionsModel");h={};M.customAttributeDefinitionsLoaded=new q.Deferred();}}return;}},_selectItemByCtxtPath:function(){if(this.sBindingContextPath){var i=this.findItemByContextPath(this.sBindingContextPath);var b=(this.getView().getModel().getProperty(this.sBindingContextPath))?true:false;if(i&&q.isEmptyObject(i.getBindingContext())){var a=new n(this.getView().getModel(),this.sBindingContextPath);i.setBindingContext(a);}if(i&&b){this.setListItem(i);this.oDataManager.setCallFromDeepLinkURL(false);return true;}else if(!this.oDataManager.getCallFromDeepLinkURL()&&!s.system.phone){this.fnSelectFirstItem();}}else if(!s.system.phone){this.fnSelectFirstItem();}this.oDataManager.setCallFromDeepLinkURL(false);},fnSelectFirstItem:function(){var a=this.getList().getItems();if(a.length>0){var b=undefined;var i=0;do{b=a[i];i++;}while(!b.getBindingContext());this.setListItem(b);}},findNextVisibleItem:function(a,b,i){var h=this.getList();var j=-1;var k=-1;this.aItemContextPathsToSelect=[];for(var b1 in h.getItems()){var c1=h.getItems()[b1].getBindingContextPath();if(c1){var d1=h.getItems()[b1].getBindingContext().getProperty("SAP__Origin");var e1=h.getItems()[b1].getBindingContext().getProperty("InstanceID");if(d1===i.sOrigin&&e1===i.sInstanceID){j=b1;this.aItemContextPathsToSelect.push(c1);}}if((h.getItems()[b1].getVisible())&&((k<=j)||(j==-1))){k=b1;if(j!==-1&&k!==j){break;}}}if((k==-1)&&(h.getItems().length>0)){k=0;}if(k>=0){this.aItemContextPathsToSelect.push(h.getItems()[k].getBindingContextPath());}},overrideMHFHelperSetMasterTitle:function(){var a=this;this.getAppImp().oMHFHelper.setMasterTitle=function(b,i){if(!b._oControlStore.oMasterTitle){return;}this.oDataManager=this.oApplicationImplementation.getComponent().getDataManager();if(!this.oDataManager){return;}if(a._oControlStore.oMasterSearchField.getValue().length==0){var h=a.getList();if(h&&h.getItems()){var j=h.getBinding("items");if(j&&j.aKeys){i=j.aKeys.length;}if(a._oControlStore.oMasterSearchField.getValue()==""&&a.oDataManager.getPagingEnabled()){a.bTaskCountFromTaskCollectionCall=true;}else if(!a.oDataManager.getPagingEnabled()){a.bTaskCountFromTaskCollectionCall=false;}}}else{a.bTaskCountFromTaskCollectionCall=false;}var k=(a.iTaskCount&&a.bTaskCountFromTaskCollectionCall)?a.iTaskCount:i;a.iTotalFilteredItems=k;if(!this.oDataManager.getScenarioConfig()||!this.oDataManager.getScenarioConfig().DisplayName){var b1=cross.fnd.fiori.inbox.util.tools.Application.getImpl().AppI18nModel.getResourceBundle();this.sTitle=b1.getText(b._oHeaderFooterOptions.sI18NMasterTitle,[k]);}else{this.sTitle=this.oDataManager.getScenarioConfig().DisplayName+" ("+k+")";}b._oControlStore.oMasterTitle.setText(this.sTitle);};},overrideMHFHelperFooterHandling:function(){var a=this.getAppImp().oMHFHelper;var b=this;var h=a.defineFooterRight;a.defineFooterRight=function(j){var k=this.getFooterRightCount(j);if(j._oHeaderFooterOptions.oPositiveAction){var b1={};q.extend(b1,j._oHeaderFooterOptions.oPositiveAction);b1.style=$.Accept;j._oControlStore.oButtonListHelper.ensureButton(b1,"b",k);}if(j._oHeaderFooterOptions.oNegativeAction){var b1={};q.extend(b1,j._oHeaderFooterOptions.oNegativeAction);b1.style=$.Reject;j._oControlStore.oButtonListHelper.ensureButton(b1,"b",k);}h.call(this,j);};var i=a.getFooterRightCount;a.getFooterRightCount=function(j){var k;if(b.isMultiSelectActive()){k=2;}else{k=i.call(this,j);}return k;};},onRefreshListInternal:function(){this.getAppImp().oMHFHelper.refreshList(this,true);},applySearchPatternToListItem:function(i,a){this.sSearchPattern_Support=a;if((i.getIntro()&&i.getIntro().toLowerCase().indexOf(a)!=-1)||(i.getTitle()&&i.getTitle().toLowerCase().indexOf(a)!=-1)||(i.getNumber()&&i.getNumber().toLowerCase().indexOf(a)!=-1)||(i.getNumberUnit()&&i.getNumberUnit().toLowerCase().indexOf(a)!=-1)||(i.getFirstStatus()&&i.getFirstStatus().getText().toLowerCase().indexOf(a)!=-1)||(i.getSecondStatus()&&i.getSecondStatus().getText().toLowerCase().indexOf(a)!=-1)){if(this.searchListFlag===0||this.searchListFlag===undefined){this.searchListFlag=1;this.searchListFirstItem=this.getDetailNavigationParameters(i);}return true;}var b=i.getAttributes();for(var j=0;j<b.length;j++){if(b[j].getText().toLowerCase().indexOf(a)!=-1){if(this.searchListFlag===0||this.searchListFlag===undefined){this.searchListFlag=1;this.searchListFirstItem=this.getDetailNavigationParameters(i);}return true;}}return false;},createSubstitutesUserFilterOption:function(){if(this.oDataManager.getSubstitutionEnabled()){var i=this.getView().getModel("i18n").getResourceBundle();var a=this.createSubstitutedUserFilterCategory(i);this.getSubstitutedUsers(a);if(this.oSubstitutedUserFilterKeys){this.resetSubstitutedUserFilterCategoryCount(Object.keys(this.oSubstitutedUserFilterKeys).length);}this.aFilterItems.push(a);}},getHeaderFooterOptions:function(){var a=this;var h={sI18NMasterTitle:"MASTER_TITLE"};if(this.bHideHeaderFooterOptions){return{};}if(!this.isMultiSelectActive()){h.oFilterOptions={onFilterPressed:q.proxy(function(){if(!a.oDataManager.bOutbox){var i=this.getView().getModel("i18n").getResourceBundle();this.aFilterItems=I.getAllFilters(i,this.complexFilter);var b=this.oDataManager.checkEntitySetExistsInMetadata("SubstitutedUsersCollection");if(b){a.createSubstitutesUserFilterOption();}}a.onShowFilter();},a)};if(this.bDisplaySortOption){h.oSortOptions={aSortItems:this.aVisibleSortItems,sSelectedItemKey:this.sSortKey,onSortSelected:q.proxy(a.handleSort,a)};h.oGroupOptions={onGroupPressed:q.proxy(a.onShowGroup,a)};}}if(!this.oDataManager.bOutbox){h.oEditBtn={onBtnPressed:q.proxy(function(){if(!this.isMultiSelectActive()){this.prepareMultiSelect();}else{this.dismissMultiSelect();}},a),bDisabled:!this.bDisplayMultiSelectButton};}if(this.oMultiSelectActions){h.oPositiveAction=this.oMultiSelectActions.positiveAction;h.oNegativeAction=this.oMultiSelectActions.negativeAction;h.buttonList=this.oMultiSelectActions.additionalActions;}return h;},_findFilterKey:function(a){for(var b in this.complexFilter){var h=this.complexFilter[b];for(var i=0;i<h.length;i++){if(h[i]===a){return true;}}}return false;},_resetFilterState:function(){this.complexFilterBackup=this.complexFilter;this.complexFilter={Priority:[],CompletionDeadLine:[],TaskDefinitionID:[],Status:[],CreatedOn:[],CustomNumberValue:[],CustomNumberUnitValue:[],CustomObjectAttributeValue:[],SubstitutedUser:[]};},_saveFilterState:function(a){this._resetFilterState();for(var k in a){var b=k.split(":");if(!this.complexFilter[b[0]]){this.complexFilter[b[0]]=[];}this.complexFilter[b[0]].push(k);}},_createFilterCategory:function(a,b){var i=true;if(arguments.length==2){i=b;}return new z({text:a,multiSelect:i});},_createFilterItem:function(k,a){var b=new G({text:a,key:k});if(this._findFilterKey(k)){b.setSelected(true);}return b;},fnCreateSubstitutedUserFilterKeys:function(a){var b=this;var h=a.getSource().getSelectedItems();var j={};b.sSelectedSubstitutesNameForFilterString="";var k=null;for(var i=0;i<h.length;i++){k=h[i].data("key");j[k]=true;b.sSelectedSubstitutesNameForFilterString=(h.length===1)?h[i].getTitle():b.sSelectedSubstitutesNameForFilterString+h[i].getTitle()+", ";}b.oSubstitutedUserFilterKeys=j;b.resetSubstitutedUserFilterCategoryCount(h.length);},createSubstitutedUserFilterCategory:function(i){var a=new H({text:i.getText("filter.substitutingUserList")});return a;},resetSubstitutesListSelection:function(a){var b=a.getSource();var i=this.getView().getModel("i18n").getResourceBundle();var h=null;q.each(b.getAggregation("filterItems"),function(k,b1){if(b1.getText()==i.getText("filter.substitutingUserList")){h=b1;return;}});if(h){var j=h.getCustomControl();j.removeSelections(true);}this.oSubstitutedUserFilterKeys=null;},storeSubstitutedUserKeysInListItem:function(a,b){if(a){for(var i=0;i<a.length;i++){a[i].data("key",b.oData.oItems[i].key);}}},createDynamicSubstiutedUserList:function(a,b){var h=a;var j=this;var k=this.getView().getModel("i18n").getResourceBundle().getText("view.SubstitutedUserList.noRecipients");var b1=sap.ui.getCore().byId("substituesUser");if(!b1){b1=new K({id:"substituesUser",mode:"MultiSelect"});}var c1=new N({title:"{substitutedUserModel>text}"});b1.attachSelectionChange(function(d1){j.fnCreateSubstitutedUserFilterKeys(d1);});h.setCustomControl(b1);h.setModel(b,"substitutedUserModel");b1.setModel(b,"substitutedUserModel");b1.bindAggregation("items","substitutedUserModel>/oItems",c1);j.storeSubstitutedUserKeysInListItem(b1.getAggregation("items"),b);b1.setNoDataText(k);if(j.oSubstitutedUserFilterKeys){for(var i=0;i<j.aSubstitutedUserFilterItemList.length;i++){if(j.oSubstitutedUserFilterKeys[j.aSubstitutedUserFilterItemList[i].key]){b1.setSelectedItem(b1.getItems()[i]);}}}return h;},createSubstitutedUserFilterItems:function(a,b){var h={text:b,key:a,selected:false};if(this._findFilterKey(a)){h.selected=true;}return h;},getSubstitutedUsers:function(a){var b=new J({});b.setData({oItems:[]});this.createDynamicSubstiutedUserList(a,b);this.aSubstitutedUserFilterItemList=[];this.oSubstitutedUserDynamicFilter=a;var h=function(j){var k=j.results,b1=this;var c1=[];var d1;if(k&&k.length&&k.length>0){var e1=this.getView().getModel("i18n").getResourceBundle();var f1=e1.getText("filter.substitutingUserList.myTasks");var g1={UniqueName:"",DisplayName:f1};c1.push(S._processSubstitutedUsersCollection(g1));}q.each(k,function(j1,k1){if(!q.isEmptyObject(k)){d1=true;q.each(c1,function(j1,l1){if(l1.UniqueName===k1.UniqueName){d1=false;return false;}});}if(d1){c1.push(S._processSubstitutedUsersCollection(k1));}});for(var i=0;i<c1.length;i++){var h1=b1._FILTER_CATEGORY_SUBSTITUTED_USER+":"+c1[i].UniqueName;var i1=this.createSubstitutedUserFilterItems(h1,c1[i].DisplayName);b1.aSubstitutedUserFilterItemList.push(i1);}b.setData({oItems:b1.aSubstitutedUserFilterItemList});b.checkUpdate(true);b1.createDynamicSubstiutedUserList(a,b);};this.oDataManager.readSubstitutedUserList(q.proxy(h,this));},resetSubstitutedUserFilterCategoryCount:function(i){if(this.oSubstitutedUserDynamicFilter!==undefined){this.oSubstitutedUserDynamicFilter.setFilterCount(i);}},onShowFilter:function(){var a=this;a.aTaskTypeFilterItemsOrigins=[];var b=a.getView().getModel("i18n").getResourceBundle();var h=this._createFilterCategory(b.getText("filter.taskType"));this.aTaskTypeFilterItems=new Array();var b1=function(d1){var e1=0;var f1=q.extend(true,{},this.oSubstitutedUserFilterKeys);if(this.oSubstitutedUserDynamicFilter){e1=this.oSubstitutedUserDynamicFilter.getFilterCount();}if(!this.oDataManager.bAllItems){var g1=this.oDataManager.getScenarioConfig().ScenarioServiceInfos;}for(var i=0;i<d1.length;i++){var h1=false;if(this.oDataManager.bAllItems){h1=true;}else{for(var j=0;j<g1.length;j++){for(var k=0;k<g1[j].TaskDefinitionIDs.length;k++){if(d1[i].TaskDefinitionID.toUpperCase().indexOf(g1[j].TaskDefinitionIDs[k].toUpperCase())==0&&(g1[j].Origin===d1[i].SAP__Origin||this.oDataManager.sClientScenario)){h1=true;break;}}}}if(h1){var i1={taskTitle:d1[i].TaskName,taskDefinitionID:d1[i].TaskDefinitionID,SAP__Origin:d1[i].SAP__Origin};this.aTaskTypeFilterItems.push(i1);}}this.aTaskTypeFilterItems.sort(function(n1,o1){var p1=U.isString(n1.taskTitle)?n1.taskTitle:"";var q1=U.isString(o1.taskTitle)?o1.taskTitle:"";if(p1.toUpperCase()<q1.toUpperCase()){return-1;}if(p1.toUpperCase()>q1.toUpperCase()){return 1;}return 0;});for(var i=0;i<this.aTaskTypeFilterItems.length;i++){var j1=this._FILTER_CATEGORY_TASK_DEFINITION_ID+":"+this.aTaskTypeFilterItems[i].taskDefinitionID+":"+this.aTaskTypeFilterItems[i].SAP__Origin;var k1=this._createFilterItem(j1,this.aTaskTypeFilterItems[i].taskTitle);h.addItem(k1);}if(this.oDataManager.bOutbox){this.aFilterItems=O.getAllFilters(b,this.complexFilter);this.aFilterItems.push(h);}else{this.aFilterItems.push(h);}if(this._areItemsUniqueByTaskType()){var l1=null;var m1=this.getList().getItems();if(m1&&m1.length>0){l1=m1[0].getBindingContext();}if(!l1){l1=m1[1].getBindingContext();}}if(this.extHookChangeFilterItems){this.extHookChangeFilterItems(this.aFilterItems);}this.getFilterDialog(b,e1,f1).open();};if(this.getView().getModel("taskDefinitionsModel")){var c1=q.proxy(b1,this);c1((this.getView().getModel("taskDefinitionsModel").getData()));}else{this.oDataManager.readTaskDefinitionCollection(q.proxy(b1,this),q.proxy(b1,this));}},getFilterDialog:function(i,a,b){var h=this;h.resetInitiated=false;if(!this.oFilterDialog){this.oFilterDialog=new sap.m.ViewSettingsDialog({title:i.getText("filter.dialog.title"),filterItems:this.aFilterItems,confirm:function(j){h.oFilterKeys=j.getParameter("filterKeys");if(h.oSubstitutedUserFilterKeys){q.extend(h.oFilterKeys,h.oSubstitutedUserFilterKeys);}if(Object.keys(h.oFilterKeys).length===0){h.sInfoHeaderFilterString=null;}else{var i=h.getView().getModel("i18n").getResourceBundle();var k=null;var b1=j.getParameter("filterString");if(h.oSubstitutedUserFilterKeys){k=h.addFilterTextForSubstitutionFilter(b1,i);}h.sInfoHeaderFilterString=k?k:b1;}h.refreshInfoHeaderToolbar();h._saveFilterState(h.oFilterKeys);h.handleFilter(h.oFilterKeys);},cancel:function(j){if(h.resetInitiated){h.complexFilter=h.complexFilterBackup;h.resetSubstitutedUserFilterCategoryCount(a);h.oSubstitutedUserFilterKeys=b;h.resetInitiated=false;}},resetFilters:function(j){if(!h.resetInitiated){h.resetInitiated=true;h._resetFilterState();}h.resetSubstitutedUserFilterCategoryCount(0);h.resetSubstitutesListSelection(j);}});}return this.oFilterDialog;},addFilterTextForSubstitutionFilter:function(a,i){var b;if(a){b=a+", "+i.getText("filter.substitutingUserList")+" ("+this.sSelectedSubstitutesNameForFilterString+")";}else{b=i.getText("multi.header",i.getText("filter.substitutingUserList")+" ("+this.sSelectedSubstitutesNameForFilterString+")");}return b;},_createGroupSettingItem:function(a,b){var i=this.getView().getModel("i18n").getResourceBundle();if(!b){b=i.getText(a.textKey);}var h=new G({key:a.key,text:b});return h;},onShowGroup:function(){var a=[];for(var i=0;i<this.aGroupConfig.length;i++){var b=this._createGroupSettingItem(this.aGroupConfig[i]);a.push(b);}this.getGroupDialog(a).open();},getGroupDialog:function(a){var b=this;if(!this.oGroupDialog){this.oGroupDialog=new sap.m.ViewSettingsDialog({title:"{i18n>group.dialog.title}",groupItems:a,groupDescending:this.bGroupDescending,selectedGroupItem:this.oGroupConfigItem?this.oGroupConfigItem.key:null,confirm:function(h){var j=h.getParameter("groupItem");if(j&&j.getKey()){var k=j.getKey();for(var i=0;i<b.aGroupConfig.length;i++){var b1=b.aGroupConfig[i];if(b1.key==k){b.oGroupConfigItem=b1;break;}}}else{b.oGroupConfigItem=null;}b.bGroupDescending=h.getParameter("groupDescending");b.handleGroup();}});}return this.oGroupDialog;},_isListFilteredByTaskType:function(b,a){var i,h;for(i=2,h=a.length;i<h;i++){var j=a[i].getBindingContext();if(j&&j.getProperty("TaskDefinitionID")!=b.getProperty("TaskDefinitionID")){return false;}}return true;},prepareMultiSelect:function(){this.setMultiSelectButtonActive(false);var h=this.getList().getItems();if(h.length==0){return;}var b1=function(k1,l1){var m1=[];if(l1&&this.getView().getModel("taskDefinitionsModel")){this.getView().getModel("taskDefinitionsModel").setData(k1,false);}if(!this.oDataManager.bAllItems){var n1=this.oDataManager.getScenarioConfig().ScenarioServiceInfos;}var o1=[];for(var d1 in this.oFilterKeys){if(this.oFilterKeys.hasOwnProperty(d1)&&d1){var e1=d1.split(":");if(e1[0]===this._FILTER_CATEGORY_TASK_DEFINITION_ID){o1.push(e1[1]);}}}for(var i=0;i<k1.length;i++){var p1=false;if(this.oDataManager.bAllItems){p1=true;}else{for(var j=0;j<n1.length;j++){for(var k=0;k<n1[j].TaskDefinitionIDs.length;k++){if(k1[i].TaskDefinitionID.toUpperCase().indexOf(n1[j].TaskDefinitionIDs[k].toUpperCase())===0&&(n1[j].Origin===k1[i].SAP__Origin||this.oDataManager.sClientScenario)){p1=true;break;}}}}if(p1&&(o1.length===0||o1.indexOf(k1[i].TaskDefinitionID)!==-1)){var j1={title:k1[i].TaskName,id:k1[i].TaskDefinitionID,origin:k1[i].SAP__Origin};m1.push(j1);}}if(m1.length>1){m1.sort(function(a,b){if(a.title.toUpperCase()<b.title.toUpperCase())return-1;if(a.title.toUpperCase()>b.title.toUpperCase())return 1;return 0;});M.openFilterDialog(m1,q.proxy(this.multiSelectFilterDialogOK,this),null,l1);return true;}else{var j1=m1[0];this.multiSelectFilterDialogOK(j1);return false;}};var c1=0;for(var d1 in this.oFilterKeys){if(this.oFilterKeys.hasOwnProperty(d1)&&d1){var e1=d1.split(":");if(e1[0]===this._FILTER_CATEGORY_TASK_DEFINITION_ID){c1++;}}}if(c1!==1){if(this.getView().getModel("taskDefinitionsModel")){var f1=q.proxy(b1,this);var g1=f1(this.getView().getModel("taskDefinitionsModel").getData());if(g1){this.oDataManager.readTaskDefinitionCollection(q.proxy(b1,this),null,true);}}else{this.oDataManager.readTaskDefinitionCollection(q.proxy(b1,this));}}else{var h1=this.getList();if(h1.getItems().length!==0){var i1={};for(var i=0;i<h1.getItems().length;i++){i1=h1.getItems()[i].getBindingContext();if(i1){var j1={title:i1.getProperty("TaskDefinitionName"),id:i1.getProperty("TaskDefinitionID"),origin:i1.getProperty("SAP__Origin")};this.multiSelectFilterDialogOK(j1);break;}}}}this.bEnteringMultiSelectMode=true;},dismissMultiSelect:function(){this.isActionPerformed=true;this.sBindingContextPath=undefined;this.setMultiSelectButtonActive(false);this.bEnteringMultiSelectMode=false;var a=this.getList();a.destroyHeaderToolbar();a.destroyInfoToolbar();this.getPage().setSubHeader(this.oSubHeader);if(this._oControlStore.oMasterPullToRefresh)this._oControlStore.oMasterPullToRefresh.setVisible(true);this.refreshInfoHeaderToolbar();a.setMode(this.getView().getModel("device").getProperty("/listMode"));a.removeSelections(true);this.filterItemsByTaskDefinitionID(null);this.clearDecisionButtons();},multiSelectFilterDialogOK:function(a){this.isActionPerformed=true;this.setProcessingMultiSelect({bProcessing:true,oFilterItem:a});this.filterItemsByTaskDefinitionID(a.id,a.origin);},refreshInfoHeaderToolbar:function(a){if(!a){a="";}if(this.sInfoHeaderGroupString){if(a)a+="; ";a+=this.sInfoHeaderGroupString;}if(this.sInfoHeaderFilterString){if(a)a+="; ";a+=this.sInfoHeaderFilterString;}this.refreshInfoHeaderToolbarForList(this.getList(),a);this.refreshInfoHeaderToolbarForList(this.emptyList(),a);},refreshInfoHeaderToolbarForList:function(a,b){var h=a.getHeaderToolbar();if(b){if(!h){h=new Q({design:a1.Info});a.setHeaderToolbar(h);a.addAriaLabelledBy(h.getIdForLabel());}h.destroyContent();h.setHeight();var i=new V({width:"100%"});i.addContent(new W({text:b}));if(this.sSearchPattern_Support&&this.bEnteringMultiSelectMode){var j=this.getView().getModel("i18n").getResourceBundle().getText("multi.header.search",this.sSearchPattern_Support);i.addContent(new W({text:j}));h.setTooltip(b+"\n"+j);if(!s.system.desktop){h.setHeight("100%");}}else{h.setTooltip(b);}h.addContent(i);}else{if(h)a.destroyHeaderToolbar();}},downloadDecisionOptions:function(a,i,b){this.oDataManager.readDecisionOptions(a,i,b,q.proxy(this.downloadDecisionOptionsSuccess,this),null,true);},downloadCustomAttributeDefinition:function(a,b){this.oDataManager.readCustomAttributeDefinitionData(a,b,q.proxy(this.downloadCustomAttributeDefinitionSuccess,this),null,true);},downloadCustomAttributeDefinitionSuccess:function(a){var b=a.CustomAttributeDefinitionData;if(b){var h=this.getOwnerComponent().getModel("customAttributeDefinitionsModel");if(h){h.setData(b);cross.fnd.fiori.inbox.util.MultiSelect.customAttributeDefinitionsLoaded.resolve();}}},downloadDecisionOptionsSuccess:function(a){this.setMultiSelectButtonActive(true);if(!s.system.phone)this.oRouter.navTo("multi_select_summary",{},true);var b=this.getList();this.oSelectAllCheckBox=new X({select:q.proxy(this.handleSelectAllCheckBoxPress,this)});var i=new Q({design:a1.Transparent,content:[this.oSelectAllCheckBox]});i.addStyleClass("crossFndFioriInboxInfoToolbarPadding");b.setInfoToolbar(i);this.getPage().setSubHeader(null);if(this._oControlStore.oMasterPullToRefresh)this._oControlStore.oMasterPullToRefresh.setVisible(false);b.removeSelections(true);this.aMultiSelectDecisionOptions=a;this.getAppImp().oMHFHelper.defineMasterHeaderFooter(this);this.updateSelectAllCheckBox();},_handleSelect:function(a){if(!this.isMultiSelectActive()){this.setListItem(a.getParameter("listItem"));if(!s.system.phone){this.getSplitContainer().hideMaster();}}else{var b=a.getParameter("listItem");var i=b.getBindingContext();this.updateMultiSelectState();var h=[q.extend(true,{},i.getProperty())];h[0].listItem=b;this.publishMultiSelectEvent(a.getParameter("selected"),h);}},updateMultiSelectState:function(){var i=this.getList().getSelectedItems().length;switch(i){case 0:this.hideDecisionButtons();break;default:this.showDecisionButtons();break;}this.updateSelectAllCheckBox();},publishMultiSelectEvent:function(b,a,h,i){var j={};j.Source=i?i:"S2";j.Selected=b;j.WorkItems=a;j.reInitialize=h;cross.fnd.fiori.inbox.util.tools.Application.getImpl().getComponent().getEventBus().publish("cross.fnd.fiori.inbox","multiselect",j);},getActualListItems:function(){var a=[];var b=this.getList().getItems();var i=0;if(b[0]instanceof Y){for(i=1;i<b.length;i++){if(!(b[i]instanceof Y)){if(this.sSearchPattern_Support){if(b[i].getVisible()){a.push(b[i]);}}else{a.push(b[i]);}}}}else if(this.sSearchPattern_Support){for(i=0;i<b.length;i++){if(b[i].getVisible()){a.push(b[i]);}}}else{a=this.getList().getItems();}return a;},updateSelectAllCheckBox:function(){var i=this.getView().getModel("i18n").getResourceBundle();var b=this.getList().getSelectedItems().length<this.getActualListItems().length;if(this.oSelectAllCheckBox){this.oSelectAllCheckBox.setText(i.getText(b?"multi.selectall":"multi.deselectall"));this.oSelectAllCheckBox.setSelected(!b);}},handleSelectAllCheckBoxPress:function(){var a=this.getActualListItems();if(this.getList().getSelectedItems().length<a.length){var b=[];for(var i=0;i<a.length;i++){var h=a[i];if(!h.getBindingContext()){continue;}if(h.getVisible()){h.setSelected(true);var j=q.extend(true,{},h.getBindingContext().getProperty());j.listItem=h;b.push(j);}}this.publishMultiSelectEvent(true,b);}else{this.getList().removeSelections(true);this.publishMultiSelectEvent(false,[]);}this.updateMultiSelectState();},onMultiSelectEvent:function(a,b,h){if(h.Source==="MultiSelectSummary"||h.Source==="action"){var k=this.getList();var b1=k.getItems();for(var i=0;i<h.WorkItems.length;i++){for(var j=0;j<b1.length;j++){var c1=b1[j];var d1=c1.getBindingContext();if(!d1)continue;if(d1.getProperty("SAP__Origin")===h.WorkItems[i].SAP__Origin&&d1.getProperty("InstanceID")===h.WorkItems[i].InstanceID)c1.setSelected(h.Selected);}}this.updateMultiSelectState();}},onSupportInfoOpenEvent:function(a,b,h){if(h.source==="MAIN"){d.setSearchPattern(this.sSearchPattern_Support);d.setFilters(this.sFilterKey_Support);d.setSorters(this.sSortKey_Support);d.setGroup(this.sGroupkey_Support);}},filterItemsByTaskDefinitionID:function(a,b){if(a){this.oFilterKeysBeforeMultiSelect=q.extend(true,{},this.oFilterKeys);var h={};var i=b?b:"";h["TaskDefinitionID:"+a+":"+i]=true;var j=false;for(var k in this.oFilterKeys){if(this.oFilterKeys.hasOwnProperty(k)&&k){var b1=k.split(":");if(b1[0]!==this._FILTER_CATEGORY_TASK_DEFINITION_ID){if(b1[0]===this._FILTER_CATEGORY_STATUS&&b1[1]!==I._FILTER_STATUS_AWAITING_CONFIRMATION){h[k]=true;j=true;}else if(b1[0]!==this._FILTER_CATEGORY_STATUS){h[k]=true;}}}}if(!j){h[this._FILTER_CATEGORY_STATUS+":"+I._FILTER_STATUS_NEW]=true;h[this._FILTER_CATEGORY_STATUS+":"+I._FILTER_STATUS_IN_PROGRESS]=true;h[this._FILTER_CATEGORY_STATUS+":"+I._FILTER_STATUS_RESERVED]=true;}this.oFilterKeys=h;return this.handleFilter(this.oFilterKeys);}else if(this.oFilterKeysBeforeMultiSelect){this.oFilterKeys=q.extend(true,{},this.oFilterKeysBeforeMultiSelect);return this.handleFilter(this.oFilterKeys);}},clearDecisionButtons:function(){this.oMultiSelectActions={positiveAction:null,negativeAction:null,additionalActions:[]};},hideDecisionButtons:function(){this.clearDecisionButtons();this.getAppImp().oMHFHelper.defineMasterHeaderFooter(this);},checkDecisionSupport:function(a){var b;var h={Claim:true,Release:true,Forward:true,Resubmit:true};for(var i=0;i<a.length;i++){b=a[i].getBindingContext();h.Claim=h.Claim&&g.formatterSupportsProperty(b.getProperty("TaskSupports").Claim,b.getProperty("SupportsClaim"));h.Release=h.Release&&g.formatterSupportsProperty(b.getProperty("TaskSupports").Release,b.getProperty("SupportsRelease"));h.Forward=h.Forward&&g.formatterSupportsProperty(b.getProperty("TaskSupports").Forward,b.getProperty("SupportsForward"));h.Resubmit=h.Resubmit&&g.formatterSupportsProperty(b.getProperty("TaskSupports").Resubmit,false);if(!h.Claim&&!h.Release&&!h.Forward&&!h.Resubmit){break;}}return h;},showDecisionButtons:function(){this.clearDecisionButtons();var a=this,b=this.aMultiSelectDecisionOptions?this.aMultiSelectDecisionOptions.length:0;var h=1;var j=0;if(b>0){var k=null;var b1=this.getList().getSelectedItems();if(b1.length>0){k=b1[0].getBindingContext().getProperty("SAP__Origin");}for(var i=0;i<b;i++){var c1=this.aMultiSelectDecisionOptions[i];var d1=c1.DecisionText;c1.SAP__Origin=k;if(!c1.Nature){j=400+h;h++;}else if(c1.Nature.toUpperCase()==="POSITIVE"){j=h;h++;}else if(c1.Nature.toUpperCase()==="NEGATIVE"){j=200+h;h++;}else{j=400+h;h++;}var e1={iDisplayOrderPriority:j,nature:c1.Nature,sBtnTxt:d1,onBtnPressed:(function(c1){return function(){a.showDecisionDialog(c1);};})(c1)};this.oMultiSelectActions.additionalActions.push(e1);}}var f1=this.getList().getSelectedItems();var g1=this.checkDecisionSupport(f1);if(g1.Claim===true){j=1500+h;h++;var h1={iDisplayOrderPriority:j,sI18nBtnTxt:"XBUT_CLAIM",onBtnPressed:q.proxy(this.sendMultiClaimRelease,this,f1,this.oDataManager.sClaimAction)};this.oMultiSelectActions.additionalActions.push(h1);}if(g1.Release===true){j=1500+h;h++;var i1={iDisplayOrderPriority:j,sI18nBtnTxt:"XBUT_RELEASE",onBtnPressed:q.proxy(this.sendMultiClaimRelease,this,f1,this.oDataManager.sReleaseAction)};this.oMultiSelectActions.additionalActions.push(i1);}if(g1.Forward===true){j=1500+h;h++;var j1={iDisplayOrderPriority:j,sI18nBtnTxt:"XBUT_FORWARD",onBtnPressed:q.proxy(this.onForwardPopUp,this)};this.oMultiSelectActions.additionalActions.push(j1);}if(g1.Resubmit===true){j=1500+h;h++;var k1={iDisplayOrderPriority:j,sI18nBtnTxt:"XBUT_RESUBMIT",onBtnPressed:q.proxy(this.showResubmitPopUp,this)};this.oMultiSelectActions.additionalActions.push(k1);}var l1={};l1.oPositiveAction=this.oMultiSelectActions.positiveAction;l1.oNegativeAction=this.oMultiSelectActions.negativeAction;l1.aButtonList=this.oMultiSelectActions.additionalActions;if(this.extHookChangeMassApprovalButtons){this.extHookChangeMassApprovalButtons(l1);this.oMultiSelectActions.positiveAction=l1.oPositiveAction;this.oMultiSelectActions.negativeAction=l1.oNegativeAction;this.oMultiSelectActions.additionalActions=l1.aButtonList;}if(this.oMultiSelectActions&&this.oMultiSelectActions.additionalActions){this.oMultiSelectActions.additionalActions.sort(f.compareButtons);}this.getAppImp().oMHFHelper.defineMasterHeaderFooter(this);},showDecisionDialog:function(a){var b=this.getList().getSelectedItems();var i=this.getView().getModel("i18n").getResourceBundle();var h=a&&(a.ReasonRequired==="REQUIRED"||a.ReasonRequired==="OPTIONAL")?this.oConfirmationDialogManager.loadReasonOptions(a,this.oDataManager):null;var j={question:i.getText(b.length>1?"XMSG_MULTI_DECISION_QUESTION_PLURAL":"XMSG_MULTI_DECISION_QUESTION",[a.DecisionText,b.length]),textAreaLabel:i.getText("XFLD_TextArea_Decision"),showNote:true,title:i.getText("XTIT_SUBMIT_DECISION"),confirmButtonLabel:i.getText("XBUT_SUBMIT"),noteMandatory:a.CommentMandatory,confirmActionHandler:q.proxy(function(k,b1,c1){this.sendMultiSelectAction(k,b1,c1);},this,a)};if(h===null){this.oConfirmationDialogManager.showDecisionDialog(j);}else{h.then(function(k){j["reasonOptionsSettings"]=k;this.oConfirmationDialogManager.showDecisionDialog(j);}.bind(this)).catch(function(k){L.error("Could not load the reason options properly");});}},sendMultiClaimRelease:function(i,a){var b=this.getList().getBinding("items").getLength();var h=(i.length===b)?true:false;this.oDataManager.doMassClaimRelease(i,a,q.proxy(this.sendMultiClaimReleaseSuccess,this,h,a),null);},sendMultiClaimReleaseSuccess:function(a,b,h,i){if(i.length===0){var j,k;var b1=this.getView().getModel("i18n").getResourceBundle();if(b===this.oDataManager.sClaimAction){j="dialog.success.multi_reserve";k="dialog.success.multi_reserve_plural";}else{j="dialog.success.multi_release";k="dialog.success.multi_release_plural";}setTimeout(function(){Z.show(b1.getText(h.length>1?k:j,[h.length]));}.bind(this),500);this.getList().removeSelections(true);this.sendMultiSelectActionEnd(a);}else{M.openMessageDialog(h,i,q.proxy(this.sendMultiSelectActionEnd,this,a,i));}},sendMultiSelectAction:function(a,b,h){var j=this.getList().getSelectedItems();var k=[];for(var i=0;i<j.length;i++){var b1=j[i].getBindingContext().getObject();k.push(b1);}var c1=this.getList().getBinding("items").getLength();var d1=k.length===c1?true:false;this.oDataManager.sendMultiAction(this._FUNCTION_IMPORT_DECISION,k,a,b,h,q.proxy(this.sendMultiSelectActionSuccess,this,d1),null,true);},sendMultiSelectActionSuccess:function(a,b,h){if(h.length===0){var i=this.getView().getModel("i18n").getResourceBundle();setTimeout(function(){Z.show(i.getText(b.length>1?"dialog.success.multi_complete_plural":"dialog.success.multi_complete",b.length));}.bind(this),500);this.sendMultiSelectActionEnd(a);}else{M.openMessageDialog(b,h,q.proxy(this.sendMultiSelectActionEnd,this,a,h));}},sendMultiSelectActionEnd:function(a,b){if(this.oDataManager.getPagingEnabled()){this.oDataManager.oModel.refresh();}if(b){this.publishMultiSelectEvent(true,b,true,"action");}else if(a){this.dismissMultiSelect();this.getView().getModel().bFullRefreshNeeded=true;this.getView().getModel().refresh();}else{this.publishMultiSelectEvent(false,[],true,"action");}},sendMultiSelectForwardSuccess:function(a,b,h,i){if(h.length===0){var j=this.getView().getModel("i18n").getResourceBundle();setTimeout(function(){Z.show(j.getText(b.length>1?"dialog.success.multi_forward_complete_plural":"dialog.success.multi_forward_complete",[b.length,i.DisplayName]));}.bind(this),500);this.sendMultiSelectActionEnd(a);}else{M.openMessageDialog(b,h,q.proxy(this.sendMultiSelectActionEnd,this,a,h));}},isMultiSelectActive:function(){return(this.getList().getMode()==_.MultiSelect);},setProcessingMultiSelect:function(a){this.getView().getModel().oProcessingMultiSelect=q.isEmptyObject(a)?undefined:a;},setMultiSelectButtonActive:function(a){this._oControlStore.bEditState=a;this._oControlStore.oEditBtn.setIcon(a?"sap-icon://sys-cancel":"sap-icon://multi-select");this._oControlStore.oEditBtn.setTooltip(this.getView().getModel("i18n").getResourceBundle().getText(a?"XBUT_CANCEL":"XBUT_MULTI_SELECT"));},loadInitialAppData:function(){this.oDataManager.fetchTaskDefinitionsandCustomAttributeDefinitions(q.proxy(this.oDataManager.initTaskDefnandCustomAttrDefnnModel,this));if(this.oDataManager.sScenarioId||this.oDataManager.sClientScenario){this.oDataManager.loadInitialAppData(q.proxy(function(b){if(!b){return;}this.getView().getModel().ScenarioServiceInfos=b.ScenarioServiceInfos;var a=this.oDataManager.getScenarioConfig();if((b.ScenarioServiceInfos.length===1)||(a.AllItems==true))this.bDisplaySortOption=true;this.bDisplayMultiSelectButton=a.IsMassActionEnabled;this.sBackendDefaultSortKey=a.SortBy;this.fnAddAditionalSelectPropertiesAndInitBinding();if(this.bDisplaySortOption){this.setSortItemsToDisplay();}},this));}else{var a=this.oDataManager.getScenarioConfig();if(a.AllItems===true){this.bDisplayMultiSelectButton=a.IsMassActionEnabled?true:false;this.bDisplaySortOption=true;this.sBackendDefaultSortKey=a.SortBy;this.fnAddAditionalSelectPropertiesAndInitBinding();if(this.bDisplaySortOption){this.setSortItemsToDisplay();}}}},fnAddAditionalSelectPropertiesAndInitBinding:function(){var a=this;a.oDataManager.oModel.getMetaModel().loaded().then(function(b){a.oDataManager.oServiceMetaModel=a.oDataManager.oModel.getMetaModel();if(a.oDataManager.checkPropertyExistsInMetadata("GUI_Link")){a.bGUILinkSelectPropertySupported=true;}a.initListBinding(a.configureSorters(a.sBackendDefaultSortKey),a.getAllFilters());});},initListBinding:function(a,b){var h=this.aSelectProperties.concat();if(this.extHookGetPropertiesToSelect){var i=this.extHookGetPropertiesToSelect();h=h.concat(i);}if(this.oDataManager.bOutbox){h=h.concat(this.aSelectPropertiesOutbox);}if(this.oDataManager.getShowAdditionalAttributes()===true){h.push(this.sCustomAttributeDataProperty);}if(this.bGUILinkSelectPropertySupported){h.push(this._GUI_LINK_SELECT_PROPERTY);}var j="";var k;if(this.oDataManager.getOperationMode()===t.Client){j=t.Client;}else{j=t.Server;if(this.oDataManager.getPagingEnabled()===false){k=true;}}var b1={countMode:u.InlineRepeat,faultTolerant:true,operationMode:j,doNotLoadNewTasksfterAction:k,select:h.join(",")};if(this.oDataManager.getShowAdditionalAttributes()===true){b1.expand="CustomAttributeData";}this.getList().bindAggregation("items",{path:"/TaskCollection",template:this.getView().byId("MAIN_LIST_ITEM"),sorter:a,filters:b,templateShareable:true,parameters:b1});this.registerMasterListBind();},getAllFilters:function(a){var b=[];var h=this.oDataManager.getScenarioConfig();var i=h.AllItems;var j=this.getView().getModel();if(i)b=this.getFiltersWithoutScenario(j);else b=this.getFiltersWithScenario(j);if(a)b.push(a);var k=j.aStatusFilterKeys;var b1=T.getAllFilters(this.oDataManager.bOutbox,k,b);b.push(new p(b1,false));return[new p(b,true)];},getFiltersWithoutScenario:function(a){var b=this;var h=[];var i=a.aTaskDefinitionIDFilterKeys||[];var k=a.aSubstitutedUserFilterKeys||[];var b1=a.aStatusFilterKeys;if(!i)i=[];if(!k)k=[];if(!b1)b1=[];var c1=[];var d1=[];var e1=[];var f1=[];for(var j=0;j<i.length;j++){var g1=new p({path:"TaskDefinitionID",operator:r.EQ,value1:i[j]});c1.push(g1);if(f1.indexOf(b.aTaskTypeFilterItemsOrigins[j])!==-1){continue;}var h1=new p({path:"SAP__Origin",operator:r.EQ,value1:b.aTaskTypeFilterItemsOrigins[j]});e1.push(h1);f1.push(b.aTaskTypeFilterItemsOrigins[j]);}d1=S._getSubstitutedUserFilters(k);if(e1.length>0)h.push(new p(e1,false));if(c1.length>0){h.push(new p(c1,false));}if(d1.length>0){h.push(new p(d1,false));}return h;},getFiltersWithScenario:function(a){var b=[];var h=a.aTaskDefinitionIDFilterKeys;var b1=a.aSubstitutedUserFilterKeys;var c1=a.aStatusFilterKeys;var d1=this.oDataManager.getScenarioConfig();var e1=this;if(!h)h=[];if(!b1)b1=[];if(!c1)c1=[];var f1=[];var g1=[];var h1={};var i1=h.length>0?true:false;var j1=[];var k1=[];var l1=[];for(var i=0;i<d1.ScenarioServiceInfos.length;i++){var m1=d1.ScenarioServiceInfos[i];var n1=false;var o1="";for(var j=0;j<m1.TaskDefinitionIDs.length;j++){n1=false;o1="";for(var k=0;k<h.length;k++){if(h[k].toUpperCase().indexOf(m1.TaskDefinitionIDs[j].toUpperCase())==0){n1=true;o1=h[k];if(!this.oDataManager.sClientScenario){if(g1.indexOf(e1.aTaskTypeFilterItemsOrigins[k])==-1){h1=new p({path:"SAP__Origin",operator:r.EQ,value1:e1.aTaskTypeFilterItemsOrigins[k]});f1.push(h1);g1.push(e1.aTaskTypeFilterItemsOrigins[k]);}}break;}}if(h.length>0&&!n1)continue;if(!n1){o1=m1.TaskDefinitionIDs[j];}if(j1.indexOf(o1)==-1){var p1=new p({path:"TaskDefinitionID",operator:r.EQ,value1:o1});k1.push(p1);}}if(!this.oDataManager.sClientScenario){if(!i1&&g1.indexOf(m1.Origin)==-1){h1=new p({path:"SAP__Origin",operator:r.EQ,value1:m1.Origin});g1.push(m1.Origin);f1.push(h1);}}}l1=S._getSubstitutedUserFilters(b1);if(k1.length>0){b.push(new p(k1,false));}if(f1.length>0){b.push(new p(f1,false));}if(l1.length>0){b.push(new p(l1,false));}return b;},onForwardPopUp:function(){var a=this.getList().getSelectedItems()[0].getBindingContext();var b=a.getProperty("SAP__Origin");var i=a.getProperty("InstanceID");var h=this.getList().getSelectedItems().length;if(this.oDataManager.userSearch){F.open(q.proxy(this.startForwardFilter,this),q.proxy(this.closeForwardPopUp,this),h);this.oDataManager.readPotentialOwners(b,i,q.proxy(this._PotentialOwnersSuccess,this));}else{c.open(q.proxy(this.closeForwardPopUp,this),h);}},showResubmitPopUp:function(){R.open(this.sResubmitUniqueId,this,this.getView());},sendMultiSelectResubmitSuccess:function(a,b,h){if(h.length==0){var i=this.getView().getModel("i18n").getResourceBundle();setTimeout(function(){Z.show(i.getText(b.length>1?"dialog.success.multi_resubmit_multiple_tasks":"dialog.success.multi_resubmit_single_task",[b.length]));}.bind(this),500);this.sendMultiSelectActionEnd(a);}else{M.openMessageDialog(b,h,q.proxy(this.sendMultiSelectActionEnd,this,a,h));}},handleResubmitPopOverOk:function(a){var b=this.getList().getSelectedItems();var h=[];for(var i=0;i<b.length;i++){var j=b[i].getBindingContext().getObject();h.push(j);}var k=this.getList().getBinding("items").getLength();var b1=h.length===k?true:false;var c1=w.byId(this.sResubmitUniqueId,"DATE_RESUBMIT");var d1=c1.getSelectedDates();if(d1.length>0){var e1=d1[0].getStartDate();var f1=x.getDateInstance({pattern:"yyyy-MM-ddTHH:mm:ss"});this.oDataManager.doMassResubmit(h,"datetime'"+f1.format(e1)+"'",q.proxy(this.sendMultiSelectResubmitSuccess,this,b1),null);R.close();}else{this.sendMultiSelectActionEnd();}},_PotentialOwnersSuccess:function(a){F.setAgents(a.results);F.setOrigin(this.getList().getSelectedItems()[0].getBindingContext().getProperty("SAP__Origin"));},startForwardFilter:function(a,b){b=b.toLowerCase();var h=a.getBindingContext().getProperty("DisplayName").toLowerCase();var i=a.getBindingContext().getProperty("Department").toLowerCase();return(h.indexOf(b)!=-1)||(i.indexOf(b)!=-1);},closeForwardPopUp:function(a){if(a&&a.bConfirmed){var b=this.getList().getSelectedItems();var h=[];for(var i=0;i<b.length;i++){var j=q.extend(true,{},b[i].getBindingContext().getObject());j.listItem=b[i];h.push(j);}var k=this.getList().getBinding("items").getLength();var b1=h.length===k?true:false;this.oDataManager.doMassForward(h,a.oAgentToBeForwarded,a.sNote,q.proxy(this.sendMultiSelectForwardSuccess,this,b1),null);}else{this.sendMultiSelectActionEnd(b1);}},_handleListSwipe:function(a){if(this.isMultiSelectActive()){a.bPreventDefault=true;return;}if(!this.oDataManager.getScenarioConfig().IsQuickActionEnabled){a.bPreventDefault=true;L.error("Quick Action is not enabled in Scenario Customizing");}else{var b=a.getParameter("listItem");var j=b.getBindingContext();var k=j.getProperty("SAP__Origin");var b1=j.getProperty("InstanceID");var c1=null;if(j.getProperty("Status")==="EXECUTED"){var d1={};d1.selectedListItem=b;d1.isMandatoryComment=false;d1.text=this.getView().getModel("i18n").getResourceBundle().getText("XBUT_CONFIRM");var e1=a.getParameter("swipeContent");e1.setText(d1.text);var f1=new v({key:"APPROVE_DECISION",value:d1});e1.removeAllCustomData();e1.addCustomData(f1);}else{this.oDataManager.readDecisionOptions(k,b1,j.getProperty("TaskDefinitionID"),function(i1){c1=i1;},null,true);var g1=[];if(c1){for(var h=0;h<c1.length;h++){var h1={};h1.decisionKey=c1[h].DecisionKey;h1.buttonText=c1[h].DecisionText;h1.isApprove=c1[h].Nature==="POSITIVE"?true:false;h1.isReject=c1[h].Nature==="NEGATIVE"?true:false;h1.isNonNature=c1[h].Nature===""?true:false;h1.isMandatoryComment=c1[h].CommentMandatory;g1.push(h1);}}for(var i=0;i<g1.length;i++){if(g1[i].isApprove){var d1={};d1.selectedListItem=b;d1.DecisionKey=g1[i].decisionKey;d1.isMandatoryComment=g1[i].isMandatoryComment;d1.text=g1[i].buttonText;var e1=a.getParameter("swipeContent");e1.setText(d1.text);var f1=new v({key:"APPROVE_DECISION",value:d1});e1.removeAllCustomData();e1.addCustomData(f1);return;}}a.bPreventDefault=true;L.error("No decision option with nature POSITVE found, no swipe possible.");}}},_handleSwipeApproved:function(a){var b=this.getList();var h=b.getSwipedItem();b.swipeOut();var i=a.getSource().getCustomData()[0].getValue();i.InstanceID=h.getBindingContext().getProperty("InstanceID");i.SAP__Origin=h.getBindingContext().getProperty("SAP__Origin");if(i.isMandatoryComment){this.showDecisionDialogForQuickAction(this.oDataManager.FUNCTION_IMPORT_DECISION,i,true);}else{if(h.getBindingContext().getProperty("Status")==="EXECUTED"){var j=this.oDataManager.FUNCTION_IMPORT_CONFIRM;}else{var j=this.oDataManager.FUNCTION_IMPORT_DECISION;}this.oDataManager.sendAction(j,i,"",q.proxy(function(k){setTimeout(function(){Z.show(this.getView().getModel("i18n").getResourceBundle().getText("dialog.success.complete"));}.bind(this),500);},this));}},showDecisionDialogForQuickAction:function(a,b,h){var i=this.getView().getModel("i18n").getResourceBundle();this.oConfirmationDialogManager.showDecisionDialog({question:i.getText("XMSG_DECISION_QUESTION",b.text),textAreaLabel:this.i18nBundle.getText("XFLD_TextArea_Decision"),showNote:h,title:i.getText("XTIT_SUBMIT_DECISION"),confirmButtonLabel:i.getText("XBUT_SUBMIT"),noteMandatory:b.isMandatoryComment,confirmActionHandler:q.proxy(function(b,j){this.oDataManager.sendAction(a,b,j);},this,b)});},onUpdateStarted:function(a){var b=a.getSource();var h=this.getOwnerComponent().getModel("i18n").getResourceBundle().getText("XMSG_LOADING");b.setNoDataText(h);var i=this.getView().getModel();var j=a.getParameter("reason");if(j=="Refresh"&&b.getSelectedItem()){if(i.bFullRefreshNeeded){i.bFullRefreshNeeded=false;}else if(!s.system.phone){this.oDataManager.fireItemRemoved();}}if(j!=="Growing"){this._setListBusyIndicator(true);}},onUpdateFinished:function(a){this._setListBusyIndicator(false);if(!(this.isMultiSelectActive()&&a.getParameter("reason")=="Growing")&&(this.isActionPerformed||(this.oDataManager.getCallFromDeepLinkURL()&&a.getSource().getItems().length>0)||a.getParameter("reason")=="Refresh")){this.fnFindAndSelectNextTaskAfterAction(a);this.isActionPerformed=false;}if(this.isMultiSelectActive()&&a.getParameter("reason")==="Growing"){this.updateMultiSelectState();}if(a.getParameter("actual")===a.getParameter("total")){this.bTaskCountFromTaskCollectionCall=false;}var b=a.getSource();if(!s.system.phone&&this.isMultiSelectActive()==false&&a.getParameter("reason")!=="Growing"){if(b.getSelectedItem()&&b.getSelectedItem().$().offset()&&b.getItems()[0].$().offset()){b.getParent().scrollTo(b.getSelectedItem().$().offset().top-b.getItems()[0].$().offset().top,0);}}var h=this.getView().getModel("i18n").getResourceBundle().getText("view.Workflow.noItemsAvailable");b.setNoDataText(h);var i=a.getSource().getItems();if(i&&i[0]&&i[0]instanceof Y&&this._oControlStore.oMasterSearchField.getValue()===""){this.applySearchPatternBase("");}},onDataLoaded:function(){},getDetailNavigationParameters:function(a){var b=this.getView().getModel().getProperty(a.getBindingContext().getPath());return{SAP__Origin:encodeURIComponent(b.SAP__Origin),InstanceID:encodeURIComponent(b.InstanceID),contextPath:a.getBindingContext().getPath().substr(1)};},applySearchPattern:function(a){var i=this.applySearchPatternBase(a);var k=(i>0||a=="")?"view.Workflow.noItemsAvailable":"view.Workflow.noMatchingItems";var b=this.getView().getModel("i18n").getResourceBundle().getText(k);this.getList().setNoDataText(b);this.searchListFlag=0;if(this.isMultiSelectActive()){return i;}if(!s.system.phone){if(i===0){this.oRouter.navTo("empty",null,true);this.getList().removeSelections(true);if(this.oDataManager&&this.oDataManager.bOutbox){g.setShellTitleToOutbox(this.getOwnerComponent(),"cross.fnd.fiori.inbox.view.S2");}}else{this.oRouter.navTo("detail",this.searchListFirstItem,true);var h=this.findItemByContextPath("/"+this.searchListFirstItem.contextPath);if(h){this._clearSelection();h.setSelected(true);}}}return i;},_getBindingContextOfFirstItem:function(){var a=this.getList().getItems();var b=null;if(a.length==1){b=a[0].getBindingContext();}if(!b){b=a[1].getBindingContext();}return b;},setSortItemsToDisplay:function(){var a;var b;this.aVisibleSortItems=[];for(var h in this.oSortConfig){a=this.oSortConfig[h];b=a.getVisible?a.getVisible():true;if(b){this.aVisibleSortItems.push({key:h,text:a.text});}}},handleFilter:function(a){this.aItemContextPathsToSelect=[];this.aTaskTypeFilterItemsOrigins=[];var b=this.getFilter(a);this.sFilterKey_Support=a;var h=this.getAllFilters(b);var i=this.getList().getBinding("items");i.aApplicationFilters=[];this.iTotalFilteredItems=i.filter(h).iLastEndIndex;this.isActionPerformed=true;},onMultiSelectFilterCompleted:function(a,b,h){var i=this.getList();i.removeSelections(true);var j=this.getView().getModel("i18n").getResourceBundle();this.refreshInfoHeaderToolbar(j.getText("multi.header",j.getText("group.taskType")+" ("+h.oFilterItem.title+")"));i.setMode(_.MultiSelect);this.setProcessingMultiSelect({});},onMultiSelectFilterFailed:function(){this.setProcessingMultiSelect({});},onTaskCollectionFailed:function(){this.removeHeaderFooterOptions();},onShowReleaseLoader:function(a,b,h){var i=this.getList();if(i){i.setEnableBusyIndicator(h.bValue);}this.getView().setBusyIndicatorDelay(1000);this.getView().setBusy(h.bValue);},onRefreshOnError:function(){this.sBindingContextPath=undefined;this.oRouter.navTo("master",{},true);},handleSort:function(a){this.aItemContextPathsToSelect=[];this.sSortKey_Support=a;var b=this.configureSorters(a);this.getList().getBinding("items").sort(b);},handleGroup:function(){this.aItemContextPathsToSelect=[];var a=this.configureSorters(this.sSortKey);this.getList().getBinding("items").sort(a);this.isActionPerformed=true;},configureSorters:function(a){var b;var h=[];var i=null;var j=null;var k=null;var b1=this.getView().getModel("i18n").getResourceBundle();if(this.oGroupConfigItem){k=this.oGroupConfigItem.key;var c1=this.bGroupDescending;var d1=this.oGroupConfigItem.formatter||true;switch(this.oGroupConfigItem.key){case this._SORT_PRIORITY:k=this._SORT_PRIORITY_NUMBER;c1=!c1;break;}b=new m(k,c1,d1);h.push(b);this.sInfoHeaderGroupString=b1.getText("group.header",b1.getText(this.oGroupConfigItem.textKey));}else{this.sInfoHeaderGroupString=null;}this.refreshInfoHeaderToolbar();if(!a)a=this.sDefaultSortKey;if(!this.oSortConfig[a]){a=this.sDefaultSortKey;}var e1=a;var f1=this.oSortConfig[a].descending;switch(a){case this._SORT_PRIORITY:e1=this._SORT_PRIORITY_NUMBER;f1=!f1;break;case this._SORT_CREATEDONREVERSE:e1=this._SORT_CREATEDON;break;}if(k!=e1){b=new m(e1,f1);h.push(b);}var g1=this.getView().getModel();g1.extFnCustomGrouper=j?q.proxy(j,this):null;g1.extFnCustomSorter=i?q.proxy(i,this):null;g1.extSGroupingProperty=k;this.sSortKey=a;this.sGroupkey_Support=k;return h;},isBackendDefaultSortKeyEqualsTo:function(a){return(this.sBackendDefaultSortKey===a);},completionDeadLineSorter:function(i,a){if(!i[this._SORT_COMPLETIONDEADLINE]){return 1;}if(!a[this._SORT_COMPLETIONDEADLINE]){return-1;}return(i[this._SORT_COMPLETIONDEADLINE]-a[this._SORT_COMPLETIONDEADLINE]);},statusGrouper:function(a,b,h){var j;var k;var b1=h?-1:1;for(var i=0;i<this._GROUP_STATUS_ORDER.length;i++){var c1=this._GROUP_STATUS_ORDER[i];if(c1.Status==a.GroupingValue)j=i;if(c1.Status==b.GroupingValue)k=i;}return(j-k)*b1;},getFilter:function(a){var b=[];var h=[];var i=null;var j=[];var k=[];var b1=[];var c1=[];var d1=[];var e1=null;var f1=null;var g1=null;for(var h1 in a){if(a.hasOwnProperty(h1)&&h1){var i1=h1.split(":");switch(i1[0]){case this._FILTER_CATEGORY_PRIORITY:var j1=I.getFilterForPriorityBykey(i1);if(j1!=null){h.push(j1);}break;case this._FILTER_CATEGORY_COMPLETION_DEADLINE:i=I.getFilterForDueDateByKey(i1);break;case this._FILTER_CATEGORY_STATUS:var k1=I.getFilterForStatusByKey(i1);if(k1!=null){c1.push(k1);}break;case this._FILTER_CATEGORY_CREATION_DATE:e1=I.getFilterForCreationDateByKey(i1);break;case this._FILTER_CATEGORY_COMPLETED:f1=O.getCompletedFilterByKey(i1);break;case this._FILTER_CATEGORY_SNOOZED:g1=O.getResumeOnFilterByKey(i1);break;case this._FILTER_CATEGORY_TASK_DEFINITION_ID:j.push(new p(i1[0],r.EQ,i1[1]));k.push(i1[1]);this.aTaskTypeFilterItemsOrigins.push(i1[2]);break;case this._FILTER_CATEGORY_SUBSTITUTED_USER:b1.push(i1[1]);break;default:if(i1[0]&&i1[1]&&i1[0]!=="undefined"&&i1[1]!=="undefined"){d1.push(new p(i1[0],r.EQ,i1[1]));}}}}var l1={selectedFilterOptions:a,taskDefinitionFilter:k,substitutedUserFilter:b1,statusFilter:c1,priorityFilter:h,dueDateFilter:i,creationDateFilter:e1,completedDateFilter:f1,resumeDateFilter:g1,additionalFilters:d1};if(this.extHookGetCustomFilter){this.extHookGetCustomFilter(l1);}this.getView().getModel().aTaskDefinitionIDFilterKeys=l1.taskDefinitionFilter;this.getView().getModel().aSubstitutedUserFilterKeys=l1.substitutedUserFilter;this.getView().getModel().aStatusFilterKeys=l1.statusFilter;if(l1.priorityFilter.length>1){b.push(new p(l1.priorityFilter,false));}else if(l1.priorityFilter.length===1){b.push(l1.priorityFilter[0]);}if(l1.dueDateFilter){b.push(l1.dueDateFilter);}if(l1.creationDateFilter){b.push(l1.creationDateFilter);}if(l1.completedDateFilter){b.push(l1.completedDateFilter);}if(l1.resumeDateFilter){b.push(l1.resumeDateFilter);}if(l1.additionalFilters.length>1){b.push(new p(l1.additionalFilters,true));}else if(l1.additionalFilters.length===1){b.push(l1.additionalFilters[0]);}if(b.length>1){return new p(b,true);}else if(b.length===1){return b[0];}return null;},handleMetadataFailed:function(a){this.removeHeaderFooterOptions();this.oDataManager.handleMetadataFailed(a);},removeHeaderFooterOptions:function(){this.bHideHeaderFooterOptions=true;this.getAppImp().oMHFHelper.defineMasterHeaderFooter(this);},_setListBusyIndicator:function(b){if(b){this.getList().setBusyIndicatorDelay(1000);this.getList().setBusy(true);}else{this.getList().setBusy(false);}},getNextItemsToSelect:function(){return this.aItemContextPathsToSelect;},applySearchPatternBase:function(a){a=a.toLowerCase();var b=this.getList().getItems();var h;var j=0;var k=null;var b1=0;for(var i=0;i<b.length;i++){if(b[i]instanceof Y){if(k){if(b1==0){k.setVisible(false);}else{k.setVisible(true);k.setCount(b1);k.setTooltip(k.getTitle()+' ('+b1+')');}}k=b[i];b1=0;}else{h=this.applySearchPatternToListItem(b[i],a);b[i].setVisible(h);if(h){j++;b1++;}}}if(k){if(b1==0){k.setVisible(false);}else{k.setVisible(true);k.setCount(b1);k.setTooltip(k.getTitle()+' ('+b1+')');}}if(!a){if(this._oMasterListBinding){j=this._oMasterListBinding.getLength();}}return j;},getPage:function(){return l.getPageFromController(this);},findItemByContextPath:function(a){var b;var h=this.getList();var i=h.getItems();var j=q.grep(i,function(k){b=k.getBindingContext();if(k instanceof Y){return false;}if(b&&(b.getPath()!==a)){return false;}return true;});return j[0]||null;},setListsVisibility:function(b){this.emptyList().setVisible(b);this.getList().setVisible(!b);},getAppImp:function(){return cross.fnd.fiori.inbox.util.tools.Application.getImpl();},_applyClientSideSearch:function(){var a=this._oControlStore.oMasterSearchField.getValue();var i=this.applySearchPattern(a);this.getAppImp().oMHFHelper.setMasterTitle(this,i);this.evaluateClientSearchResult(i,this.getList(),this.emptyList());},evaluateClientSearchResult:function(i,a,b,h){var j=h;var k;if(i===0){if(j===null||j===undefined){j=a.getNoDataText();}b.setNoDataText(j);k=true;this.setListsVisibility(k);}else{k=false;this.setListsVisibility(k);}},registerMasterListBind:function(){var a=this.getList();var b=a.getBinding("items");var h=this.getAppImp().getConnectionManager();var i=h.iRequestCount;this.getAppImp().setMasterListBinding(this,b);if(i===h.iRequestCount){this.getAppImp().oMHFHelper.defineMasterHeaderFooter(this);}},getDetailRouteName:function(){return"detail";},_onMasterListLoaded:function(a){this.onDataLoaded();this.getAppImp().onMasterRefreshed(this);a.oSource.detachChange(this._onMasterListLoaded,this);this._bListLoaded=true;this.fireEvent("_onMasterListLoaded");},_onMasterListChanged:function(a){this.getAppImp().onMasterChanged(this);this.selectItemMatchingTheLastNavigation();var b=this.getList();if(b&&b.getMode()==="MultiSelect"&&this.getAppImp().bManualMasterRefresh===true){b.removeSelections(true);}if(b.getBinding("items").getLength()>0){var h=false;this.setListsVisibility(h);}},selectItemMatchingTheLastNavigation:function(){var a=this.getList();if(a.getMode()==="MultiSelect"){return;}if(this._sDetailContextPath===undefined){return;}var i=a.getSelectedItem();var b=i&&i.getBindingContext();if(b&&b.getPath()===this._sDetailContextPath){return;}i=this.findItemByContextPath(this._sDetailContextPath);this._clearSelection();if(i){i.setSelected(true);}},getSplitContainer:function(){return this.getView().getParent().getParent();}});});
