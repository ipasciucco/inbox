/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/Device","cross/fnd/fiori/inbox/util/AddInbox","cross/fnd/fiori/inbox/util/EmployeeCard","cross/fnd/fiori/inbox/util/Conversions"],function(C,D,A,E,a){"use strict";return C.extend("cross.fnd.fiori.inbox.view.AddInbox",{_oDialog:null,_oDataManager:null,_bRefreshOnCloseDialog:null,_oList:null,onInit:function(){this.getView().setModel(cross.fnd.fiori.inbox.util.tools.Application.getImpl().AppI18nModel,"i18n");this._oDialog=this.getView().byId("DLG_ADD_INBOX");this._oList=this.getView().byId("LST_USERS");this._oDataManager=cross.fnd.fiori.inbox.util.tools.Application.getImpl().getComponent().getDataManager();if(D.system.phone){this._oDialog.setStretch(true);}},onCancelDialog:function(e){if(this._bRefreshOnCloseDialog){this._oDataManager.refreshListOnAddInboxDone(e);}this._oDialog.close();},updateSubstitutionRuleSuccess:function(s){if(s>0){this._bRefreshOnCloseDialog=true;}this._setListBusyLoader(false);A.refreshDataAfterUpdateSubstitutionRule();},updateSubstitutionRuleError:function(){this._setListBusyLoader(false);},handleChange:function(e){var b=e.getSource().getBindingContext();var o=this._oDialog.getModel();var c=o.getProperty(b.getPath(),b);var d=e.getParameter("state")?true:false;if(c.aDisabledRules.length>0||c.aEnabledRules.length>0){this._setListBusyLoader(true);this._oDataManager.updateSubstitutionRule(c,d,this.updateSubstitutionRuleSuccess.bind(this),this.updateSubstitutionRuleError.bind(this));}},onBeforeOpenDialog:function(){this._bRefreshOnCloseDialog=null;},onSelectUserLink:function(e){var b=e.getSource().getBindingContext();var d=this._oDialog.getModel();var s=a.getSelectedControl(e);this._setListBusyLoader(true);this._oDataManager.readUserInfo(d.getProperty("SAP__Origin",b),d.getProperty("User",b),this._showEmployeeCard.bind(this,s),function(){this._setListBusyLoader(false);}.bind(this),true);},_showEmployeeCard:function(c,r){this._setListBusyLoader(false);E.displayEmployeeCard(c,r);},_setListBusyLoader:function(s){if(s){this._oList.setBusyIndicatorDelay(1000);}this._oList.setBusy(s);}});});
