/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/core/UIComponent","sap/ui/Device","sap/base/Log","sap/f/FlexibleColumnLayoutSemanticHelper","cross/fnd/fiori/inbox/model/models","cross/fnd/fiori/inbox/controller/ErrorHandler","cross/fnd/fiori/inbox/util/StartupParameters","sap/ui/core/routing/HashChanger","sap/ui/core/library","sap/f/library","cross/fnd/fiori/inbox/util/Parser","sap/ushell/services/AppConfiguration"],function(U,D,L,F,m,E,S,H,a,l,P,A){"use strict";var b=l.LayoutType;var V=a.mvc.ViewType;return U.extend("cross.fnd.fiori.inbox.Component",{metadata:{manifest:"json"},init:function(){this.initShellUIService();U.prototype.init.apply(this,arguments);this.getRouter().initialize();},destroy:function(){if(this._oErrorHandler){this._oErrorHandler.destroy();}U.prototype.destroy.apply(this,arguments);},initShellUIService:function(){if(sap.ushell&&sap.ushell.ui5service&&sap.ushell.ui5service.ShellUIService){this.getService("ShellUIService").then(function(s){this.oShellUIService=s;}.bind(this),function(e){L.error("Cannot get ShellUIService",e,"cross.fnd.fiori.inbox.Component");});}},createContent:function(){var v={component:this};this.oStartupParameters=S.getInstance(this);if(this.oStartupParameters.isModeActive()){this._oErrorHandler=new E(this);this.setModel(m.getDeviceModel(),"device");}var r=new sap.ui.view({viewName:"cross.fnd.fiori.inbox.view.App",type:V.XML,viewData:v});r.addStyleClass(this.getContentDensityClass());var d=this.getDataManager();var i=d.sTaskInstanceID;var s=d.sSapOrigin;var h=H.getInstance();if(i&&s&&window.location.href.indexOf("&/")===-1){var u=this._getAppSpecificURL(i,s);if(u){var c=window.location.href.split("#");var e=c[0];h.replaceHash(u);var f=this._getFullHash(u);if(window.history.replaceState){if(e.indexOf("InstanceID")!==-1&&e.indexOf("SAP__Origin")!==-1){e=P.removeParamsFromUrl(["InstanceID","SAP__Origin"],e);window.history.replaceState({fromExternal:true},null,e+"#"+f);}else{window.history.replaceState({fromExternal:true},null,"#"+f);}}}}var R=this.getRouter();var g;if(d.getTableView()&&(!D.system.phone||d.getTableViewOnPhone())){var j=h.getHash();if(!j.startsWith("detail_deep")){g=R.getURL("table_view",{});if(g){h.replaceHash(g);}}}if(this.oStartupParameters.isModeActive()){g=R.getURL("myTasksMaster",{});if(g){h.replaceHash(g);}}return r;},setDataManager:function(d){this.oDataManager=d;},getDataManager:function(){return this.oDataManager;},getContentDensityClass:function(){if(this._sContentDensityClass===undefined){var d=document.body.classList;if(d.contains("sapUiSizeCozy")||d.contains("sapUiSizeCompact")){this._sContentDensityClass="";}else if(!D.support.touch){this._sContentDensityClass="sapUiSizeCompact";}else{this._sContentDensityClass="sapUiSizeCozy";}}return this._sContentDensityClass;},_getAppSpecificURL:function(i,s){var u;if(i&&s){var r=this.getRouter();u=r.getURL("detail",{SAP__Origin:s,InstanceID:i,contextPath:"TaskCollection(SAP__Origin='"+s+"',InstanceID='"+i+"')"});}return u;},_getFullHash:function(c){var u="";if(c){if(sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService){var x=sap.ushell.Container.getService("CrossApplicationNavigation");u=x.hrefForAppSpecificHash(c);var d=sap.ushell.Container.getService("URLParsing");var s=d.parseShellHash(u);u=d.constructShellHash(s);}else{L.error("sap.ushell.Container.getService is not found.");}}return u;},active:function(){var f=false;if(this.getDataManager().getFullWidth()||this.oStartupParameters.isModeActive()){f=true;}A.setApplicationFullWidth(f);},getErrorHandler:function(){return this._oErrorHandler;},getFCLHelper:function(){var f=this.getRootControl().byId("fcl"),s={defaultTwoColumnLayoutType:b.TwoColumnsMidExpanded,defaultThreeColumnLayoutType:b.ThreeColumnsMidExpanded};return F.getInstanceFor(f,s);}});});
