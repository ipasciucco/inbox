/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/base/Object","sap/ui/model/json/JSONModel","sap/ui/core/library","sap/ui/core/Fragment","sap/base/Log","sap/ui/thirdparty/jquery"],function(O,J,l,F,B,q){"use strict";var V=l.ValueState;return{AppI18nModel:null,showDecisionDialog:function(d){if(d.i18nModel){this.AppI18nModel=d.i18nModel;}else{this.AppI18nModel=cross.fnd.fiori.inbox.util.tools.Application.getImpl().AppI18nModel;}d=this._initializeDialogSettings(d);this.confirmationDialogModel=new J({submitButtonEnabled:!d.noteMandatory&&!d.reasonOptionsSettings.required,dialogSettings:d,reasonOptionsSettings:d.reasonOptionsSettings});this.confirmationDialogPromise=F.load({type:"XML",name:"cross.fnd.fiori.inbox.frag.ConfirmationDialog",controller:this}).then(function(c){c.setModel(this.confirmationDialogModel);c.setModel(this.AppI18nModel,"i18n");c.open();return c;}.bind(this)).catch(function(){B.error("Confirmation dialog was not created successfully");});},loadReasonOptions:function(d,D){if(D.checkFunctionImportExistsInMetadata(D.FUNCTION_IMPORT_REASONOPTIONS)){return new Promise(function(r,a){D.readReasonOptions(d.SAP__Origin,d.InstanceID,d.DecisionKey,function(b){var c={show:(d.ReasonRequired==="REQUIRED"||d.ReasonRequired==="OPTIONAL")&&b.length>0,required:d.ReasonRequired==="REQUIRED",reasonOptions:b};r(c);},function(e){a(e);});});}else{return null;}},handleSubmit:function(){this.confirmationDialogPromise.then(function(c){var d=this.confirmationDialogModel.getData().dialogSettings;var r=this.confirmationDialogModel.getData().reasonOptionsSettings;var a=r.show?sap.ui.getCore().byId("reasonOptionsSelect").getSelectedItem():null;var R=a!==null&&a.getKey()!=="defaultSelectedKey"?a.getKey():null;var n=d.showNote?sap.ui.getCore().byId("confirmDialogTextarea").getValue():null;d.confirmActionHandler(n,R);c._bClosedViaButton=true;c.close();}.bind(this));},handleCancel:function(){var t=this;t.confirmationDialogPromise.then(function(c){var d=t.confirmationDialogModel.getData().dialogSettings;c._bClosedViaButton=true;c.close();d.cancelActionHandler();});},handleReasonOptionChange:function(e){var c=e.getSource();this.confirmationDialogPromise.then(function(a){var b=this.confirmationDialogModel.getData().reasonOptionsSettings.required;c.setTooltip(c.getValue());c.setValueState(c.getSelectedItem()===null?V.Error:V.None);if(!b&&c.getValue()===""){c.setValueState(V.None);}if(!b&&c.getValue()!==""&&c.getSelectedItem()===null){a.getBeginButton().setEnabled(false);return;}this._toggleSubmitButtonState();}.bind(this));},handleNoteLiveChange:function(){this._toggleSubmitButtonState();},handleAfterClose:function(){var t=this;t.confirmationDialogPromise.then(function(c){if(c._bClosedViaButton){delete c._bClosedViaButton;}else{var d=t.confirmationDialogModel.getData().dialogSettings;d.cancelActionHandler();}c.destroy();}.bind(this));},_buildNoneOption:function(d){if(d.reasonOptionsSettings&&d.reasonOptionsSettings.reasonOptions&&!d.reasonOptionsSettings.required){var n="("+this.AppI18nModel.getResourceBundle().getText("XSEL_DECISION_REASON_NONE_OPTION")+")";d.reasonOptionsSettings.reasonOptions.unshift({Name:n,Code:"defaultSelectedKey"});}},_initializeDialogSettings:function(d){this._buildNoneOption(d);return q.extend({noteMandatory:false,question:"",title:"",confirmButtonLabel:"",showNote:false,reasonOptionsSettings:{show:false,required:false},confirmActionHandler:function(){return;},cancelActionHandler:function(){return;},},d);},_toggleSubmitButtonState:function(){var d=this.confirmationDialogModel.getData();var n=d.dialogSettings.noteMandatory;var a=sap.ui.getCore().byId("confirmDialogTextarea").getValue().trim().length>0;var c=d.reasonOptionsSettings.required;var b=sap.ui.getCore().byId("reasonOptionsSelect").getSelectedItem()!==null;var e=(n&&a)||!n;var f=(c&&b)||!c;this.confirmationDialogModel.setProperty("/submitButtonEnabled",e&&f);}};},true);
