/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["sap/ui/base/Object","cross/fnd/fiori/inbox/util/tools/CommonHeaderFooterHelper","sap/m/Bar","sap/m/GroupHeaderListItem","sap/ui/Device","sap/m/SearchField","sap/m/PullToRefresh","sap/m/Title","sap/m/Button","sap/ui/core/library"],function(B,C,a,G,D,S,P,T,b,U){"use strict";var c=U.TitleLevel;B.extend("cross.fnd.fiori.inbox.util.tools.MasterHeaderFooterHelper",{constructor:function(A){this.oApplicationImplementation=A;this.oCommonHeaderFooterHelper=new C(A,{});},defineMasterHeaderFooter:function(o,A){this.defineMasterHeaderFooterInner(o,A);},defineMasterHeaderFooterInner:function(o,A){var O=o.getHeaderFooterOptions();this.setHeaderFooter(o,O,A);},setHeaderFooter:function(o,O,A,k){if(!O){return;}var p=this.oCommonHeaderFooterHelper.startBuild(o,O,{bEditState:false,bIsSearching:false,bAllDisabled:A},k);this.defineHeader(o,p);this.defineFooter(o,p);this.oApplicationImplementation.oCurController.MasterCtrl=o;this.oApplicationImplementation.oCurController.FullCtrl=null;this.oCommonHeaderFooterHelper.endBuild(o);},defineHeader:function(o,p){var d=p.getCustomHeader();if(!d){d=new a();p.setCustomHeader(d);}this.defineMasterSubHeader(o,p);var e=-1;if(o._oControlStore.oMasterSearchField){var f=o._oControlStore.oMasterSearchField.getValue();if(f){e=o.applySearchPattern(f);o.evaluateClientSearchResult(e,o.getList(),o._emptyList);}}if(e<0){if(o._oMasterListBinding){e=o._oMasterListBinding.getLength();}else{var l=o.getList();var I=l.getItems();e=0;for(var i=0;i<I.length;i++){if(!(I[i]instanceof G)){e++;}}}}this.defineMasterTitle(o,d,e);this.oCommonHeaderFooterHelper.setBackButton(o,d,true);this.defineEditButton(o,d);},defineFooter:function(o,p){this.defineSettingsButton(o);this.defineFooterRight(o);},defineMasterSubHeader:function(o,p){if(o._oControlStore.oMasterSearchField||o._oControlStore.oMasterPullToRefresh){return;}var s=new a();p.setSubHeader(s);var i=D.support.touch;this.createMasterSearchField(o,s,i);if(i&&!o._oControlStore.bAllDisabled){this.createMasterPullToRefresh(o,p);}},createMasterSearchField:function(o,s,i){o._oControlStore.oMasterSearchField=new S({id:this.oCommonHeaderFooterHelper.createId(o,"myInbox_SEARCH")});o._oControlStore.oMasterSearchField.setEnabled(!o._oControlStore.bAllDisabled);if(!i){o._oControlStore.oMasterSearchField.setShowRefreshButton(true);o._oControlStore.oMasterSearchField.setRefreshButtonTooltip(o.getOwnerComponent().getModel("i18n").getResourceBundle().getText("XBUT_REFRESH"));}o._oControlStore.oMasterSearchField.setShowRefreshButton(!i);o._oControlStore.oMasterSearchField.setSelectOnFocus(false);o._oControlStore.sMasterSearchText=null;o._oControlStore.oMasterSearchField.attachSearch(jQuery.proxy(function(e){this.handleMasterSearch(o,e);},this));var _=o;o._oControlStore.oMasterSearchField.attachLiveChange(jQuery.proxy(function(){_._applyClientSideSearch();_._oControlStore.sMasterSearchText=_._oControlStore.oMasterSearchField.getValue();},this));var d=o.getOwnerComponent().getModel("i18n").getResourceBundle(),p=null;if(o._oHeaderFooterOptions.sI18NSearchFieldPlaceholder){p=d.getText(o._oHeaderFooterOptions.sI18NSearchFieldPlaceholder);}else{p=d.getText("MASTER_PLACEHOLDER_SEARCHFIELD");}o._oControlStore.oMasterSearchField.setPlaceholder(p);s.addContentMiddle(o._oControlStore.oMasterSearchField);},createMasterPullToRefresh:function(o,p){o._oControlStore.oMasterPullToRefresh=new P();o._oControlStore.oMasterPullToRefresh.attachRefresh(jQuery.proxy(function(){this.handleMasterPullToRefresh(o);},this));p.insertContent(o._oControlStore.oMasterPullToRefresh,0);},handleMasterSearch:function(o,e){var i=e.getParameter("refreshButtonPressed");if(!i){o._oControlStore.sMasterSearchText=o._oControlStore.oMasterSearchField.getValue();}if(i){this.refreshList(o,i);}},handleMasterPullToRefresh:function(o){this.refreshList(o,true);},refreshList:function(o,I){var d=this.oApplicationImplementation.getComponent().getDataManager();d.fetchTaskDefinitionsandCustomAttributeDefinitions(jQuery.proxy(d.initTaskDefnandCustomAttrDefnnModel,d));I=I&&(o._oControlStore.sMasterSearchText!=null||o._oMasterListBinding!=null);o._oControlStore.bIsSearching=!I;var t=null;if(I){t=o._oControlStore.sMasterSearchText;if(t===null){t="";}o._oControlStore.oMasterSearchField.setValue(t);this.oApplicationImplementation.bManualMasterRefresh=true;}else{t=o._oControlStore.oMasterSearchField.getValue();}var l=o.getList();this.oApplicationImplementation.aKeyValues=null;if(this.oApplicationImplementation.aMasterKeys){var e=l.getItems();for(var i=0;i<e.length;i++){var L=e[i];if(L.getSelected()){this.oApplicationImplementation.aKeyValues=[];var f=L.getBindingContext(o.sModelName);for(var j=0;j<this.oApplicationImplementation.aMasterKeys.length;j++){this.oApplicationImplementation.aKeyValues.push(f.getProperty(this.oApplicationImplementation.aMasterKeys[j]));}i=e.length;}}}if(o._oHeaderFooterOptions.onRefresh){var r=jQuery.proxy(function(){this.oApplicationImplementation.onMasterRefreshed(o);if(o._oControlStore.oMasterPullToRefresh){o._oControlStore.oMasterPullToRefresh.hide();}},this);var g=o._oHeaderFooterOptions.onRefresh(t,r);if(g==0){this.aKeyValues=null;o._oControlStore.bIsSearching=false;if(o._oControlStore.oMasterPullToRefresh){o._oControlStore.oMasterPullToRefresh.hide();}}if(g<=0){if(g<0){this.setMasterListVisible(o);}return;}}var h=o._oMasterListBinding;var k=!h;if(h){h.attachChange(o._onMasterListLoaded,o);var R=jQuery.proxy(function(){if(o._oControlStore.oMasterPullToRefresh){o._oControlStore.oMasterPullToRefresh.hide();}h.detachDataReceived(R);},this);var m=jQuery.proxy(function(){k=true;h.detachDataRequested(m);},this);h.attachDataRequested(m);h.attachDataReceived(R);}if((I)&&(!k&&o._oMasterListBinding)){o._oMasterListBinding.refresh();}this.setMasterListVisible(o);},setMasterListVisible:function(o){if(o._emptyList&&!o._emptyList.hasStyleClass("hiddenList")){o._emptyList.addStyleClass("hiddenList");o.getList().removeStyleClass("hiddenList");}},defineMasterTitle:function(o,d,i){var t;if(!o._oHeaderFooterOptions.sI18NMasterTitle){return;}if(!o._oControlStore.oMasterTitle){if(this.oCommonHeaderFooterHelper.isUsingStableIds()){t=o._oHeaderFooterOptions.sMasterTitleId;t=this.oCommonHeaderFooterHelper.createId(o,t);}o._oControlStore.oMasterTitle=new T(t,{level:c.H2});o.getList().addAriaLabelledBy(o._oControlStore.oMasterTitle);d.addContentMiddle(o._oControlStore.oMasterTitle);}this.setMasterTitle(o,i);},setMasterTitle:function(o,i){if(!o._oControlStore.oMasterTitle){return;}var d=o.getOwnerComponent().getModel("i18n").getResourceBundle();var t=d.getText(o._oHeaderFooterOptions.sI18NMasterTitle,[i]);o._oControlStore.oMasterTitle.setText(t);},defineEditButton:function(o,d){var i;if(o._oHeaderFooterOptions.onEditPress||o._oHeaderFooterOptions.oEditBtn){if(!o._oControlStore.oEditBtn){i=o._oHeaderFooterOptions.oEditBtn&&this.oCommonHeaderFooterHelper.createId(o,o._oHeaderFooterOptions.oEditBtn.sId);if(!i){i=this.oCommonHeaderFooterHelper.createId(o,"myInbox_EDIT");}o._oControlStore.oEditBtn=new b({id:i});d.addContentRight(o._oControlStore.oEditBtn);o._oControlStore.oEditBtn.attachPress(jQuery.proxy(function(){if(o._oControlStore.bEditState){o._oControlStore.oEditBtn.setIcon("sap-icon://multi-select");o._oControlStore.oEditBtn.setTooltip(o.getOwnerComponent().getModel("i18n").getResourceBundle().getText("XBUT_MULTI_SELECT"));}else{o._oControlStore.oEditBtn.setIcon("sap-icon://sys-cancel");o._oControlStore.oEditBtn.setTooltip(o.getOwnerComponent().getModel("i18n").getResourceBundle().getText("XBUT_CANCEL"));}o._oControlStore.bEditState=!o._oControlStore.bEditState;(o._oHeaderFooterOptions.onEditPress||o._oHeaderFooterOptions.oEditBtn.onBtnPressed)(o._oControlStore.bEditState);},this));}if(o._oControlStore.bEditState){o._oControlStore.oEditBtn.setIcon("sap-icon://sys-cancel");o._oControlStore.oEditBtn.setTooltip(o.getOwnerComponent().getModel("i18n").getResourceBundle().getText("XBUT_CANCEL"));}else{o._oControlStore.oEditBtn.setIcon("sap-icon://multi-select");o._oControlStore.oEditBtn.setTooltip(o.getOwnerComponent().getModel("i18n").getResourceBundle().getText("XBUT_MULTI_SELECT"));}o._oControlStore.oEditBtn.setVisible(true);o._oControlStore.oEditBtn.setEnabled(!(!(o._oHeaderFooterOptions.onEditPress||!o._oHeaderFooterOptions.oEditBtn.bDisabled)||o._oControlStore.bAllDisabled));if(o._oHeaderFooterOptions.oEditBtn&&o._oHeaderFooterOptions.oEditBtn.sId){o._oControlStore.oButtonListHelper.mButtons[o._oHeaderFooterOptions.oEditBtn.sId]=o._oControlStore.oEditBtn;}}else if(o._oControlStore.oEditBtn){o._oControlStore.oEditBtn.setVisible(false);}},defineSettingsButton:function(o){this.oCommonHeaderFooterHelper.createSettingsButton(o);},defineFooterRight:function(o){var f=this.getFooterRightCount(o);if(o._oHeaderFooterOptions.buttonList){for(var i=0;i<o._oHeaderFooterOptions.buttonList.length;i++){var d={};jQuery.extend(d,o._oHeaderFooterOptions.buttonList[i]);delete d.sIcon;if(this.oCommonHeaderFooterHelper.isUsingStableIds()){this.oCommonHeaderFooterHelper.addIds(d,o._oHeaderFooterOptions.buttonList[i].sId,o,undefined);}o._oControlStore.oButtonListHelper.ensureButton(d,"b",f);}}this.oCommonHeaderFooterHelper.getGenericButtons(f,o,o._oControlStore.oButtonListHelper);if(o._oHeaderFooterOptions.onAddPress||o._oHeaderFooterOptions.oAddOptions){this.addAddButton(o);}},getFooterRightCount:function(o){var s=1;var m=2;var l=s;var g=this.oCommonHeaderFooterHelper.getGenericCount(o);var A=this.oCommonHeaderFooterHelper.getActionsCount(o,true);if(this.oApplicationImplementation.bIsPhone&&D.orientation.landscape){if(A===1&&g<4){return A+g;}l=m;}if(A===0){return 3;}if(A===l&&g===1){return l+1;}return l;},addAddButton:function(o){var d={};if(o._oHeaderFooterOptions.onAddPress){d.onBtnPressed=o._oHeaderFooterOptions.onAddPress;d.sTooltip=o.getOwnerComponent().getModel("i18n").getResourceBundle().getText("ADD");}else{jQuery.extend(d,o._oHeaderFooterOptions.oAddOptions);delete d.sBtnText;delete d.sI18nBtnTxt;}if(this.oCommonHeaderFooterHelper.isUsingStableIds()){this.oCommonHeaderFooterHelper.addIds(d,o._oHeaderFooterOptions.oAddOptions?o._oHeaderFooterOptions.oAddOptions.sId:undefined,o,"myInbox_ADD");}d.sIcon="sap-icon://add";o._oControlStore.oButtonListHelper.ensureButton(d,"b");}});return cross.fnd.fiori.inbox.util.tools.MasterHeaderFooterHelper;});
