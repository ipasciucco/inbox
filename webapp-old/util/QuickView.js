/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["cross/fnd/fiori/inbox/util/Conversions","cross/fnd/fiori/inbox/util/CommonFunctions","sap/m/Button","sap/m/MessageToast","sap/m/MessageBox","sap/m/BusyDialog","sap/m/QuickView"],function(C,a,B,M,b,c,Q){"use strict";Q.extend("cross.fnd.fiori.inbox.util.QuickView",{_oContact:null,i18nBundle:null,setContact:function(o){this._oContact=o;},onBeforeRenderingPopover:function(){Q.prototype.onBeforeRenderingPopover.call(this);if(this.isFunctionAvailable("navigator.contacts")){var p=this._oNavContainer.getPages()[0];this.i18nBundle=cross.fnd.fiori.inbox.util.tools.Application.getImpl().AppI18nModel.getResourceBundle();p.addContent(new B({text:this.i18nBundle.getText("XBUT_ADDCONTACT"),press:jQuery.proxy(this._addContact,this)}));}},_addContact:function(){var t=this;var r=this._oContact;var o=t.getPlugin("navigator.contacts");var d=o.create();var e=t.getPlugin("ContactName");var n=new e();if(r.FirstName){n.givenName=r.FirstName;}if(r.LastName){n.familyName=r.LastName;}d.name=n;d.displayName=(n.givenName||n.familyName)?[n.givenName,n.familyName].join(" "):null;if(d.displayName){d.displayName=d.displayName.trim();}var p=[];var f=t.getPlugin("ContactField");if(r.WorkPhone){p.push(new f("work",r.WorkPhone));}if(r.MobilePhone){p.push(new f("mobile",r.MobilePhone));}if(r.HomePhone){p.push(new f("home",r.HomePhone));}if(p.length!==0){d.phoneNumbers=p;}var g=[];if(r.Email){g.push(new f("work",r.Email));d.emails=g;}var h=[];var i=t.getPlugin("ContactAddress");var j=new i();var k=false;if(r.Address.Street){j.streetAddress=r.Address.Street+" "+(r.Address.StreetNumber?r.Address.StreetNumber:"");k=true;}if(r.Address.City){j.locality=r.Address.City;k=true;}if(r.Address.State){j.region=r.Address.State;k=true;}if(r.Address.PostalCode){j.postalCode=r.Address.PostalCode;k=true;}if(r.Address.Country){j.country=r.Country;k=true;}if(k){h.push(j);d.addresses=h;}var D=new c({text:this.i18nBundle.getText("dialog.info.mq.contantBeingCreated")});D.open();var l=[];if(r.__metadata.media_src){l.push(new f("url",r.__metadata.media_src));d.photos=l;}d.save(function(){D.close();M.show(t.i18nBundle.getText("dialog.success.mq.contactSaved"));},function(m){D.close();var E=t.i18nBundle.getText("dialog.error.mq.contactCreationFailed");b.error(E,{details:a.fnRemoveHtmlTags(m.code)});});},getPlugin:function(p){try{return this._namespaceExists(p);}catch(e){return null;}},isFunctionAvailable:function(p){try{return(typeof this._namespaceExists(p)!=="undefined");}catch(e){return false;}},_namespaceExists:function(n){var t=n.split(".");return t.reduce(function(p,d){return(typeof p==="undefined")?p:p[d];},window);}});return cross.fnd.fiori.inbox.util.QuickView;});
