/*
 * Copyright (C) 2009-2021 SAP SE or an SAP affiliate company. All rights reserved.
 */
sap.ui.define(["cross/fnd/fiori/inbox/util/Constants","sap/ui/thirdparty/jquery"],function(C,q){"use strict";return{_predefinedCustomAttributeNames:["customtasktitle","customnumbervalue","customnumberunitvalue","customobjectattributevalue","customcreatedby"],addDisplayOrderPriorityIfMissing:function(d){for(var i=0;i<d.length;i++){var D=d[i];if(isNaN(D.iDisplayOrderPriority)){var a=i*2;if(!D.Nature){D.iDisplayOrderPriority=2000+a;}else if(D.Nature.toUpperCase()==="POSITIVE"){D.iDisplayOrderPriority=a;}else if(D.Nature.toUpperCase()==="NEGATIVE"){D.iDisplayOrderPriority=1000+a;}else{D.iDisplayOrderPriority=2000+a;}}d[i]=D;}},processResponseOptions:function(r,m){var k,a;this.addDisplayOrderPriorityIfMissing(r);for(var i=0;i<r.length;i++){a=r[i];if(a.SAP__Origin&&a.TaskDefinitionID&&a.DecisionKey){k=this.getKeyForResponseOption(a);}a[C.NP_REASON_DEFINITIONS_DATA]=a[C.NP_REASON_DEFINITIONS_DATA].results;m[k]=q.extend(true,{},a);delete a[C.NP_REASON_DEFINITIONS_DATA];}},convertArrayToMap:function(l,g){var m={};for(var i in l){var v=l[i];var k=g(v);m[k]=v;}return m;},addPrefixToCustomAttributes:function(m){var p="CA_";var a=Object.keys(m);for(var i=0;i<a.length;i++){var k=a[i];if(m[k].Name){m[k].Name=p+m[k].Name;}}},getKeyForTaskModel:function(v){return"SAP__Origin="+encodeURIComponent(v.SAP__Origin)+",InstanceID="+encodeURIComponent(v.InstanceID);},getKeyForCustomAttributeDefinitionModel:function(v){return"SAP__Origin="+encodeURIComponent(v.SAP__Origin)+",TaskDefinitionID="+encodeURIComponent(v.TaskDefinitionID)+",Name="+encodeURIComponent(v.Name);},getKeyForTaskDefinitionModel:function(v){return"SAP__Origin="+encodeURIComponent(v.SAP__Origin)+",TaskDefinitionID="+encodeURIComponent(v.TaskDefinitionID);},getKeyForResponseOption:function(v){return"SAP__Origin="+encodeURIComponent(v.SAP__Origin)+",TaskDefinitionID="+encodeURIComponent(v.TaskDefinitionID)+",DecisionKey="+encodeURIComponent(v.DecisionKey);},checkPropertyExistsInMetadata:function(e,p,s){var a=false;if(s&&s.oModel&&s.oModel.getData()&&s.oModel.getData().dataServices&&s.oModel.getData().dataServices.schema[0]){var E=s.getODataEntitySet(e);if(E&&!p){a=true;return a;}var n=s.oModel.getData().dataServices.schema[0].namespace;var o=s.getODataEntityType(n+"."+(e?e:"Task"));if(o&&p){if(s.getODataProperty(o,p)){a=true;}else if(o.navigationProperty){for(var i=0;i<o.navigationProperty.length;i++){if(o.navigationProperty[i].name===p){a=true;break;}}}}}return a;},updateCustAttrDataWithCustAttrDefsAndSetVisibility:function(n,c,t,e){if(n&&n.CustomAttributeData&&n.CustomAttributeData.results&&c){var S=c.SAP__Origin;var a=c.TaskDefinitionID;for(var i=0;i<n.CustomAttributeData.results.length;i++){var b=n.CustomAttributeData.results[i].Name;if(this._predefinedCustomAttributeNames.indexOf(b.toLowerCase())===-1){n.CustomAttributeData.results[i].Visible=true;n.bShowCustomAttributesInDetail=true;}else{n.CustomAttributeData.results[i].Visible=false;}var p={};p.SAP__Origin=S;p.TaskDefinitionID=a;var d=this.getKeyForTaskDefinitionModel(p);var f=t[d];n.CustomAttributeData.results[i].TaskDefinitionID="";n.CustomAttributeData.results[i].Type="";n.CustomAttributeData.results[i].Label=e;if(f&&f.CustomAttributeDefinitionData){var g=f.CustomAttributeDefinitionData;var h={};h.SAP__Origin=S;h.TaskDefinitionID=a;h.Name=b;var j=this.getKeyForCustomAttributeDefinitionModel(h);var k=g[j];if(k){n.CustomAttributeData.results[i].TaskDefinitionID=k.TaskDefinitionID;n.CustomAttributeData.results[i].Type=k.Type;n.CustomAttributeData.results[i].Label=k.Label;if(k.Format){n.CustomAttributeData.results[i].Format=k.Format;}}}}}return n;},setVisibilityFlagsInDetail:function(t){var d=t.Description;t.bAdditionalInformationVisible=(d&&((d.DescriptionAsHtml&&d.DescriptionAsHtml.length>0)||(d.Description&&d.Description.length>0)))||false;t.bNoAdditionalInformationMessageVisible=(!t.bAdditionalInformationVisible)&&(!t.bShowCustomAttributesInDetail);return t;}};});
